<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/gallery-matrix-background/js/MatrixBackground.js - YUI 3 Gallery Modules</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="YUI 3 Gallery Modules" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Accordion.html">Accordion</a></li>
                                <li><a href="../classes/AnimSequence.html">AnimSequence</a></li>
                                <li><a href="../classes/ArrayIterator.html">ArrayIterator</a></li>
                                <li><a href="../classes/ArrayList~extras.html">ArrayList~extras</a></li>
                                <li><a href="../classes/Array~algorithms.html">Array~algorithms</a></li>
                                <li><a href="../classes/Array~funcprog-extras.html">Array~funcprog-extras</a></li>
                                <li><a href="../classes/Array~object-extras.html">Array~object-extras</a></li>
                                <li><a href="../classes/Assert.html">Assert</a></li>
                                <li><a href="../classes/AtLeastOneCheckboxGroup.html">AtLeastOneCheckboxGroup</a></li>
                                <li><a href="../classes/AtMostOneCheckboxGroup.html">AtMostOneCheckboxGroup</a></li>
                                <li><a href="../classes/BulkEditor.html">BulkEditor</a></li>
                                <li><a href="../classes/Canvas.Context2d.html">Canvas.Context2d</a></li>
                                <li><a href="../classes/CheckboxGroup.html">CheckboxGroup</a></li>
                                <li><a href="../classes/Chipper.html">Chipper</a></li>
                                <li><a href="../classes/CollapseToggle.html">CollapseToggle</a></li>
                                <li><a href="../classes/ComplexMath.html">ComplexMath</a></li>
                                <li><a href="../classes/ComplexNumber.html">ComplexNumber</a></li>
                                <li><a href="../classes/DataSource.AsyncFunction.html">DataSource.AsyncFunction</a></li>
                                <li><a href="../classes/DataSource.BulkEdit.html">DataSource.BulkEdit</a></li>
                                <li><a href="../classes/DataSource.Treeble.html">DataSource.Treeble</a></li>
                                <li><a href="../classes/DateTime.html">DateTime</a></li>
                                <li><a href="../classes/DateTimeRange.html">DateTimeRange</a></li>
                                <li><a href="../classes/DateTimeUtils.html">DateTimeUtils</a></li>
                                <li><a href="../classes/EnableIfAnyCheckboxGroup.html">EnableIfAnyCheckboxGroup</a></li>
                                <li><a href="../classes/ExpirationCache.html">ExpirationCache</a></li>
                                <li><a href="../classes/ExpressionBuilder.html">ExpressionBuilder</a></li>
                                <li><a href="../classes/FormManager.html">FormManager</a></li>
                                <li><a href="../classes/HTMLTableBulkEditor.html">HTMLTableBulkEditor</a></li>
                                <li><a href="../classes/InputPopup.html">InputPopup</a></li>
                                <li><a href="../classes/InstanceManager.html">InstanceManager</a></li>
                                <li><a href="../classes/io~multiresponse.html">io~multiresponse</a></li>
                                <li><a href="../classes/Iterable.html">Iterable</a></li>
                                <li><a href="../classes/LinkedList.html">LinkedList</a></li>
                                <li><a href="../classes/LinkedListItem.html">LinkedListItem</a></li>
                                <li><a href="../classes/LinkedListIterator.html">LinkedListIterator</a></li>
                                <li><a href="../classes/LogFilter.html">LogFilter</a></li>
                                <li><a href="../classes/Math.html">Math</a></li>
                                <li><a href="../classes/MathCanvas.html">MathCanvas</a></li>
                                <li><a href="../classes/MathCanvas.Parser.html">MathCanvas.Parser</a></li>
                                <li><a href="../classes/MathCanvas.RectList.html">MathCanvas.RectList</a></li>
                                <li><a href="../classes/MathFunction.html">MathFunction</a></li>
                                <li><a href="../classes/MathFunction.Arccosine.html">MathFunction.Arccosine</a></li>
                                <li><a href="../classes/MathFunction.Arcsine.html">MathFunction.Arcsine</a></li>
                                <li><a href="../classes/MathFunction.Arctangent.html">MathFunction.Arctangent</a></li>
                                <li><a href="../classes/MathFunction.Arctangent2.html">MathFunction.Arctangent2</a></li>
                                <li><a href="../classes/MathFunction.Conjugate.html">MathFunction.Conjugate</a></li>
                                <li><a href="../classes/MathFunction.Cosine.html">MathFunction.Cosine</a></li>
                                <li><a href="../classes/MathFunction.E.html">MathFunction.E</a></li>
                                <li><a href="../classes/MathFunction.Exponential.html">MathFunction.Exponential</a></li>
                                <li><a href="../classes/MathFunction.FunctionWithArgs.html">MathFunction.FunctionWithArgs</a></li>
                                <li><a href="../classes/MathFunction.HyperbolicCosine.html">MathFunction.HyperbolicCosine</a></li>
                                <li><a href="../classes/MathFunction.HyperbolicSine.html">MathFunction.HyperbolicSine</a></li>
                                <li><a href="../classes/MathFunction.HyperbolicTangent.html">MathFunction.HyperbolicTangent</a></li>
                                <li><a href="../classes/MathFunction.I.html">MathFunction.I</a></li>
                                <li><a href="../classes/MathFunction.ImaginaryPart.html">MathFunction.ImaginaryPart</a></li>
                                <li><a href="../classes/MathFunction.Input.html">MathFunction.Input</a></li>
                                <li><a href="../classes/MathFunction.InverseHyperbolicCosine.html">MathFunction.InverseHyperbolicCosine</a></li>
                                <li><a href="../classes/MathFunction.InverseHyperbolicSine.html">MathFunction.InverseHyperbolicSine</a></li>
                                <li><a href="../classes/MathFunction.InverseHyperbolicTangent.html">MathFunction.InverseHyperbolicTangent</a></li>
                                <li><a href="../classes/MathFunction.Logarithm.html">MathFunction.Logarithm</a></li>
                                <li><a href="../classes/MathFunction.Magnitude.html">MathFunction.Magnitude</a></li>
                                <li><a href="../classes/MathFunction.Max.html">MathFunction.Max</a></li>
                                <li><a href="../classes/MathFunction.Min.html">MathFunction.Min</a></li>
                                <li><a href="../classes/MathFunction.NaturalLog.html">MathFunction.NaturalLog</a></li>
                                <li><a href="../classes/MathFunction.Negate.html">MathFunction.Negate</a></li>
                                <li><a href="../classes/MathFunction.Phase.html">MathFunction.Phase</a></li>
                                <li><a href="../classes/MathFunction.Pi.html">MathFunction.Pi</a></li>
                                <li><a href="../classes/MathFunction.Product.html">MathFunction.Product</a></li>
                                <li><a href="../classes/MathFunction.Quotient.html">MathFunction.Quotient</a></li>
                                <li><a href="../classes/MathFunction.RealPart.html">MathFunction.RealPart</a></li>
                                <li><a href="../classes/MathFunction.Rotate.html">MathFunction.Rotate</a></li>
                                <li><a href="../classes/MathFunction.Sine.html">MathFunction.Sine</a></li>
                                <li><a href="../classes/MathFunction.SquareRoot.html">MathFunction.SquareRoot</a></li>
                                <li><a href="../classes/MathFunction.Sum.html">MathFunction.Sum</a></li>
                                <li><a href="../classes/MathFunction.Tangent.html">MathFunction.Tangent</a></li>
                                <li><a href="../classes/MathFunction.Value.html">MathFunction.Value</a></li>
                                <li><a href="../classes/MathFunction.Variable.html">MathFunction.Variable</a></li>
                                <li><a href="../classes/MatrixBackground.html">MatrixBackground</a></li>
                                <li><a href="../classes/MatrixCredits.html">MatrixCredits</a></li>
                                <li><a href="../classes/MRUCache.html">MRUCache</a></li>
                                <li><a href="../classes/MultiObject.html">MultiObject</a></li>
                                <li><a href="../classes/NodeList~extras2.html">NodeList~extras2</a></li>
                                <li><a href="../classes/Node~dimensions.html">Node~dimensions</a></li>
                                <li><a href="../classes/Node~event-set.html">Node~event-set</a></li>
                                <li><a href="../classes/Node~optimizations.html">Node~optimizations</a></li>
                                <li><a href="../classes/Node~scrollIntoView.html">Node~scrollIntoView</a></li>
                                <li><a href="../classes/Node~utils.html">Node~utils</a></li>
                                <li><a href="../classes/Object~extras.html">Object~extras</a></li>
                                <li><a href="../classes/PageLayout.html">PageLayout</a></li>
                                <li><a href="../classes/Paginator.ui.CurrentPageInput.html">Paginator.ui.CurrentPageInput</a></li>
                                <li><a href="../classes/Paginator.ui.CurrentPageReport.html">Paginator.ui.CurrentPageReport</a></li>
                                <li><a href="../classes/Paginator.ui.FirstPageLink.html">Paginator.ui.FirstPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.ItemRangeDropdown.html">Paginator.ui.ItemRangeDropdown</a></li>
                                <li><a href="../classes/Paginator.ui.LastPageLink.html">Paginator.ui.LastPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.NextPageLink.html">Paginator.ui.NextPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.PageLinks.html">Paginator.ui.PageLinks</a></li>
                                <li><a href="../classes/Paginator.ui.PreviousPageLink.html">Paginator.ui.PreviousPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.RowsPerPageDropdown.html">Paginator.ui.RowsPerPageDropdown</a></li>
                                <li><a href="../classes/Paginator.ui.ValidationPageLinks.html">Paginator.ui.ValidationPageLinks</a></li>
                                <li><a href="../classes/Parsers.html">Parsers</a></li>
                                <li><a href="../classes/Plugin.BusyOverlay.html">Plugin.BusyOverlay</a></li>
                                <li><a href="../classes/Plugin.ConsoleTest.html">Plugin.ConsoleTest</a></li>
                                <li><a href="../classes/Plugin.DataTableDataSourceBusy.html">Plugin.DataTableDataSourceBusy</a></li>
                                <li><a href="../classes/Plugin.DataTablePaginator.html">Plugin.DataTablePaginator</a></li>
                                <li><a href="../classes/Plugin.DataTableQuickEdit.html">Plugin.DataTableQuickEdit</a></li>
                                <li><a href="../classes/Plugin.DataTableRowExpansion.html">Plugin.DataTableRowExpansion</a></li>
                                <li><a href="../classes/Plugin.DataTableState.html">Plugin.DataTableState</a></li>
                                <li><a href="../classes/Plugin.FixedSizeAccordion.html">Plugin.FixedSizeAccordion</a></li>
                                <li><a href="../classes/Plugin.InputCalendarSync.html">Plugin.InputCalendarSync</a></li>
                                <li><a href="../classes/Plugin.Neon.html">Plugin.Neon</a></li>
                                <li><a href="../classes/Plugin.NodeFXSequence.html">Plugin.NodeFXSequence</a></li>
                                <li><a href="../classes/Plugin.OverlayForm.html">Plugin.OverlayForm</a></li>
                                <li><a href="../classes/Plugin.PageLayoutAnyWidgetModule.html">Plugin.PageLayoutAnyWidgetModule</a></li>
                                <li><a href="../classes/Plugin.PageLayoutDataTableModule.html">Plugin.PageLayoutDataTableModule</a></li>
                                <li><a href="../classes/Popup.html">Popup</a></li>
                                <li><a href="../classes/QueryBuilder.html">QueryBuilder</a></li>
                                <li><a href="../classes/QueryBuilder.DateRange.html">QueryBuilder.DateRange</a></li>
                                <li><a href="../classes/QueryBuilder.MultiselectInput.html">QueryBuilder.MultiselectInput</a></li>
                                <li><a href="../classes/QueryBuilder.Select.html">QueryBuilder.Select</a></li>
                                <li><a href="../classes/QueryBuilder.String.html">QueryBuilder.String</a></li>
                                <li><a href="../classes/RPC.Mojito.html">RPC.Mojito</a></li>
                                <li><a href="../classes/SelectAllCheckboxGroup.html">SelectAllCheckboxGroup</a></li>
                                <li><a href="../classes/Sort.html">Sort</a></li>
                                <li><a href="../classes/Treeble.html">Treeble</a></li>
                                <li><a href="../classes/YUI~funcprog.html">YUI~funcprog</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/gallery-accordion-horiz-vert.html">gallery-accordion-horiz-vert</a></li>
                                <li><a href="../modules/gallery-adobe-air-config.html">gallery-adobe-air-config</a></li>
                                <li><a href="../modules/gallery-adobe-air-page-manager.html">gallery-adobe-air-page-manager</a></li>
                                <li><a href="../modules/gallery-adobe-air-prefs.html">gallery-adobe-air-prefs</a></li>
                                <li><a href="../modules/gallery-algorithms.html">gallery-algorithms</a></li>
                                <li><a href="../modules/gallery-anim-class.html">gallery-anim-class</a></li>
                                <li><a href="../modules/gallery-anim-sequence.html">gallery-anim-sequence</a></li>
                                <li><a href="../modules/gallery-bulkedit.html">gallery-bulkedit</a></li>
                                <li><a href="../modules/gallery-busyoverlay.html">gallery-busyoverlay</a></li>
                                <li><a href="../modules/gallery-canvas.html">gallery-canvas</a></li>
                                <li><a href="../modules/gallery-checkboxgroups.html">gallery-checkboxgroups</a></li>
                                <li><a href="../modules/gallery-chipper.html">gallery-chipper</a></li>
                                <li><a href="../modules/gallery-collapse-toggle.html">gallery-collapse-toggle</a></li>
                                <li><a href="../modules/gallery-complexnumber.html">gallery-complexnumber</a></li>
                                <li><a href="../modules/gallery-console-test.html">gallery-console-test</a></li>
                                <li><a href="../modules/gallery-datasource-async-function.html">gallery-datasource-async-function</a></li>
                                <li><a href="../modules/gallery-datatable-datasource-busy.html">gallery-datatable-datasource-busy</a></li>
                                <li><a href="../modules/gallery-datatable-paginator.html">gallery-datatable-paginator</a></li>
                                <li><a href="../modules/gallery-datatable-row-expansion.html">gallery-datatable-row-expansion</a></li>
                                <li><a href="../modules/gallery-datatable-state.html">gallery-datatable-state</a></li>
                                <li><a href="../modules/gallery-datetime.html">gallery-datetime</a></li>
                                <li><a href="../modules/gallery-datetime-range.html">gallery-datetime-range</a></li>
                                <li><a href="../modules/gallery-datetime-utils.html">gallery-datetime-utils</a></li>
                                <li><a href="../modules/gallery-dimensions.html">gallery-dimensions</a></li>
                                <li><a href="../modules/gallery-expiration-cache.html">gallery-expiration-cache</a></li>
                                <li><a href="../modules/gallery-exprbuilder.html">gallery-exprbuilder</a></li>
                                <li><a href="../modules/gallery-formmgr.html">gallery-formmgr</a></li>
                                <li><a href="../modules/gallery-formmgr-css-validation.html">gallery-formmgr-css-validation</a></li>
                                <li><a href="../modules/gallery-formmgr-overlay-plugin.html">gallery-formmgr-overlay-plugin</a></li>
                                <li><a href="../modules/gallery-funcprog.html">gallery-funcprog</a></li>
                                <li><a href="../modules/gallery-input-calendar-sync.html">gallery-input-calendar-sync</a></li>
                                <li><a href="../modules/gallery-instancemanager.html">gallery-instancemanager</a></li>
                                <li><a href="../modules/gallery-io-adobe-air.html">gallery-io-adobe-air</a></li>
                                <li><a href="../modules/gallery-io-multiresponse.html">gallery-io-multiresponse</a></li>
                                <li><a href="../modules/gallery-iterable-extras.html">gallery-iterable-extras</a></li>
                                <li><a href="../modules/gallery-layout.html">gallery-layout</a></li>
                                <li><a href="../modules/gallery-layout-anywidget.html">gallery-layout-anywidget</a></li>
                                <li><a href="../modules/gallery-layout-cols.html">gallery-layout-cols</a></li>
                                <li><a href="../modules/gallery-layout-datatable.html">gallery-layout-datatable</a></li>
                                <li><a href="../modules/gallery-layout-rows.html">gallery-layout-rows</a></li>
                                <li><a href="../modules/gallery-linkedlist.html">gallery-linkedlist</a></li>
                                <li><a href="../modules/gallery-log-filter.html">gallery-log-filter</a></li>
                                <li><a href="../modules/gallery-math.html">gallery-math</a></li>
                                <li><a href="../modules/gallery-mathcanvas.html">gallery-mathcanvas</a></li>
                                <li><a href="../modules/gallery-matrix-background.html">gallery-matrix-background</a></li>
                                <li><a href="../modules/gallery-matrix-credits.html">gallery-matrix-credits</a></li>
                                <li><a href="../modules/gallery-mojito-rpc.html">gallery-mojito-rpc</a></li>
                                <li><a href="../modules/gallery-mru-cache.html">gallery-mru-cache</a></li>
                                <li><a href="../modules/gallery-multiobject.html">gallery-multiobject</a></li>
                                <li><a href="../modules/gallery-neon.html">gallery-neon</a></li>
                                <li><a href="../modules/gallery-node-event-set.html">gallery-node-event-set</a></li>
                                <li><a href="../modules/gallery-node-optimizations.html">gallery-node-optimizations</a></li>
                                <li><a href="../modules/gallery-node-utils.html">gallery-node-utils</a></li>
                                <li><a href="../modules/gallery-nodelist-extras2.html">gallery-nodelist-extras2</a></li>
                                <li><a href="../modules/gallery-object-extras.html">gallery-object-extras</a></li>
                                <li><a href="../modules/gallery-paginator.html">gallery-paginator</a></li>
                                <li><a href="../modules/gallery-popup.html">gallery-popup</a></li>
                                <li><a href="../modules/gallery-querybuilder.html">gallery-querybuilder</a></li>
                                <li><a href="../modules/gallery-querybuilder-daterange.html">gallery-querybuilder-daterange</a></li>
                                <li><a href="../modules/gallery-querybuilder-multiselect-input.html">gallery-querybuilder-multiselect-input</a></li>
                                <li><a href="../modules/gallery-quickedit.html">gallery-quickedit</a></li>
                                <li><a href="../modules/gallery-scrollintoview.html">gallery-scrollintoview</a></li>
                                <li><a href="../modules/gallery-sort-extras.html">gallery-sort-extras</a></li>
                                <li><a href="../modules/gallery-table-utils.html">gallery-table-utils</a></li>
                                <li><a href="../modules/gallery-test-extras.html">gallery-test-extras</a></li>
                                <li><a href="../modules/gallery-treeble.html">gallery-treeble</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/gallery-matrix-background/js/MatrixBackground.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&quot;use strict&quot;;

/**
 * @module gallery-matrix-background
 */

// Based on my ancient JMatrixCtrl MFC widget

/**
 * Node plugin to display falling text similar to what was used in the
 * credits for The Matrix.  If you plug into the body element, then it will
 * fill the viewport.  Otherwise, you must set a width and height for the
 * node.
 * 
 * @main gallery-matrix-background
 * @class MatrixBackground
 * @constructor
 * @param config {Object} Plugin configuration
 */
function MatrixBackground(config)
{
	this.timer   = {};
	this.cell_on = [];

	MatrixBackground.superclass.constructor.call(this, config);
}

MatrixBackground.NAME = &#x27;MatrixBackgroundPlugin&#x27;;
MatrixBackground.NS   = &#x27;matrix&#x27;;

MatrixBackground.ATTRS =
{
	/**
	 * The range of Unicode characters to use for the background noise.
	 * 
	 * @attribute charRange
	 * @type {Array}
	 * @default [&#x27;\u30A1&#x27;, &#x27;\u30FA&#x27;]
	 */
	charRange:
	{
		value: [&#x27;\u30A1&#x27;, &#x27;\u30FA&#x27;],
		validator: function(value)
		{
			return (Y.Lang.isArray(value) &amp;&amp; value.length == 2 &amp;&amp;
					value[0].length == 1 &amp;&amp; value[1].length == 1 &amp;&amp;
					value[0] &lt; value[1]);
		}
	},

	/**
	 * Set to &#x60;true&#x60; to force a monospace font.  This only works if the
	 * browser can find a monospace version of the character range which
	 * you are using.
	 *
	 * @attribute monospace
	 * @type {Boolean}
	 * @default true for IE, false for all other browsers
	 */
	monospace:
	{
		value:     !!Y.UA.ie,
		validator: Y.Lang.isBoolean
	},

	/**
	 * If you do not have a monospace font for the charRange, set this to
	 * &#x60;true&#x60; to computer the widest character in the range.  Note that
	 * this can take a long time if you have a large charRange!
	 *
	 * @attribute computeWidestChar
	 * @type {Boolean}
	 * @default false
	 */
	computeWidestChar:
	{
		value:     false,
		validator: Y.Lang.isBoolean
	},

	/**
	 * Fraction of total columns that have a spinning character.
	 * 
	 * @attribute spinFraction
	 * @type {Number}
	 * @default 0.2
	 */
	spinFraction:
	{
		value: 0.2,
		validator: function(value)
		{
			return (0.0 &lt;= value &amp;&amp; value &lt;= 1.0);
		}
	}
};

var interval =
	{
		spin: 10,
		drop: 80
	},

	drop_bottom_offset = 3,		// minimum number of rows affected by column drop

	min_spin_count = 300,
	max_spin_count = 800;

function rnd(min, max)
{
	return min + Math.floor(Math.random() * (max - min));
}

function getCharacterRange()
{
	var c_range = this.get(&#x27;charRange&#x27;);
	return [ c_range[0].charCodeAt(0), c_range[1].charCodeAt(0) ];
}

function getCell(x,y)
{
	return this.table.getDOMNode().firstChild.childNodes[y].childNodes[x];
}

function startTimer(id)
{
	stopTimer.call(this, id);

	this.timer[id] = Y.later(interval[id], this, function()
	{
		this.fire(id);
	},
	null, true);
}

function stopTimer(id)
{
	if (this.timer[id])
	{
		this.timer[id].cancel();
		delete this.timer[id];
	}
}

function renderTable()
{
	if (this.table)
	{
		this.table.destroy();
	}

	var c_range = getCharacterRange.call(this),
		c       = String.fromCharCode(c_range[0]);
	this.container.set(&#x27;innerHTML&#x27;,
		&#x27;&lt;table&gt;&lt;tr&gt;&lt;td&gt;&#x27; + c + &#x27;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#x27;);

	var table = this.container.one(&#x27;table&#x27;);
	if (this.get(&#x27;computeWidestChar&#x27;))
	{
		var c_max = c_range[0],
			w_max = table.totalWidth(),
			c_end = c_range[1],
			cell  = this.container.getDOMNode().getElementsByTagName(&#x27;td&#x27;)[0];
		for (c=c_max+1; c&lt;=c_end; c++)
		{
			cell.innerHTML = String.fromCharCode(c);
			var w          = table.totalWidth();
			if (w &gt; w_max)
			{
				w_max = w;
				c_max = c;
			}
		}

		cell.innerHTML = c = String.fromCharCode(c_max);
	}

	var w = Math.ceil(this.container.totalWidth() / table.totalWidth()),
		h = Math.ceil(this.container.totalHeight() / table.totalHeight());

	var row = &#x27;&lt;tr&gt;&#x27;;
	for (var x=0; x&lt;w; x++)
	{
		row += &#x27;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&#x27;;
	}
	row += &#x27;&lt;/tr&gt;&#x27;;

	var s = &#x27;&#x27;;
	for (var y=0; y&lt;h; y++)
	{
		s += row;
	}

	// force column widths with row outside bounds (&amp;nbsp; forces row heights)

	s += &#x27;&lt;tr&gt;&#x27;;
	for (var x=0; x&lt;w; x++)
	{
		s += &#x27;&lt;td&gt;&#x27; + c + &#x27;&lt;/td&gt;&#x27;;
	}
	s += &#x27;&lt;/tr&gt;&#x27;;

	table.setContent(&#x27;&lt;tbody&gt;&#x27; + s + &#x27;&lt;/tbody&gt;&#x27;);

	this.table     = table;
	this.row_count = h;
	this.col_count = w;

	this.drop_active = 0;
	this.drop_col    = [];
	for (var i=0; i&lt;w; i++)
	{
		this.drop_col.push({ active: false });
	}

	startTimer.call(this, &#x27;drop&#x27;);

	initSpin.call(this);
	startTimer.call(this, &#x27;spin&#x27;);
}

function initSpin()
{
	this.spin_count  = Math.floor(this.col_count * this.get(&#x27;spinFraction&#x27;));
	this.spin_active = 0;
	this.spin        = [];
	for (var i=0; i&lt;this.spin_count; i++)
	{
		this.spin.push({ active: false });
	}
}

function initDropColumn(x)
{
	var col    = this.drop_col[x];
	col.active = true;
	col.y      = Math.random() &lt; 0.5 ? rnd(0, this.row_count - drop_bottom_offset) : 0;

	if (Math.random() &lt; 0.5)
	{
		col.y_max = col.y + rnd(drop_bottom_offset, this.row_count - col.y - 1)
	}
	else
	{
		col.y_max = this.row_count - 1;
	}

	if (Math.random() &lt; 0.2)
	{
		col.c = &#x27;&amp;nbsp;&#x27;;
	}
	else
	{
		var c_range = getCharacterRange.call(this);
		col.c       = String.fromCharCode(rnd(c_range[0], c_range[1]+1));
	}
}

function updateDrop()
{
	// increment all active columns

	var count   = this.col_count,
		c_range = getCharacterRange.call(this);
	for (var i=0; i&lt;count; i++)
	{
		var col = this.drop_col[i];
		if (col.active &amp;&amp; col.y &gt;= col.y_max)
		{
			col.active = false;
			this.drop_active--;
		}
		else
		{
			if (col.c != &#x27;&amp;nbsp;&#x27;)
			{
				col.c = String.fromCharCode(rnd(c_range[0], c_range[1]+1));
			}
			col.y++;
		}
	}

	// activate another column

	if (this.drop_active &lt; this.col_count)
	{
		var safety = 0;
		do
		{
			var i = rnd(0, this.col_count);
			safety++;
		}
			while (this.drop_col[i].active &amp;&amp; safety &lt; this.col_count);

		if (!this.drop_col[i].active)
		{
			initDropColumn.call(this, i);
			this.drop_active++;
		}
	}

	update.call(this);
}

function updateSpin()
{
	// activate another spinner

	if (this.spin_active &lt; this.spin_count &amp;&amp; rnd(0,100) === 0)
	{
		var safety = 0;
		do
		{
			var i = rnd(0, this.spin_count);
			safety++;
		}
			while (this.spin[i].active &amp;&amp; safety &lt; this.spin_count);

		if (!this.spin[i].active)
		{
			var x = rnd(0, this.col_count),
				y = rnd(0, this.row_count);

			this.spin[i] =
			{
				active:  true,
				counter: rnd(min_spin_count, max_spin_count),
				cell:    getCell.call(this, x, y)
			};

			this.spin_active++;
		}
	}

	// increment all active spinners

	var count   = this.spin_count,
		c_range = getCharacterRange.call(this);
	for (var i=0; i&lt;count; i++)
	{
		var spin = this.spin[i];
		if (spin.active &amp;&amp; spin.counter &lt;= 0)
		{
			spin.active = false;
			spin.cell   = null;
			this.spin_active--;
		}
		else if (spin.active)
		{
			spin.c = String.fromCharCode(rnd(c_range[0], c_range[1]+1));
			spin.counter--;
		}
	}

	update.call(this);
}

function update()
{
	var count = this.cell_on.length;
	for (var i=0; i&lt;count; i++)
	{
		Y.DOM.removeClass(this.cell_on[i], &#x27;on&#x27;);
	}
	this.cell_on = [];

	var count = this.col_count;
	for (var i=0; i&lt;count; i++)
	{
		var col = this.drop_col[i];
		if (col.active)
		{
			var cell = getCell.call(this, i, col.y);
			Y.DOM.addClass(cell, &#x27;on&#x27;);
			this.cell_on.push(cell);
			cell.innerHTML = col.c;
		}
	}

	var count = this.spin_count;
	for (var i=0; i&lt;count; i++)
	{
		var spin = this.spin[i];
		if (spin.active)
		{
			Y.DOM.addClass(spin.cell, &#x27;on&#x27;);
			this.cell_on.push(spin.cell);
			spin.cell.innerHTML = spin.c;
		}
	}
}

function updateMonospace()
{
	if (this.get(&#x27;monospace&#x27;))
	{
		this.container.addClass(&#x27;monospace&#x27;);
	}
	else
	{
		this.container.removeClass(&#x27;monospace&#x27;);
	}
}

function resize()
{
	if (this.is_body)
	{
		this.container.setStyles(
		{
			width:  Y.DOM.winWidth() + &#x27;px&#x27;,
			height: Y.DOM.winHeight() + &#x27;px&#x27;
		});
	}
	else
	{
		var host = this.get(&#x27;host&#x27;);
		this.container.setStyles(
		{
			width:  host.getStyle(&#x27;width&#x27;),
			height: host.getStyle(&#x27;height&#x27;)
		});
	}

	renderTable.call(this);
}

Y.extend(MatrixBackground, Y.Plugin.Base,
{
	initializer: function(config)
	{
		var host = this.get(&#x27;host&#x27;);
		host.removeClass(&#x27;yui3-matrixbkgd-loading&#x27;);

		this.container = Y.Node.create(&#x27;&lt;div class=&quot;yui3-matrixbkgd&quot;&gt;&lt;/div&gt;&#x27;);
		host.append(this.container);

		updateMonospace.call(this);
		this.after(&#x27;charRangeChange&#x27;, renderTable);
		this.after(&#x27;monospaceChange&#x27;, updateMonospace);
		this.after(&#x27;spinFractionChange&#x27;, initSpin);

		this.on(&#x27;drop&#x27;, updateDrop);
		this.on(&#x27;spin&#x27;, updateSpin);

		if (host == Y.one(&#x27;body&#x27;))
		{
			this.is_body = true;
			Y.on(&#x27;windowresize&#x27;, resize, host, this);
		}

		this.afterHostMethod(&#x27;setStyle&#x27;, function(name, value)
		{
			if (name == &#x27;width&#x27; || name == &#x27;height&#x27;)
			{
				resize.call(this);
			}
		});

		this.afterHostMethod(&#x27;setStyles&#x27;, function(map)
		{
			if (map.width || map.height)
			{
				resize.call(this);
			}
		});

		this.afterHostMethod(&#x27;addClass&#x27;, resize);
		this.afterHostMethod(&#x27;removeClass&#x27;, resize);
		this.afterHostMethod(&#x27;replaceClass&#x27;, resize);

		resize.call(this);
	},

	destructor: function()
	{
		stopTimer.call(this, &#x27;drop&#x27;);
		stopTimer.call(this, &#x27;spin&#x27;);

		if (this.table)
		{
			this.table.destroy();
		}
	}
});

Y.namespace(&quot;Plugin&quot;);
Y.Plugin.MatrixBackground = MatrixBackground;

// for use by gallery-matrix-credits

Y.mix(Y.Plugin.MatrixBackground,
{
	rnd:        rnd,
	startTimer: startTimer,
	stopTimer:  stopTimer,

	getCharacterRange: getCharacterRange
});

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
