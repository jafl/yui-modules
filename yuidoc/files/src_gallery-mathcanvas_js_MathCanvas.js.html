<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/gallery-mathcanvas/js/MathCanvas.js - YUI 3 Gallery Modules</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="YUI 3 Gallery Modules" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Accordion.html">Accordion</a></li>
                                <li><a href="../classes/AnimSequence.html">AnimSequence</a></li>
                                <li><a href="../classes/ArrayIterator.html">ArrayIterator</a></li>
                                <li><a href="../classes/ArrayList~extras.html">ArrayList~extras</a></li>
                                <li><a href="../classes/Array~algorithms.html">Array~algorithms</a></li>
                                <li><a href="../classes/Array~funcprog-extras.html">Array~funcprog-extras</a></li>
                                <li><a href="../classes/Array~object-extras.html">Array~object-extras</a></li>
                                <li><a href="../classes/Assert.html">Assert</a></li>
                                <li><a href="../classes/AtLeastOneCheckboxGroup.html">AtLeastOneCheckboxGroup</a></li>
                                <li><a href="../classes/AtMostOneCheckboxGroup.html">AtMostOneCheckboxGroup</a></li>
                                <li><a href="../classes/BulkEditor.html">BulkEditor</a></li>
                                <li><a href="../classes/Canvas.Context2d.html">Canvas.Context2d</a></li>
                                <li><a href="../classes/CheckboxGroup.html">CheckboxGroup</a></li>
                                <li><a href="../classes/Chipper.html">Chipper</a></li>
                                <li><a href="../classes/CollapseToggle.html">CollapseToggle</a></li>
                                <li><a href="../classes/ComplexMath.html">ComplexMath</a></li>
                                <li><a href="../classes/ComplexNumber.html">ComplexNumber</a></li>
                                <li><a href="../classes/DataSource.AsyncFunction.html">DataSource.AsyncFunction</a></li>
                                <li><a href="../classes/DataSource.BulkEdit.html">DataSource.BulkEdit</a></li>
                                <li><a href="../classes/DataSource.Treeble.html">DataSource.Treeble</a></li>
                                <li><a href="../classes/DateTime.html">DateTime</a></li>
                                <li><a href="../classes/DateTimeRange.html">DateTimeRange</a></li>
                                <li><a href="../classes/DateTimeUtils.html">DateTimeUtils</a></li>
                                <li><a href="../classes/EnableIfAnyCheckboxGroup.html">EnableIfAnyCheckboxGroup</a></li>
                                <li><a href="../classes/ExpirationCache.html">ExpirationCache</a></li>
                                <li><a href="../classes/ExpressionBuilder.html">ExpressionBuilder</a></li>
                                <li><a href="../classes/FormManager.html">FormManager</a></li>
                                <li><a href="../classes/HTMLTableBulkEditor.html">HTMLTableBulkEditor</a></li>
                                <li><a href="../classes/InputPopup.html">InputPopup</a></li>
                                <li><a href="../classes/InstanceManager.html">InstanceManager</a></li>
                                <li><a href="../classes/io~multiresponse.html">io~multiresponse</a></li>
                                <li><a href="../classes/Iterable.html">Iterable</a></li>
                                <li><a href="../classes/LinkedList.html">LinkedList</a></li>
                                <li><a href="../classes/LinkedListItem.html">LinkedListItem</a></li>
                                <li><a href="../classes/LinkedListIterator.html">LinkedListIterator</a></li>
                                <li><a href="../classes/LogFilter.html">LogFilter</a></li>
                                <li><a href="../classes/Math.html">Math</a></li>
                                <li><a href="../classes/MathCanvas.html">MathCanvas</a></li>
                                <li><a href="../classes/MathCanvas.Parser.html">MathCanvas.Parser</a></li>
                                <li><a href="../classes/MathCanvas.RectList.html">MathCanvas.RectList</a></li>
                                <li><a href="../classes/MathFunction.html">MathFunction</a></li>
                                <li><a href="../classes/MathFunction.Arccosine.html">MathFunction.Arccosine</a></li>
                                <li><a href="../classes/MathFunction.Arcsine.html">MathFunction.Arcsine</a></li>
                                <li><a href="../classes/MathFunction.Arctangent.html">MathFunction.Arctangent</a></li>
                                <li><a href="../classes/MathFunction.Arctangent2.html">MathFunction.Arctangent2</a></li>
                                <li><a href="../classes/MathFunction.Conjugate.html">MathFunction.Conjugate</a></li>
                                <li><a href="../classes/MathFunction.Cosine.html">MathFunction.Cosine</a></li>
                                <li><a href="../classes/MathFunction.E.html">MathFunction.E</a></li>
                                <li><a href="../classes/MathFunction.Exponential.html">MathFunction.Exponential</a></li>
                                <li><a href="../classes/MathFunction.FunctionWithArgs.html">MathFunction.FunctionWithArgs</a></li>
                                <li><a href="../classes/MathFunction.HyperbolicCosine.html">MathFunction.HyperbolicCosine</a></li>
                                <li><a href="../classes/MathFunction.HyperbolicSine.html">MathFunction.HyperbolicSine</a></li>
                                <li><a href="../classes/MathFunction.HyperbolicTangent.html">MathFunction.HyperbolicTangent</a></li>
                                <li><a href="../classes/MathFunction.I.html">MathFunction.I</a></li>
                                <li><a href="../classes/MathFunction.ImaginaryPart.html">MathFunction.ImaginaryPart</a></li>
                                <li><a href="../classes/MathFunction.InverseHyperbolicCosine.html">MathFunction.InverseHyperbolicCosine</a></li>
                                <li><a href="../classes/MathFunction.InverseHyperbolicSine.html">MathFunction.InverseHyperbolicSine</a></li>
                                <li><a href="../classes/MathFunction.InverseHyperbolicTangent.html">MathFunction.InverseHyperbolicTangent</a></li>
                                <li><a href="../classes/MathFunction.Logarithm.html">MathFunction.Logarithm</a></li>
                                <li><a href="../classes/MathFunction.Magnitude.html">MathFunction.Magnitude</a></li>
                                <li><a href="../classes/MathFunction.Max.html">MathFunction.Max</a></li>
                                <li><a href="../classes/MathFunction.Min.html">MathFunction.Min</a></li>
                                <li><a href="../classes/MathFunction.NaturalLog.html">MathFunction.NaturalLog</a></li>
                                <li><a href="../classes/MathFunction.Negate.html">MathFunction.Negate</a></li>
                                <li><a href="../classes/MathFunction.Phase.html">MathFunction.Phase</a></li>
                                <li><a href="../classes/MathFunction.Pi.html">MathFunction.Pi</a></li>
                                <li><a href="../classes/MathFunction.Product.html">MathFunction.Product</a></li>
                                <li><a href="../classes/MathFunction.Quotient.html">MathFunction.Quotient</a></li>
                                <li><a href="../classes/MathFunction.RealPart.html">MathFunction.RealPart</a></li>
                                <li><a href="../classes/MathFunction.Rotate.html">MathFunction.Rotate</a></li>
                                <li><a href="../classes/MathFunction.Sine.html">MathFunction.Sine</a></li>
                                <li><a href="../classes/MathFunction.SquareRoot.html">MathFunction.SquareRoot</a></li>
                                <li><a href="../classes/MathFunction.Sum.html">MathFunction.Sum</a></li>
                                <li><a href="../classes/MathFunction.Tangent.html">MathFunction.Tangent</a></li>
                                <li><a href="../classes/MathFunction.Value.html">MathFunction.Value</a></li>
                                <li><a href="../classes/MathFunction.Variable.html">MathFunction.Variable</a></li>
                                <li><a href="../classes/MatrixBackground.html">MatrixBackground</a></li>
                                <li><a href="../classes/MatrixCredits.html">MatrixCredits</a></li>
                                <li><a href="../classes/MRUCache.html">MRUCache</a></li>
                                <li><a href="../classes/MultiObject.html">MultiObject</a></li>
                                <li><a href="../classes/NodeList~extras2.html">NodeList~extras2</a></li>
                                <li><a href="../classes/Node~dimensions.html">Node~dimensions</a></li>
                                <li><a href="../classes/Node~event-set.html">Node~event-set</a></li>
                                <li><a href="../classes/Node~optimizations.html">Node~optimizations</a></li>
                                <li><a href="../classes/Node~scrollIntoView.html">Node~scrollIntoView</a></li>
                                <li><a href="../classes/Node~utils.html">Node~utils</a></li>
                                <li><a href="../classes/Object~extras.html">Object~extras</a></li>
                                <li><a href="../classes/PageLayout.html">PageLayout</a></li>
                                <li><a href="../classes/Paginator.ui.CurrentPageInput.html">Paginator.ui.CurrentPageInput</a></li>
                                <li><a href="../classes/Paginator.ui.CurrentPageReport.html">Paginator.ui.CurrentPageReport</a></li>
                                <li><a href="../classes/Paginator.ui.FirstPageLink.html">Paginator.ui.FirstPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.ItemRangeDropdown.html">Paginator.ui.ItemRangeDropdown</a></li>
                                <li><a href="../classes/Paginator.ui.LastPageLink.html">Paginator.ui.LastPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.NextPageLink.html">Paginator.ui.NextPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.PageLinks.html">Paginator.ui.PageLinks</a></li>
                                <li><a href="../classes/Paginator.ui.PreviousPageLink.html">Paginator.ui.PreviousPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.RowsPerPageDropdown.html">Paginator.ui.RowsPerPageDropdown</a></li>
                                <li><a href="../classes/Paginator.ui.ValidationPageLinks.html">Paginator.ui.ValidationPageLinks</a></li>
                                <li><a href="../classes/Parsers.html">Parsers</a></li>
                                <li><a href="../classes/Plugin.BusyOverlay.html">Plugin.BusyOverlay</a></li>
                                <li><a href="../classes/Plugin.ConsoleTest.html">Plugin.ConsoleTest</a></li>
                                <li><a href="../classes/Plugin.DataTableDataSourceBusy.html">Plugin.DataTableDataSourceBusy</a></li>
                                <li><a href="../classes/Plugin.DataTablePaginator.html">Plugin.DataTablePaginator</a></li>
                                <li><a href="../classes/Plugin.DataTableQuickEdit.html">Plugin.DataTableQuickEdit</a></li>
                                <li><a href="../classes/Plugin.DataTableRowExpansion.html">Plugin.DataTableRowExpansion</a></li>
                                <li><a href="../classes/Plugin.DataTableState.html">Plugin.DataTableState</a></li>
                                <li><a href="../classes/Plugin.FixedSizeAccordion.html">Plugin.FixedSizeAccordion</a></li>
                                <li><a href="../classes/Plugin.InputCalendarSync.html">Plugin.InputCalendarSync</a></li>
                                <li><a href="../classes/Plugin.Neon.html">Plugin.Neon</a></li>
                                <li><a href="../classes/Plugin.NodeFXSequence.html">Plugin.NodeFXSequence</a></li>
                                <li><a href="../classes/Plugin.OverlayForm.html">Plugin.OverlayForm</a></li>
                                <li><a href="../classes/Plugin.PageLayoutAnyWidgetModule.html">Plugin.PageLayoutAnyWidgetModule</a></li>
                                <li><a href="../classes/Plugin.PageLayoutDataTableModule.html">Plugin.PageLayoutDataTableModule</a></li>
                                <li><a href="../classes/Popup.html">Popup</a></li>
                                <li><a href="../classes/QueryBuilder.html">QueryBuilder</a></li>
                                <li><a href="../classes/QueryBuilder.DateRange.html">QueryBuilder.DateRange</a></li>
                                <li><a href="../classes/QueryBuilder.MultiselectInput.html">QueryBuilder.MultiselectInput</a></li>
                                <li><a href="../classes/QueryBuilder.Select.html">QueryBuilder.Select</a></li>
                                <li><a href="../classes/QueryBuilder.String.html">QueryBuilder.String</a></li>
                                <li><a href="../classes/RPC.Mojito.html">RPC.Mojito</a></li>
                                <li><a href="../classes/SelectAllCheckboxGroup.html">SelectAllCheckboxGroup</a></li>
                                <li><a href="../classes/Sort.html">Sort</a></li>
                                <li><a href="../classes/Treeble.html">Treeble</a></li>
                                <li><a href="../classes/YUI~funcprog.html">YUI~funcprog</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/gallery-accordion-horiz-vert.html">gallery-accordion-horiz-vert</a></li>
                                <li><a href="../modules/gallery-adobe-air-config.html">gallery-adobe-air-config</a></li>
                                <li><a href="../modules/gallery-adobe-air-page-manager.html">gallery-adobe-air-page-manager</a></li>
                                <li><a href="../modules/gallery-adobe-air-prefs.html">gallery-adobe-air-prefs</a></li>
                                <li><a href="../modules/gallery-algorithms.html">gallery-algorithms</a></li>
                                <li><a href="../modules/gallery-anim-class.html">gallery-anim-class</a></li>
                                <li><a href="../modules/gallery-anim-sequence.html">gallery-anim-sequence</a></li>
                                <li><a href="../modules/gallery-bulkedit.html">gallery-bulkedit</a></li>
                                <li><a href="../modules/gallery-busyoverlay.html">gallery-busyoverlay</a></li>
                                <li><a href="../modules/gallery-canvas.html">gallery-canvas</a></li>
                                <li><a href="../modules/gallery-checkboxgroups.html">gallery-checkboxgroups</a></li>
                                <li><a href="../modules/gallery-chipper.html">gallery-chipper</a></li>
                                <li><a href="../modules/gallery-collapse-toggle.html">gallery-collapse-toggle</a></li>
                                <li><a href="../modules/gallery-complexnumber.html">gallery-complexnumber</a></li>
                                <li><a href="../modules/gallery-console-test.html">gallery-console-test</a></li>
                                <li><a href="../modules/gallery-datasource-async-function.html">gallery-datasource-async-function</a></li>
                                <li><a href="../modules/gallery-datatable-datasource-busy.html">gallery-datatable-datasource-busy</a></li>
                                <li><a href="../modules/gallery-datatable-paginator.html">gallery-datatable-paginator</a></li>
                                <li><a href="../modules/gallery-datatable-row-expansion.html">gallery-datatable-row-expansion</a></li>
                                <li><a href="../modules/gallery-datatable-state.html">gallery-datatable-state</a></li>
                                <li><a href="../modules/gallery-datetime.html">gallery-datetime</a></li>
                                <li><a href="../modules/gallery-datetime-range.html">gallery-datetime-range</a></li>
                                <li><a href="../modules/gallery-datetime-utils.html">gallery-datetime-utils</a></li>
                                <li><a href="../modules/gallery-dimensions.html">gallery-dimensions</a></li>
                                <li><a href="../modules/gallery-expiration-cache.html">gallery-expiration-cache</a></li>
                                <li><a href="../modules/gallery-exprbuilder.html">gallery-exprbuilder</a></li>
                                <li><a href="../modules/gallery-formmgr.html">gallery-formmgr</a></li>
                                <li><a href="../modules/gallery-formmgr-css-validation.html">gallery-formmgr-css-validation</a></li>
                                <li><a href="../modules/gallery-formmgr-overlay-plugin.html">gallery-formmgr-overlay-plugin</a></li>
                                <li><a href="../modules/gallery-funcprog.html">gallery-funcprog</a></li>
                                <li><a href="../modules/gallery-input-calendar-sync.html">gallery-input-calendar-sync</a></li>
                                <li><a href="../modules/gallery-instancemanager.html">gallery-instancemanager</a></li>
                                <li><a href="../modules/gallery-io-adobe-air.html">gallery-io-adobe-air</a></li>
                                <li><a href="../modules/gallery-io-multiresponse.html">gallery-io-multiresponse</a></li>
                                <li><a href="../modules/gallery-iterable-extras.html">gallery-iterable-extras</a></li>
                                <li><a href="../modules/gallery-layout.html">gallery-layout</a></li>
                                <li><a href="../modules/gallery-layout-anywidget.html">gallery-layout-anywidget</a></li>
                                <li><a href="../modules/gallery-layout-cols.html">gallery-layout-cols</a></li>
                                <li><a href="../modules/gallery-layout-datatable.html">gallery-layout-datatable</a></li>
                                <li><a href="../modules/gallery-layout-rows.html">gallery-layout-rows</a></li>
                                <li><a href="../modules/gallery-linkedlist.html">gallery-linkedlist</a></li>
                                <li><a href="../modules/gallery-log-filter.html">gallery-log-filter</a></li>
                                <li><a href="../modules/gallery-math.html">gallery-math</a></li>
                                <li><a href="../modules/gallery-mathcanvas.html">gallery-mathcanvas</a></li>
                                <li><a href="../modules/gallery-matrix-background.html">gallery-matrix-background</a></li>
                                <li><a href="../modules/gallery-matrix-credits.html">gallery-matrix-credits</a></li>
                                <li><a href="../modules/gallery-mojito-rpc.html">gallery-mojito-rpc</a></li>
                                <li><a href="../modules/gallery-mru-cache.html">gallery-mru-cache</a></li>
                                <li><a href="../modules/gallery-multiobject.html">gallery-multiobject</a></li>
                                <li><a href="../modules/gallery-neon.html">gallery-neon</a></li>
                                <li><a href="../modules/gallery-node-event-set.html">gallery-node-event-set</a></li>
                                <li><a href="../modules/gallery-node-optimizations.html">gallery-node-optimizations</a></li>
                                <li><a href="../modules/gallery-node-utils.html">gallery-node-utils</a></li>
                                <li><a href="../modules/gallery-nodelist-extras2.html">gallery-nodelist-extras2</a></li>
                                <li><a href="../modules/gallery-object-extras.html">gallery-object-extras</a></li>
                                <li><a href="../modules/gallery-paginator.html">gallery-paginator</a></li>
                                <li><a href="../modules/gallery-popup.html">gallery-popup</a></li>
                                <li><a href="../modules/gallery-querybuilder.html">gallery-querybuilder</a></li>
                                <li><a href="../modules/gallery-querybuilder-daterange.html">gallery-querybuilder-daterange</a></li>
                                <li><a href="../modules/gallery-querybuilder-multiselect-input.html">gallery-querybuilder-multiselect-input</a></li>
                                <li><a href="../modules/gallery-quickedit.html">gallery-quickedit</a></li>
                                <li><a href="../modules/gallery-scrollintoview.html">gallery-scrollintoview</a></li>
                                <li><a href="../modules/gallery-sort-extras.html">gallery-sort-extras</a></li>
                                <li><a href="../modules/gallery-table-utils.html">gallery-table-utils</a></li>
                                <li><a href="../modules/gallery-test-extras.html">gallery-test-extras</a></li>
                                <li><a href="../modules/gallery-treeble.html">gallery-treeble</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/gallery-mathcanvas/js/MathCanvas.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * @module gallery-mathcanvas
 */

/**********************************************************************
 * Displays an arithmetical expression the way you would write it on paper.
 * 
 * @main gallery-mathcanvas
 * @class MathCanvas
 * @extends Widget
 * @constructor
 * @param config {Object} Widget configuration
 */
function MathCanvas(
	/* object */	config)
{
	MathCanvas.superclass.constructor.call(this, config);
}

MathCanvas.NAME = &quot;MathCanvas&quot;;

MathCanvas.ATTRS =
{
	/**
	 * The function to display.
	 * 
	 * @attribute func
	 * @type {Y.MathFunction|String}
	 */
	func:
	{
		value: new Y.MathFunction.Value(0),
		setter: function(value)
		{
			return Y.Lang.isString(value) ?
				Y.MathCanvas.Parser.parse(value) : value;
		}
	},

	/**
	 * The font name to use.
	 * 
	 * @attribute fontName
	 * @type {String}
	 */
	fontName:
	{
		value:     &#x27;sans-serif&#x27;,
		validator: Y.Lang.isString
	},

	/**
	 * The font size to use, in em&#x27;s.
	 * 
	 * @attribute fontSize
	 * @type {number}
	 */
	fontSize:
	{
		value:     1,
		validator: Y.Lang.isNumber
	},

	/**
	 * The minimum width of the canvas.  If the expression is wider, the
	 * width will increase to fit.
	 * 
	 * @attribute minWidth
	 * @type {Integer}
	 */
	minWidth:
	{
		value:     100,
		validator: Y.Lang.isNumber
	},

	/**
	 * The minimum height of the canvas.  If the expression is taller, the
	 * height will increase to fit.
	 * 
	 * @attribute minHeight
	 * @type {Integer}
	 */
	minHeight:
	{
		value:     100,
		validator: Y.Lang.isNumber
	}
};

function setSize(
	/* width/height */	type)
{
	var c = type.charAt(0).toUpperCase() + type.substr(1);
	var v = Math.max(this.get(&#x27;min&#x27;+c), this[ &#x27;render_&#x27;+type ]+5);
	this.set(type, v+&#x27;px&#x27;);
	this.canvas.setAttribute(type, v);
}

Y.extend(MathCanvas, Y.Widget,
{
	initializer: function(config)
	{
		this.after(&#x27;funcChange&#x27;, function()
		{
			this.selection = -1;
			this._renderExpression();
		});
		this.after(&#x27;fontNameChange&#x27;, this._renderExpression);
		this.after(&#x27;fontSizeChange&#x27;, this._renderExpression);
		this.after(&#x27;minWidthChange&#x27;, this._renderExpression);
		this.after(&#x27;minHeightChange&#x27;, this._renderExpression);

		// http://www.thegalaxytabforum.com/index.php?/topic/621-detecting-android-tablets-with-javascript

		var agent    = navigator.userAgent.toLowerCase();
		var platform = navigator.platform;
		// We need to eliminate Symbian, Series 60, Windows Mobile and Blackberry
		// browsers for this quick and dirty check. This can be done with the user agent.
		var otherBrowser = agent.indexOf(&quot;series60&quot;)   != -1 ||
						   agent.indexOf(&quot;symbian&quot;)    != -1 ||
						   agent.indexOf(&quot;windows ce&quot;) != -1 ||
						   agent.indexOf(&quot;blackberry&quot;) != -1;
		// If the screen orientation is defined we are in a modern mobile OS
		var mobileOS = typeof orientation != &#x27;undefined&#x27;;
		// If touch events are defined we are in a modern touch screen OS
		var touchOS = &#x27;ontouchstart&#x27; in document.documentElement;
		// iPhone and iPad can be reliably identified with the navigator.platform
		// string, which is currently only available on these devices.
		var iOS = platform.indexOf(&quot;iPhone&quot;) != -1 || platform.indexOf(&quot;iPad&quot;) != -1;
		// If the user agent string contains &quot;android&quot; then it&#x27;s Android. If it
		// doesn&#x27;t but it&#x27;s not another browser, not an iOS device and we&#x27;re in
		// a mobile and touch OS then we can be 99% certain that it&#x27;s Android.
		var android = agent.indexOf(&quot;android&quot;) != -1 || (!iOS &amp;&amp; !otherBrowser &amp;&amp; touchOS &amp;&amp; mobileOS);

		 // navigator.platform doesn&#x27;t work for iPhoney
		this.touch = touchOS || agent.indexOf(&quot;iphone&quot;) != -1;
	},

	renderUI: function()
	{
		var container = this.get(&#x27;contentBox&#x27;);

		var w = this.get(&#x27;minWidth&#x27;);
		this.set(&#x27;width&#x27;, w+&#x27;px&#x27;);

		var h = this.get(&#x27;minHeight&#x27;);
		this.set(&#x27;height&#x27;, w+&#x27;px&#x27;);

		this.canvas = Y.Node.create(
			&#x27;&lt;canvas width=&quot;&#x27; + w + &#x27;&quot; height=&quot;&#x27; + h + &#x27;&quot; tabindex=&quot;0&quot;&gt;&lt;/canvas&gt;&#x27;);
		if (!this.canvas)
		{
			throw Error(&quot;This browser does not support canvas rendering.&quot;);
		}

		container.appendChild(this.canvas);

		this.context = new Y.Canvas.Context2d(this.canvas);
		Y.mix(this.context, math_rendering);
		this.context.math_canvas = this;

		this._renderExpression();

		// input (for mobile)

		function buttonRow(list)
		{
			var s = Y.Array.reduce(list, &#x27;&#x27;, function(s, obj)
			{
				return s + Y.Lang.sub(&#x27;&lt;button type=&quot;button&quot; class=&quot;keyboard-{value}&quot; value=&quot;{value}&quot;&gt;{label}&lt;/button&gt;&#x27;,
				{
					value: obj.value || obj,
					label: obj.label || obj
				});
			});

			return &#x27;&lt;p&gt;&#x27; + s + &#x27;&lt;/p&gt;&#x27;;
		}

		if (this.touch || YUI.config.debug_mathcanvas_keyboard)
		{
			this.keyboard = Y.Node.create(
				&#x27;&lt;div class=&quot;keyboard&quot;&gt;&#x27; +
					buttonRow([1,2,3,4,5,6,7,8,9,0]) +
					buttonRow([&#x27;+&#x27;, {value:&#x27;-&#x27;,label:&#x27;&amp;ndash;&#x27;}, {value:&#x27;*&#x27;,label:&#x27;&amp;times;&#x27;}, &#x27;/&#x27;, &#x27;^&#x27;, &#x27;|&#x27;, &#x27;,&#x27;, &#x27;e&#x27;, &#x27;\u03c0&#x27;, &#x27;.&#x27;]) +
					&#x27;&lt;p class=&quot;last&quot;&gt;&#x27; +
						&#x27;&lt;button type=&quot;button&quot; class=&quot;keyboard-hide&quot; value=&quot;hide&quot; title=&quot;Hide keyboard&quot;&gt;&amp;dArr;&lt;/button&gt;&#x27; +
						&#x27;&lt;button type=&quot;button&quot; class=&quot;keyboard-eval&quot; value=&quot;=&quot; title=&quot;Evaluate expression&quot;&gt;=&lt;/button&gt;&#x27; +
						&#x27;&lt;button type=&quot;button&quot; class=&quot;keyboard-delete&quot; value=&quot;delete&quot; title=&quot;Delete selection&quot;&gt;&amp;empty;&lt;/button&gt;&#x27; +
						&#x27;&lt;button type=&quot;button&quot; class=&quot;keyboard-expand&quot; value=&quot;expand&quot; title=&quot;Expand selection&quot;&gt;&amp;hArr;&lt;/button&gt;&#x27; +
						&#x27;&lt;select class=&quot;keyboard-func&quot;&gt;&#x27; +
							&#x27;&lt;option&gt;Functions&lt;/option&gt;&#x27; +
							&#x27;&lt;optgroup&gt;&#x27; +
								&#x27;&lt;option&gt;abs&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;arccos&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;arcsin&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;arctan&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;arctan2&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;conjugate&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;cos&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;cosh&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;sinh&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;tanh&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;imag&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;arccosh&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;arcsinh&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;arctanh&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;log&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;max&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;min&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;ln&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;phase&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;real&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;rotate&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;sin&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;sqrt&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;tan&lt;/option&gt;&#x27; +
							&#x27;&lt;/optgroup&gt;&#x27; +
						&#x27;&lt;/select&gt;&#x27; +
						&#x27;&lt;br&gt;&#x27; +
						&#x27;&lt;select class=&quot;keyboard-const&quot;&gt;&#x27; +
							&#x27;&lt;option&gt;Constants&lt;/option&gt;&#x27; +
							&#x27;&lt;optgroup&gt;&#x27; +
								&#x27;&lt;option&gt;c&lt;/option&gt;&#x27; +
								&#x27;&lt;option&gt;g&lt;/option&gt;&#x27; +
							&#x27;&lt;/optgroup&gt;&#x27; +
						&#x27;&lt;/select&gt;&#x27; +
					&#x27;&lt;/p&gt;&#x27; +
				&#x27;&lt;/div&gt;&#x27;
			);
			container.appendChild(this.keyboard);

			this.keyboard.setStyle(&#x27;bottom&#x27;, (-this.keyboard.get(&#x27;offsetHeight&#x27;))+&#x27;px&#x27;);
		}
	},

	bindUI: function()
	{
		this.canvas.on(&#x27;mousedown&#x27;, function(e)
		{
			function select(e)
			{
				var xy = this.canvas.getXY();
				var pt =
				[
					Math.round(e.pageX - xy[0]) - offset[0],
					Math.round(e.pageY - xy[1]) - offset[1]
				];

				this.selection = this.rect_list.getSelection(anchor, pt);
				this._renderExpression();
			}

			var bounds = this.rect_list.getBounds();
			var offset =
			[
				Math.floor((this.canvas.getAttribute(&#x27;width&#x27;) - RectList.width(bounds)) / 2),
				Math.floor((this.canvas.getAttribute(&#x27;height&#x27;) - RectList.height(bounds)) / 2)
			];

			var xy = this.canvas.getXY();
			var anchor =
			[
				Math.round(e.pageX - xy[0]) - offset[0],
				Math.round(e.pageY - xy[1]) - offset[1]
			];

			select.call(this, e);
			var handler = this.canvas.on(&#x27;mousemove&#x27;, select, this);

			Y.one(Y.config.doc).once(&#x27;mouseup&#x27;, function(e)
			{
				handler.detach();
				if (this.selection &gt;= 0)
				{
					this.showKeyboard();
				}
				else
				{
					this.hideKeyboard();
				}
			},
			this);
		},
		this);

		this.canvas.on(&#x27;keydown&#x27;, function(e)
		{
//			console.log(e.charCode);

			if (e.charCode == 32)
			{
				this.expandSelection();
			}
			else if (e.charCode == 8)
			{
				this.deleteSelection();
			}
		},
		this);

		if (this.keyboard)
		{
			this.keyboard.delegate(&#x27;click&#x27;, function(e)
			{
				var op = e.currentTarget.get(&#x27;value&#x27;);
				if (op == &#x27;hide&#x27;)
				{
					this.hideKeyboard();
				}
				else if (op == &#x27;expand&#x27;)
				{
					this.expandSelection();
				}
				else if (op == &#x27;delete&#x27;)
				{
					this.deleteSelection();
				}
				else if (op == &#x27;=&#x27;)
				{
					this.fire(&#x27;evaluate&#x27;);
					this.hideKeyboard();
				}
			},
			&#x27;button&#x27;, this);

			this.keyboard.one(&#x27;.keyboard-func&#x27;).on(&#x27;change&#x27;, function(e)
			{
				this.set(&#x27;selectedIndex&#x27;, 0);
			});

			this.keyboard.one(&#x27;.keyboard-const&#x27;).on(&#x27;change&#x27;, function(e)
			{
				this.set(&#x27;selectedIndex&#x27;, 0);
			});
		}
	},

	destructor: function()
	{
		this.canvas  = null;
		this.context = null;
	},

	/**
	 * Shows touch keyboard.
	 * 
	 * @method showKeyboard
	 */
	showKeyboard: function()
	{
		if (!this.keyboard)
		{
			return;
		}

		if (this.keyboard_anim)
		{
			this.keyboard_anim.stop();
		}

		this.keyboard_anim = new Y.Anim(
		{
			node: this.keyboard,
			to:
			{
				bottom: 0
			},
			easing:   Y.Easing.easeOut,
			duration: 0.5
		});

		this.keyboard_anim.run();
	},

	/**
	 * Hides touch keyboard.
	 * 
	 * @method hideKeyboard
	 */
	hideKeyboard: function()
	{
		if (!this.keyboard)
		{
			return;
		}

		if (this.keyboard_anim)
		{
			this.keyboard_anim.stop();
		}

		this.keyboard_anim = new Y.Anim(
		{
			node: this.keyboard,
			to:
			{
				bottom: -this.keyboard.get(&#x27;offsetHeight&#x27;)
			},
			easing:   Y.Easing.easeOut,
			duration: 0.5
		});

		this.keyboard_anim.run();
	},

	/**
	 * Expands the selection up one level of the parse tree.
	 * 
	 * @method expandSelection
	 */
	expandSelection: function()
	{
		if (this.selection &gt;= 0)
		{
			var p = this.rect_list.get(this.selection).func.getParent();
			if (p)
			{
				this.selection = this.rect_list.findIndex(p);
				this._renderExpression();
			}
		}
	},

	/**
	 * Deletes the selected sub-expression.
	 * 
	 * @method deleteSelection
	 */
	deleteSelection: function()
	{
		if (this.selection &gt;= 0)
		{
			this.deleteFunction(this.rect_list.get(this.selection).func);
		}
	},

	/**
	 * @method deleteFunction
	 * @param f {MathFunction} function to remove from the overall expression
	 */
	deleteFunction: function(
		/* MathFunction */ f)
	{
		var p = f.getParent();
		var s = p;
		if (!p)
		{
			this.selection = 0;
			this.set(&#x27;func&#x27;, &#x27;0&#x27;);
			return;
		}
		else if (p.getArgCount() == 1)
		{
			this.deleteFunction(p);
			return;
		}
		else if (p.getArgCount() == 2)
		{
			var s  = (p.getArg(0) == f ? p.getArg(1) : p.getArg(0));
			var p1 = p.getParent();
			if (p1)
			{
				p1.replaceArg(p, s);
			}
			else
			{
				this.selection = -1;
				s.parent       = null;
				this.set(&#x27;func&#x27;, s);
			}
		}
		else
		{
			p.removeArg(f);
		}

		this.selection = -1;
		this._renderExpression();	// update rect_list
		this.selection = this.rect_list.findIndex(s);
		this._renderExpression();
	},

	/**
	 * Renders the expression.
	 * 
	 * @method _renderExpression
	 * @protected
	 */
	_renderExpression: function()
	{
		this.context.clearRect(0,0,
			this.canvas.getAttribute(&#x27;width&#x27;),
			this.canvas.getAttribute(&#x27;height&#x27;));

		var f = this.get(&#x27;func&#x27;);
		if (!f)
		{
			return;
		}

		this.rect_list = new RectList();

		var top_left = { x:0, y:0 };
		f.prepareToRender(this.context, top_left, 100, this.rect_list);

		var bounds = this.rect_list.getBounds();

		this.render_width  = RectList.width(bounds);
		setSize.call(this, &#x27;width&#x27;);

		this.render_height = RectList.height(bounds);
		setSize.call(this, &#x27;height&#x27;);

		this.context.save();
		this.context.translate(
			Math.floor((this.canvas.getAttribute(&#x27;width&#x27;) - RectList.width(bounds)) / 2),
			Math.floor((this.canvas.getAttribute(&#x27;height&#x27;) - RectList.height(bounds)) / 2));

		if (this.selection &gt;= 0)
		{
			var r = this.rect_list.get(this.selection).rect;
			this.context.save();
			this.context.set(&#x27;fillStyle&#x27;, &#x27;#99FFFF&#x27;);
			this.context.fillRect(r.left, r.top, RectList.width(r), RectList.height(r));
			this.context.restore();
		}

		f.render(this.context, this.rect_list);

		this.context.restore();
	}
});

var paren_angle = Math.PI/6;	// 30 degrees

var math_rendering =
{
	drawString: function(
		/* int */			left,
		/* int */			midline,
		/* percentage */	font_size,
		/* string */		s)
	{
		var h = this.getLineHeight(font_size);
		this._setFont(font_size);
		this.set(&#x27;textBaseline&#x27;, &#x27;top&#x27;);
		this.fillText(s, left, Math.floor(midline - h/2));
	},

	getLineHeight: function(
		/* percentage */	font_size)
	{
		return (13 * this.math_canvas.get(&#x27;fontSize&#x27;) * font_size/100.0);
	},

	getStringWidth: function(
		/* percentage */	font_size,
		/* string */		text)
	{
		this.save();
		this._setFont(font_size);
		var w = this.measureText(text).width;
		this.restore();
		return w;
	},

	_setFont: function(
		/* percentage */	font_size)
	{
		this.set(&#x27;font&#x27;,
			(this.math_canvas.get(&#x27;fontSize&#x27;) * font_size/100.0) + &#x27;em &#x27; +
			 this.math_canvas.get(&#x27;fontName&#x27;));
	},

	getSuperSubFontSize: function(
		/* percentage */	font_size)
	{
		var v = font_size * 0.6;
		return Math.max(v, 40);
	},

	getSuperscriptHeight: function(
		/* rect */	r)
	{
		return RectList.height(r)/2;
	},

	getSubscriptDepth: function(
		/* rect */	r)
	{
		return RectList.height(r)/2;
	},

	drawSquareBrackets: function(
		/* rect */	r)
	{
		var h = r.bottom - r.top;
		var w = this.getSquareBracketWidth(r)-2;

		this.moveTo(r.left-2, r.top);
		this.line(-w,0);
		this.line(0,h-1);
		this.line(w,0);
		this.stroke();

		this.moveTo(r.right+1, r.top);
		this.line(w,0);
		this.line(0,h-1);
		this.line(-w,0);
		this.stroke();
	},

	getSquareBracketWidth: function(
		/* rect */	r)
	{
		var h = r.bottom - r.top;
		return Math.round(3+((h-1)/10));
	},

	drawParentheses: function(
		/* rect */	r)
	{
		var h       = r.bottom - r.top;
		var radius  = h/(2.0*Math.sin(paren_angle));
		var radius1 = Math.round(radius);
		var yc      = RectList.ycenter(r);
		var pw      = this.getParenthesisWidth(r);

		this.beginPath();
		this.arc(r.left - pw + radius, yc, radius1, Math.PI-paren_angle, Math.PI+paren_angle, false);
		this.stroke();

		this.beginPath();
		this.arc(r.right + pw - radius, yc, radius1, paren_angle, -paren_angle, true);
		this.stroke();
	},

	getParenthesisWidth: function(
		/* rect */	r)
	{
		var h = r.bottom - r.top;
		return 2+Math.round(0.5 + (h * (1.0 - Math.cos(paren_angle)))/(2.0 * Math.sin(paren_angle)));
	},

	drawVerticalBar: function(
		/* rect */	r)
	{
		this.moveTo(r.left+1, r.top);
		this.lineTo(r.left+1, r.bottom);
		this.stroke();
	},

	getVerticalBarWidth: function()
	{
		return 3;
	},

	drawHorizontalBar: function(
		/* rect */	r)
	{
		var y = r.top+1;
		this.moveTo(r.left, y);
		this.lineTo(r.right-1, y);
		this.stroke();
	},

	getHorizontalBarHeight: function()
	{
		return 3;
	}
};

MathParser.yy.MathFunction = Y.MathFunction;

Y.MathCanvas          = MathCanvas;
Y.MathCanvas.RectList = RectList;
Y.MathCanvas.Parser   = MathParser;

/**********************************************************************
 * Parser used to convert a string expression into Y.MathFunction
 * 
 * @class Parser
 * @namespace MathCanvas
 */

/**
 * Parses a string into a Y.MathFunction.
 * 
 * @method parse
 * @static
 * @param expr {String} expression to parse
 * @return {MathFunction}
 */

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
