<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/gallery-querybuilder/js/QueryBuilder.js - YUI 3 Gallery Modules</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="YUI 3 Gallery Modules" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Accordion.html">Accordion</a></li>
                                <li><a href="../classes/AnimSequence.html">AnimSequence</a></li>
                                <li><a href="../classes/ArrayIterator.html">ArrayIterator</a></li>
                                <li><a href="../classes/ArrayList~extras.html">ArrayList~extras</a></li>
                                <li><a href="../classes/Array~algorithms.html">Array~algorithms</a></li>
                                <li><a href="../classes/Array~funcprog-extras.html">Array~funcprog-extras</a></li>
                                <li><a href="../classes/Array~object-extras.html">Array~object-extras</a></li>
                                <li><a href="../classes/Assert.html">Assert</a></li>
                                <li><a href="../classes/AtLeastOneCheckboxGroup.html">AtLeastOneCheckboxGroup</a></li>
                                <li><a href="../classes/AtMostOneCheckboxGroup.html">AtMostOneCheckboxGroup</a></li>
                                <li><a href="../classes/BulkEditor.html">BulkEditor</a></li>
                                <li><a href="../classes/Canvas.Context2d.html">Canvas.Context2d</a></li>
                                <li><a href="../classes/CheckboxGroup.html">CheckboxGroup</a></li>
                                <li><a href="../classes/Chipper.html">Chipper</a></li>
                                <li><a href="../classes/CollapseToggle.html">CollapseToggle</a></li>
                                <li><a href="../classes/ComplexMath.html">ComplexMath</a></li>
                                <li><a href="../classes/ComplexNumber.html">ComplexNumber</a></li>
                                <li><a href="../classes/DataSource.AsyncFunction.html">DataSource.AsyncFunction</a></li>
                                <li><a href="../classes/DataSource.BulkEdit.html">DataSource.BulkEdit</a></li>
                                <li><a href="../classes/DataSource.Treeble.html">DataSource.Treeble</a></li>
                                <li><a href="../classes/DateTime.html">DateTime</a></li>
                                <li><a href="../classes/DateTimeRange.html">DateTimeRange</a></li>
                                <li><a href="../classes/DateTimeUtils.html">DateTimeUtils</a></li>
                                <li><a href="../classes/EnableIfAnyCheckboxGroup.html">EnableIfAnyCheckboxGroup</a></li>
                                <li><a href="../classes/ExpirationCache.html">ExpirationCache</a></li>
                                <li><a href="../classes/ExpressionBuilder.html">ExpressionBuilder</a></li>
                                <li><a href="../classes/FormManager.html">FormManager</a></li>
                                <li><a href="../classes/HTMLTableBulkEditor.html">HTMLTableBulkEditor</a></li>
                                <li><a href="../classes/InputPopup.html">InputPopup</a></li>
                                <li><a href="../classes/InstanceManager.html">InstanceManager</a></li>
                                <li><a href="../classes/io~multiresponse.html">io~multiresponse</a></li>
                                <li><a href="../classes/Iterable.html">Iterable</a></li>
                                <li><a href="../classes/LinkedList.html">LinkedList</a></li>
                                <li><a href="../classes/LinkedListItem.html">LinkedListItem</a></li>
                                <li><a href="../classes/LinkedListIterator.html">LinkedListIterator</a></li>
                                <li><a href="../classes/LogFilter.html">LogFilter</a></li>
                                <li><a href="../classes/Math.html">Math</a></li>
                                <li><a href="../classes/MathCanvas.html">MathCanvas</a></li>
                                <li><a href="../classes/MathCanvas.Parser.html">MathCanvas.Parser</a></li>
                                <li><a href="../classes/MathCanvas.RectList.html">MathCanvas.RectList</a></li>
                                <li><a href="../classes/MathFunction.html">MathFunction</a></li>
                                <li><a href="../classes/MathFunction.Arccosine.html">MathFunction.Arccosine</a></li>
                                <li><a href="../classes/MathFunction.Arcsine.html">MathFunction.Arcsine</a></li>
                                <li><a href="../classes/MathFunction.Arctangent.html">MathFunction.Arctangent</a></li>
                                <li><a href="../classes/MathFunction.Arctangent2.html">MathFunction.Arctangent2</a></li>
                                <li><a href="../classes/MathFunction.Conjugate.html">MathFunction.Conjugate</a></li>
                                <li><a href="../classes/MathFunction.Cosine.html">MathFunction.Cosine</a></li>
                                <li><a href="../classes/MathFunction.E.html">MathFunction.E</a></li>
                                <li><a href="../classes/MathFunction.Exponential.html">MathFunction.Exponential</a></li>
                                <li><a href="../classes/MathFunction.FunctionWithArgs.html">MathFunction.FunctionWithArgs</a></li>
                                <li><a href="../classes/MathFunction.HyperbolicCosine.html">MathFunction.HyperbolicCosine</a></li>
                                <li><a href="../classes/MathFunction.HyperbolicSine.html">MathFunction.HyperbolicSine</a></li>
                                <li><a href="../classes/MathFunction.HyperbolicTangent.html">MathFunction.HyperbolicTangent</a></li>
                                <li><a href="../classes/MathFunction.I.html">MathFunction.I</a></li>
                                <li><a href="../classes/MathFunction.ImaginaryPart.html">MathFunction.ImaginaryPart</a></li>
                                <li><a href="../classes/MathFunction.Input.html">MathFunction.Input</a></li>
                                <li><a href="../classes/MathFunction.InverseHyperbolicCosine.html">MathFunction.InverseHyperbolicCosine</a></li>
                                <li><a href="../classes/MathFunction.InverseHyperbolicSine.html">MathFunction.InverseHyperbolicSine</a></li>
                                <li><a href="../classes/MathFunction.InverseHyperbolicTangent.html">MathFunction.InverseHyperbolicTangent</a></li>
                                <li><a href="../classes/MathFunction.Logarithm.html">MathFunction.Logarithm</a></li>
                                <li><a href="../classes/MathFunction.Magnitude.html">MathFunction.Magnitude</a></li>
                                <li><a href="../classes/MathFunction.Max.html">MathFunction.Max</a></li>
                                <li><a href="../classes/MathFunction.Min.html">MathFunction.Min</a></li>
                                <li><a href="../classes/MathFunction.NaturalLog.html">MathFunction.NaturalLog</a></li>
                                <li><a href="../classes/MathFunction.Negate.html">MathFunction.Negate</a></li>
                                <li><a href="../classes/MathFunction.Phase.html">MathFunction.Phase</a></li>
                                <li><a href="../classes/MathFunction.Pi.html">MathFunction.Pi</a></li>
                                <li><a href="../classes/MathFunction.Product.html">MathFunction.Product</a></li>
                                <li><a href="../classes/MathFunction.Quotient.html">MathFunction.Quotient</a></li>
                                <li><a href="../classes/MathFunction.RealPart.html">MathFunction.RealPart</a></li>
                                <li><a href="../classes/MathFunction.Rotate.html">MathFunction.Rotate</a></li>
                                <li><a href="../classes/MathFunction.Sine.html">MathFunction.Sine</a></li>
                                <li><a href="../classes/MathFunction.SquareRoot.html">MathFunction.SquareRoot</a></li>
                                <li><a href="../classes/MathFunction.Sum.html">MathFunction.Sum</a></li>
                                <li><a href="../classes/MathFunction.Tangent.html">MathFunction.Tangent</a></li>
                                <li><a href="../classes/MathFunction.Value.html">MathFunction.Value</a></li>
                                <li><a href="../classes/MathFunction.Variable.html">MathFunction.Variable</a></li>
                                <li><a href="../classes/MatrixBackground.html">MatrixBackground</a></li>
                                <li><a href="../classes/MatrixCredits.html">MatrixCredits</a></li>
                                <li><a href="../classes/MRUCache.html">MRUCache</a></li>
                                <li><a href="../classes/MultiObject.html">MultiObject</a></li>
                                <li><a href="../classes/NodeList~extras2.html">NodeList~extras2</a></li>
                                <li><a href="../classes/Node~dimensions.html">Node~dimensions</a></li>
                                <li><a href="../classes/Node~event-set.html">Node~event-set</a></li>
                                <li><a href="../classes/Node~optimizations.html">Node~optimizations</a></li>
                                <li><a href="../classes/Node~scrollIntoView.html">Node~scrollIntoView</a></li>
                                <li><a href="../classes/Node~utils.html">Node~utils</a></li>
                                <li><a href="../classes/Object~extras.html">Object~extras</a></li>
                                <li><a href="../classes/PageLayout.html">PageLayout</a></li>
                                <li><a href="../classes/Paginator.ui.CurrentPageInput.html">Paginator.ui.CurrentPageInput</a></li>
                                <li><a href="../classes/Paginator.ui.CurrentPageReport.html">Paginator.ui.CurrentPageReport</a></li>
                                <li><a href="../classes/Paginator.ui.FirstPageLink.html">Paginator.ui.FirstPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.ItemRangeDropdown.html">Paginator.ui.ItemRangeDropdown</a></li>
                                <li><a href="../classes/Paginator.ui.LastPageLink.html">Paginator.ui.LastPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.NextPageLink.html">Paginator.ui.NextPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.PageLinks.html">Paginator.ui.PageLinks</a></li>
                                <li><a href="../classes/Paginator.ui.PreviousPageLink.html">Paginator.ui.PreviousPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.RowsPerPageDropdown.html">Paginator.ui.RowsPerPageDropdown</a></li>
                                <li><a href="../classes/Paginator.ui.ValidationPageLinks.html">Paginator.ui.ValidationPageLinks</a></li>
                                <li><a href="../classes/Parsers.html">Parsers</a></li>
                                <li><a href="../classes/Plugin.BusyOverlay.html">Plugin.BusyOverlay</a></li>
                                <li><a href="../classes/Plugin.ConsoleTest.html">Plugin.ConsoleTest</a></li>
                                <li><a href="../classes/Plugin.DataTableDataSourceBusy.html">Plugin.DataTableDataSourceBusy</a></li>
                                <li><a href="../classes/Plugin.DataTablePaginator.html">Plugin.DataTablePaginator</a></li>
                                <li><a href="../classes/Plugin.DataTableQuickEdit.html">Plugin.DataTableQuickEdit</a></li>
                                <li><a href="../classes/Plugin.DataTableRowExpansion.html">Plugin.DataTableRowExpansion</a></li>
                                <li><a href="../classes/Plugin.DataTableState.html">Plugin.DataTableState</a></li>
                                <li><a href="../classes/Plugin.FixedSizeAccordion.html">Plugin.FixedSizeAccordion</a></li>
                                <li><a href="../classes/Plugin.InputCalendarSync.html">Plugin.InputCalendarSync</a></li>
                                <li><a href="../classes/Plugin.Neon.html">Plugin.Neon</a></li>
                                <li><a href="../classes/Plugin.NodeFXSequence.html">Plugin.NodeFXSequence</a></li>
                                <li><a href="../classes/Plugin.OverlayForm.html">Plugin.OverlayForm</a></li>
                                <li><a href="../classes/Plugin.PageLayoutAnyWidgetModule.html">Plugin.PageLayoutAnyWidgetModule</a></li>
                                <li><a href="../classes/Plugin.PageLayoutDataTableModule.html">Plugin.PageLayoutDataTableModule</a></li>
                                <li><a href="../classes/Popup.html">Popup</a></li>
                                <li><a href="../classes/QueryBuilder.html">QueryBuilder</a></li>
                                <li><a href="../classes/QueryBuilder.DateRange.html">QueryBuilder.DateRange</a></li>
                                <li><a href="../classes/QueryBuilder.MultiselectInput.html">QueryBuilder.MultiselectInput</a></li>
                                <li><a href="../classes/QueryBuilder.Select.html">QueryBuilder.Select</a></li>
                                <li><a href="../classes/QueryBuilder.String.html">QueryBuilder.String</a></li>
                                <li><a href="../classes/RPC.Mojito.html">RPC.Mojito</a></li>
                                <li><a href="../classes/SelectAllCheckboxGroup.html">SelectAllCheckboxGroup</a></li>
                                <li><a href="../classes/Sort.html">Sort</a></li>
                                <li><a href="../classes/Treeble.html">Treeble</a></li>
                                <li><a href="../classes/YUI~funcprog.html">YUI~funcprog</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/gallery-accordion-horiz-vert.html">gallery-accordion-horiz-vert</a></li>
                                <li><a href="../modules/gallery-adobe-air-config.html">gallery-adobe-air-config</a></li>
                                <li><a href="../modules/gallery-adobe-air-page-manager.html">gallery-adobe-air-page-manager</a></li>
                                <li><a href="../modules/gallery-adobe-air-prefs.html">gallery-adobe-air-prefs</a></li>
                                <li><a href="../modules/gallery-algorithms.html">gallery-algorithms</a></li>
                                <li><a href="../modules/gallery-anim-class.html">gallery-anim-class</a></li>
                                <li><a href="../modules/gallery-anim-sequence.html">gallery-anim-sequence</a></li>
                                <li><a href="../modules/gallery-bulkedit.html">gallery-bulkedit</a></li>
                                <li><a href="../modules/gallery-busyoverlay.html">gallery-busyoverlay</a></li>
                                <li><a href="../modules/gallery-canvas.html">gallery-canvas</a></li>
                                <li><a href="../modules/gallery-checkboxgroups.html">gallery-checkboxgroups</a></li>
                                <li><a href="../modules/gallery-chipper.html">gallery-chipper</a></li>
                                <li><a href="../modules/gallery-collapse-toggle.html">gallery-collapse-toggle</a></li>
                                <li><a href="../modules/gallery-complexnumber.html">gallery-complexnumber</a></li>
                                <li><a href="../modules/gallery-console-test.html">gallery-console-test</a></li>
                                <li><a href="../modules/gallery-datasource-async-function.html">gallery-datasource-async-function</a></li>
                                <li><a href="../modules/gallery-datatable-datasource-busy.html">gallery-datatable-datasource-busy</a></li>
                                <li><a href="../modules/gallery-datatable-paginator.html">gallery-datatable-paginator</a></li>
                                <li><a href="../modules/gallery-datatable-row-expansion.html">gallery-datatable-row-expansion</a></li>
                                <li><a href="../modules/gallery-datatable-state.html">gallery-datatable-state</a></li>
                                <li><a href="../modules/gallery-datetime.html">gallery-datetime</a></li>
                                <li><a href="../modules/gallery-datetime-range.html">gallery-datetime-range</a></li>
                                <li><a href="../modules/gallery-datetime-utils.html">gallery-datetime-utils</a></li>
                                <li><a href="../modules/gallery-dimensions.html">gallery-dimensions</a></li>
                                <li><a href="../modules/gallery-expiration-cache.html">gallery-expiration-cache</a></li>
                                <li><a href="../modules/gallery-exprbuilder.html">gallery-exprbuilder</a></li>
                                <li><a href="../modules/gallery-formmgr.html">gallery-formmgr</a></li>
                                <li><a href="../modules/gallery-formmgr-css-validation.html">gallery-formmgr-css-validation</a></li>
                                <li><a href="../modules/gallery-formmgr-overlay-plugin.html">gallery-formmgr-overlay-plugin</a></li>
                                <li><a href="../modules/gallery-funcprog.html">gallery-funcprog</a></li>
                                <li><a href="../modules/gallery-input-calendar-sync.html">gallery-input-calendar-sync</a></li>
                                <li><a href="../modules/gallery-instancemanager.html">gallery-instancemanager</a></li>
                                <li><a href="../modules/gallery-io-adobe-air.html">gallery-io-adobe-air</a></li>
                                <li><a href="../modules/gallery-io-multiresponse.html">gallery-io-multiresponse</a></li>
                                <li><a href="../modules/gallery-iterable-extras.html">gallery-iterable-extras</a></li>
                                <li><a href="../modules/gallery-layout.html">gallery-layout</a></li>
                                <li><a href="../modules/gallery-layout-anywidget.html">gallery-layout-anywidget</a></li>
                                <li><a href="../modules/gallery-layout-cols.html">gallery-layout-cols</a></li>
                                <li><a href="../modules/gallery-layout-datatable.html">gallery-layout-datatable</a></li>
                                <li><a href="../modules/gallery-layout-rows.html">gallery-layout-rows</a></li>
                                <li><a href="../modules/gallery-linkedlist.html">gallery-linkedlist</a></li>
                                <li><a href="../modules/gallery-log-filter.html">gallery-log-filter</a></li>
                                <li><a href="../modules/gallery-math.html">gallery-math</a></li>
                                <li><a href="../modules/gallery-mathcanvas.html">gallery-mathcanvas</a></li>
                                <li><a href="../modules/gallery-matrix-background.html">gallery-matrix-background</a></li>
                                <li><a href="../modules/gallery-matrix-credits.html">gallery-matrix-credits</a></li>
                                <li><a href="../modules/gallery-mojito-rpc.html">gallery-mojito-rpc</a></li>
                                <li><a href="../modules/gallery-mru-cache.html">gallery-mru-cache</a></li>
                                <li><a href="../modules/gallery-multiobject.html">gallery-multiobject</a></li>
                                <li><a href="../modules/gallery-neon.html">gallery-neon</a></li>
                                <li><a href="../modules/gallery-node-event-set.html">gallery-node-event-set</a></li>
                                <li><a href="../modules/gallery-node-optimizations.html">gallery-node-optimizations</a></li>
                                <li><a href="../modules/gallery-node-utils.html">gallery-node-utils</a></li>
                                <li><a href="../modules/gallery-nodelist-extras2.html">gallery-nodelist-extras2</a></li>
                                <li><a href="../modules/gallery-object-extras.html">gallery-object-extras</a></li>
                                <li><a href="../modules/gallery-paginator.html">gallery-paginator</a></li>
                                <li><a href="../modules/gallery-popup.html">gallery-popup</a></li>
                                <li><a href="../modules/gallery-querybuilder.html">gallery-querybuilder</a></li>
                                <li><a href="../modules/gallery-querybuilder-daterange.html">gallery-querybuilder-daterange</a></li>
                                <li><a href="../modules/gallery-querybuilder-multiselect-input.html">gallery-querybuilder-multiselect-input</a></li>
                                <li><a href="../modules/gallery-quickedit.html">gallery-quickedit</a></li>
                                <li><a href="../modules/gallery-scrollintoview.html">gallery-scrollintoview</a></li>
                                <li><a href="../modules/gallery-sort-extras.html">gallery-sort-extras</a></li>
                                <li><a href="../modules/gallery-table-utils.html">gallery-table-utils</a></li>
                                <li><a href="../modules/gallery-test-extras.html">gallery-test-extras</a></li>
                                <li><a href="../modules/gallery-treeble.html">gallery-treeble</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/gallery-querybuilder/js/QueryBuilder.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&quot;use strict&quot;;

var has_bubble_problem = (0 &lt; Y.UA.ie &amp;&amp; Y.UA.ie &lt; 9);

/**********************************************************************
 * Widget which allows user to build a list of query criteria, e.g., for
 * searching.  All the conditions are either AND&#x27;ed or OR&#x27;ed.  For a more
 * general query builder, see gallery-exprbuilder.
 * 
 * @main gallery-querybuilder
 * @module gallery-querybuilder
 */

/**
 * &lt;p&gt;The default package provides two data types:  String (which can also
 * be used for numbers) and Select (which provides a menu of options).  The
 * plugin API allows defining additional data types, e.g., date range or
 * multi-select.  Every plugin must be registered in
 * &#x60;Y.QueryBuilder.plugin_mapping&#x60;.  Plugins must implement the following
 * functions:&lt;/p&gt;
 *
 * &lt;dl&gt;
 * &lt;dt&gt;&#x60;constructor(qb, config)&#x60;&lt;/dt&gt;
 * &lt;dd&gt;The arguments passed to the constructor are the QueryBuilder instance
 *		and the &#x60;pluginConfig&#x60; set on the QueryBuilder instance.
 *		At the minimum, this function should initalize form field name patterns
 *		using &#x60;config.field_prefix&#x60;.&lt;/dd&gt;
 * &lt;dt&gt;&#x60;create(query_index, var_config, op_list, value)&#x60;&lt;dt&gt;
 * &lt;dd&gt;This function must create the additional cells for the query row and
 *		populate these cells appropriately.  (The QueryBuilder widget will
 *		insert the cells into the table.)  &#x60;var_config&#x60; is the
 *		item from the QueryBuilder&#x27;s &#x60;var_list&#x60; that the user
 *		selected.  &#x60;op_list&#x60; is the item from the QueryBuilder&#x27;s
 *		&#x60;operators&#x60; which matches the variable selected by the
 *		user.  &#x60;value&#x60; is optional.  If specified, it is the
 *		initial value(s) to be displayed by the plugin.&lt;/dd&gt;
 * &lt;dt&gt;&#x60;postCreate(query_index, var_config, op_list, value)&#x60;&lt;/dt&gt;
 * &lt;dd&gt;Optional.  If it exists, it will be called after the cells returned by
 *		&#x60;create()&#x60; have been inserted into the table.  The arguments
 *		are the same as &#x60;create()&#x60;.&lt;/dd&gt;
 * &lt;dt&gt;&#x60;destroy()&#x60;&lt;/dt&gt;
 * &lt;dd&gt;Destroy the plugin.  (The QueryBuilder widget will remove the cells
 *		and purge all events.)&lt;/dd&gt;
 * &lt;dt&gt;&#x60;updateName(new_index)&#x60;&lt;/dt&gt;
 * &lt;dd&gt;Update the names of the form fields managed by the plugin.&lt;/dd&gt;
 * &lt;dt&gt;&#x60;toDatabaseQuery()&#x60;&lt;/dt&gt;
 * &lt;dd&gt;Return an array of arrays.  Each inner array contains an operation
 *		and a value.  The default String and Select plugins each return
 *		a single inner array.  A date range plugin would return two inner
 *		arrays, one for the start date and one for the end date.&lt;/dd&gt;
 * &lt;dt&gt;&#x60;validate()&#x60;&lt;/dt&gt;
 * &lt;dd&gt;Optional.  If additional validations are required beyond the basic
 *		validations encoded in CSS, this function should check them.  If
 *		the input is not valid, call &#x60;displayFieldMessage()&#x60;
 *		on the QueryBuilder object and return false.  Otherwise, return
 *		true.&lt;/dd&gt;
 * &lt;/dl&gt;
 *
 * @class QueryBuilder
 * @extends Widget
 * @constructor
 * @param var_list {Array} List of variables that be included in the query.
 * @param var_list.name {String} The name of the variable.  Set as the &#x60;value&#x60; for the select option.
 * @param var_list.type {String} The variable type.  Used to determine which plugin to instantiate. Must match a key in &#x60;Y.QueryBuilder.plugin_mapping&#x60;. (You can add new plugins to this global mapping.)
 * @param var_list.text {String} The text displayed when the variable is selected.
 * @param var_list.** {Mixed} plugin-specific configuration
 * @param operators {Object} Map of variable types to list of operators. Each operator is an object defining &#x60;value&#x60; and &#x60;text&#x60;.
 * @param config {Object} Widget configuration
 */

function QueryBuilder(
	/* array */		var_list,
	/* object */	operators,
	/* object */	config)
{
	// list of variables that can be queried

	this.var_list = var_list.slice(0);

	// list of possible query operations for each data type

	this.op_list      = Y.clone(operators, true);
	this.op_list.none = [];

	// table rows containing the query elements

	this.row_list = [];

	QueryBuilder.superclass.constructor.call(this, config);
}

QueryBuilder.NAME = &quot;querybuilder&quot;;

QueryBuilder.ATTRS =
{
	/**
	 * The prompt displayed when a new item is added to the query.
	 *
	 * @attribute chooseVarPrompt
	 * @type {String}
	 * @default &quot;Choose a variable&quot;
	 * @writeonce
	 */
	chooseVarPrompt:
	{
		value:     &#x27;Choose a Variable&#x27;,
		validator: Y.Lang.isString,
		writeOnce: true
	},

	/**
	 * All generated form field names start with this prefix.  This avoids
	 * conflicts if you have more than one QueryBuilder on a page.
	 *
	 * @attribute fieldPrefix
	 * @type {String}
	 * @default &quot;&quot;
	 * @writeonce
	 */
	fieldPrefix:
	{
		value:     &#x27;&#x27;,
		validator: Y.Lang.isString,
		writeOnce: true
	},

	/**
	 * Configuration passed to plugins when they are constructed.
	 *
	 * @attribute pluginConfig
	 * @type {Object}
	 * @default {}
	 * @writeonce
	 */
	pluginConfig:
	{
		value:     {},
		validator: Y.Lang.isObject,
		writeOnce: true
	}
};

/**
 * @event queryChanged
 * @description Fires when the query is modified.
 * @param info {Object} &#x60;remove&#x60; is &#x60;true&#x60; if a row was removed
 */

function initVarList()
{
	var prompt = this.get(&#x27;chooseVarPrompt&#x27;);
	if (prompt)
	{
		this.var_list.unshift(
		{
			name: &#x27;yui3-querybuilder-choose-prompt&#x27;,
			type: &#x27;none&#x27;,
			text: prompt
		});
	}
}

function findRow(
	/* array */		row_list,
	/* element */	query_row)
{
	var count = row_list.length;
	for (var i=0; i&lt;count; i++)
	{
		if (row_list[i].row == query_row)
		{
			return i;
		}
	}

	return -1;
}

function insertRow(
	/* event */		e,
	/* element */	query_row)
{
	e.halt();
	this.appendNew();
}

function removeRow(
	/* event */		e,
	/* element */	query_row)
{
	e.halt();

	var i = findRow(this.row_list, query_row);
	if (i &gt;= 0)
	{
		this.remove(i);
	}
}

function changeVar(
	/* event */		e,
	/* element */	query_row)
{
	var i = findRow(this.row_list, query_row);
	if (i &gt;= 0)
	{
		this.update(i);
	}
}

function keyUp(e)
{
	if (e.keyCode != 13)
	{
		this._notifyChanged();
	}
}

Y.extend(QueryBuilder, Y.Widget,
{
	initializer: function(config)
	{
		var field_prefix                      = this.get(&#x27;fieldPrefix&#x27;);
		this.var_menu_name_pattern            = field_prefix + &#x27;query_var_{i}&#x27;;
		this.get(&#x27;pluginConfig&#x27;).field_prefix = field_prefix;
		this.plugin_column_count              = 0;	// expands as needed

		initVarList.call(this);
	},

	renderUI: function()
	{
		var container = this.get(&#x27;contentBox&#x27;);
		container.on(&#x27;change&#x27;, this._notifyChanged, this);
		container.on(&#x27;keyup&#x27;, keyUp, this);

		this.table = Y.Node.create(&#x27;&lt;table&gt;&lt;/table&gt;&#x27;);
		container.appendChild(this.table);

		this.appendNew();
	},

	destructor: function()
	{
		for (var i=0; i&lt;this.row_list.length; i++)
		{
			if (this.row_list[i].plugin)
			{
				this.row_list[i].plugin.destroy();
			}
		}

		this.row_list = null;
		this.table    = null;
	},

	/**
	 * Reset the query.
	 *
	 * @method reset
	 * @param var_list {Array} If specified, the list of available variables is replaced.
	 * @param operators {Object} If specified, the operators for all variable types will be replaced.
	 */
	reset: function(
		/* array */		var_list,
		/* object */	operators)
	{
		this._allow_remove_last_row = true;

		for (var i=this.row_list.length-1; i&gt;=0; i--)
		{
			this.remove(i);
		}

		this._allow_remove_last_row = false;

		if (var_list)
		{
			this.var_list = var_list.slice(0);
			initVarList.call(this);
		}

		if (operators)
		{
			this.op_list      = Y.clone(operators, true);
			this.op_list.none = [];
		}

		this.has_messages = false;
		this.appendNew();
	},

	/**
	 * Append a new query condition to the table.
	 *
	 * @method appendNew
	 * @param name {String} If specified, this variable is selected.
	 * @param value {Mixed} If specified, this value is selected.  Refer to the appropriate plugin documentation to figure out what data to pass.
	 * @return {Object} plugin that was created for the row, if any
	 */
	appendNew: function(
		/* string */	name,
		/* mixed */		value)
	{
		// if has single, neutral row, use it

		if (name &amp;&amp; this.row_list.length == 1)
		{
			var var_menu     = this.row_list[0].var_menu,
				selected_var = this.var_list[ var_menu.get(&#x27;selectedIndex&#x27;) ];
			if (!selected_var || selected_var.type == &#x27;none&#x27;)
			{
				var_menu.set(&#x27;value&#x27;, name);
				this.update(0, value);
				return this.row_list[0].plugin;
			}
		}

		// create new row

		var new_index  = this.row_list.length;
		var query_body = Y.Node.create(&#x27;&lt;tbody&gt;&lt;/tbody&gt;&#x27;);
		query_body.set(&#x27;className&#x27;, Y.FormManager.row_marker_class);

		// error row

		var error_row = Y.Node.create(&#x27;&lt;tr&gt;&lt;/tr&gt;&#x27;);
		error_row.set(&#x27;className&#x27;, this.getClassName(&#x27;error&#x27;));
		query_body.appendChild(error_row);

		var error_cell = this._createContainer();
		error_cell.set(&#x27;colSpan&#x27;, 1 + this.plugin_column_count);
		error_cell.set(&#x27;innerHTML&#x27;, &#x27;&lt;p class=&quot;&#x27; + Y.FormManager.status_marker_class + &#x27;&quot;&gt;&lt;/p&gt;&#x27;);
		error_row.appendChild(error_cell);

		error_row.appendChild(this._createContainer());

		// criterion row

		var query_row = Y.Node.create(&#x27;&lt;tr&gt;&lt;/tr&gt;&#x27;);
		query_row.set(&#x27;className&#x27;, this.getClassName(&#x27;criterion&#x27;));
		query_body.appendChild(query_row);

		// cell for query variable menu

		var var_cell = this._createContainer();
		var_cell.set(&#x27;className&#x27;, this.getClassName(&#x27;variable&#x27;));
		query_row.appendChild(var_cell);

		// menu for selecting query variable

		var_cell.set(&#x27;innerHTML&#x27;, this._variablesMenu(this.variableName(new_index)));

		var var_menu = var_cell.one(&#x27;select&#x27;);
		var_menu.on(&#x27;change&#x27;, changeVar, this, query_row);

		var options = var_menu.getDOMNode().options;
		for (var i=0; i&lt;this.var_list.length; i++)
		{
			options[i] = new Option(this.var_list[i].text, this.var_list[i].name);
		}

		if (name)
		{
			var_menu.set(&#x27;value&#x27;, name);
		}

		if (has_bubble_problem)
		{
			var_menu.on(&#x27;change&#x27;, this._notifyChanged, this);
		}

		// controls for this row

		var control_cell = this._createContainer();
		control_cell.set(&#x27;className&#x27;, this.getClassName(&#x27;controls&#x27;));
		control_cell.set(&#x27;innerHTML&#x27;, this._rowControls());
		query_row.appendChild(control_cell);

		var insert_control = control_cell.one(&#x27;.&#x27;+this.getClassName(&#x27;insert&#x27;));
		if (insert_control)
		{
			insert_control.on(&#x27;click&#x27;, insertRow, this, query_row);
		}

		var remove_control = control_cell.one(&#x27;.&#x27;+this.getClassName(&#x27;remove&#x27;));
		if (remove_control)
		{
			remove_control.on(&#x27;click&#x27;, removeRow, this, query_row);
		}

		// insert into DOM after fully constructed

		this.table.appendChild(query_body);

		var obj =
		{
			body:     query_body,
			row:      query_row,
			var_menu: var_menu,
			control:  control_cell,
			error:    error_cell
		};
		this.row_list.push(obj);
		this.update(new_index, value, true);

		if (name || Y.Lang.isValue(value))
		{
			this._notifyChanged();
		}

		query_body.scrollIntoView();

		return this.row_list[new_index].plugin;
	},

	/**
	 * Set the value of the specified row.
	 *
	 * @method update
	 * @param row_index {int} The index of the row
	 * @param value {Mixed} If specified, the value to set (Refer to the appropriate plugin documentation to figure out what data to pass.)
	 */
	update: function(
		/* int */	row_index,
		/* mixed */	value,
		/* bool */	silent)
	{
		var query_row    = this.row_list[row_index].row;
		var control_cell = this.row_list[row_index].control;

		// clear error

		this.row_list[row_index].error.one(&#x27;.&#x27;+Y.FormManager.status_marker_class).set(&#x27;innerHTML&#x27;, &#x27;&#x27;);

		// remove all but the first cell (variable name) and last cell (controls)

		if (this.row_list[row_index].plugin)
		{
			this.row_list[row_index].plugin.destroy();
			this.row_list[row_index].plugin = null;
		}

		while (query_row.get(&#x27;children&#x27;).size() &gt; 2)
		{
			var child = query_row.get(&#x27;children&#x27;).item(0).next();
			child.remove(true);
		}

		// re-build the table row

		var var_menu     = this.row_list[row_index].var_menu;
		var selected_var = this.var_list[ var_menu.get(&#x27;selectedIndex&#x27;) ];

		var cells = [];
		if (!selected_var || selected_var.type == &#x27;none&#x27;)
		{
			query_row.addClass(this.getClassName(&#x27;empty&#x27;));
		}
		else
		{
			query_row.removeClass(this.getClassName(&#x27;empty&#x27;));

			this.row_list[row_index].plugin =
				new QueryBuilder.plugin_mapping[ selected_var.type ](
					this, this.get(&#x27;pluginConfig&#x27;));
			cells =
				this.row_list[row_index].plugin.create(
					row_index, selected_var,
					this.op_list[ selected_var.type ], value);
		}

		while (cells.length &lt; this.plugin_column_count)
		{
			cells.push(this._createContainer());
		}

		for (var i=0; i&lt;cells.length; i++)
		{
			query_row.insertBefore(cells[i], control_cell);
		}

		if (cells.length &gt; this.plugin_column_count)
		{
			var col_span = 1 + cells.length;
			for (var i=0; i&lt;this.row_list.length; i++)
			{
				var row = this.row_list[i].row;
				this.row_list[i].error.set(&#x27;colSpan&#x27;, col_span);

				if (row != query_row)
				{
					var control = this.row_list[i].control;

					for (var j=this.plugin_column_count; j&lt;cells.length; j++)
					{
						row.insertBefore(this._createContainer(), control);
					}
				}
			}

			this.plugin_column_count = cells.length;
		}

		var plugin = this.row_list[row_index].plugin;
		if (plugin &amp;&amp; Y.Lang.isFunction(plugin.postCreate))
		{
			this.row_list[row_index].plugin.postCreate(
				row_index, selected_var,
				this.op_list[ selected_var.type ], value);
		}

		if (!silent &amp;&amp; Y.Lang.isValue(value))
		{
			this._notifyChanged();
		}
	},

	/**
	 * Removes the specified row.
	 *
	 * @method remove
	 * @param row_index {int} The index of the row
	 * @return {boolean} &#x60;true&#x60; if successful
	 */
	remove: function(
		/* int */	row_index)
	{
		// sanity checks

		if (this.row_list.length &lt;= 0)
		{
			return false;
		}

		// last row cannot be removed

		if (!this._allow_remove_last_row &amp;&amp; this.row_list.length == 1)
		{
			var var_menu = this.row_list[0].var_menu;
			var_menu.set(&#x27;selectedIndex&#x27;, 0);
			this.update(0);
			this.fire(&#x27;queryChanged&#x27;, {remove: true});
			return true;
		}

		var query_body = this.row_list[row_index].body;
		if (query_body === null)
		{
			return false;
		}

		// remove row

		if (this.row_list[row_index].plugin)
		{
			this.row_list[row_index].plugin.destroy();
		}

		query_body.remove(true);
		this.row_list.splice(row_index, 1);
		this._renumberRows();

		this.fire(&#x27;queryChanged&#x27;, {remove: true});
		return true;
	},

	/**
	 * Validate the fields in each row.
	 * 
	 * @method validateFields
	 * @return {Boolean} &#x60;true&#x60; if all values are valid
	 */
	validateFields: function()
	{
		this.clearFieldMessages();

		var status = true;
		Y.Array.each(this.row_list, function(row, i)
		{
			var info;
			row.row.all(&#x27;input&#x27;).some(function(n)
			{
				info = Y.FormManager.validateFromCSSData(n);

				if (info.error)
				{
					this.displayFieldMessage(n, info.error, &#x27;error&#x27;);
					status = false;
					return true;
				}
			},
			this);

			if ((!info || !info.error) &amp;&amp; row.plugin &amp;&amp; Y.Lang.isFunction(row.plugin.validate))
			{
				status = row.plugin.validate() &amp;&amp; status;	// status last to guarantee call to validate()
			}
		},
		this);

		return status;
	},

	/**
	 * @method clearFieldMessages
	 */
	clearFieldMessages: function()
	{
		this.has_messages = false;

		this.get(&#x27;contentBox&#x27;).all(&#x27;input&#x27;).each(function(n)
		{
			Y.FormManager.clearMessage(n);
		});

		this.get(&#x27;contentBox&#x27;).all(&#x27;select&#x27;).each(function(n)
		{
			Y.FormManager.clearMessage(n);
		});
	},

	/**
	 * Display a message for the specified field.
	 * 
	 * @method displayFieldMessage
	 * @param e {String|Object} The selector for the element or the element itself
	 * @param msg {String} The message
	 * @param type {String} The message type (see Y.FormManager.status_order)
	 * @param [scroll] {boolean} &#x60;true&#x60; if the form row should be scrolled into view
	 * @return {boolean} true if the message was displayed, false if a higher precedence message was already there
	 */
	displayFieldMessage: function(
		/* id/object */	e,
		/* string */	msg,
		/* string */	type,
		/* boolean */	scroll)
	{
		if (Y.FormManager.displayMessage(e, msg, type, this.has_messages, scroll))
		{
			this.has_messages = true;
			return true;
		}
		else
		{
			return false;
		}
	},

	/**
	 * Returns plugin used for the specified row, if any.
	 *
	 * @method getPlugin
	 * @param row_index {int} The index of the row
	 * @return {Object} the plugin for the row, if any
	 */
	getPlugin: function(
		/* int */	row_index)
	{
		return this.row_list[row_index].plugin;
	},

	/**
	 * @method toDatabaseQuery
	 * @return {Array} list of [var, op, value] tuples suitable for a database query
	 */
	toDatabaseQuery: function()
	{
		var result = [];

		for (var i=0; i&lt;this.row_list.length; i++)
		{
			var row    = this.row_list[i];
			var plugin = row.plugin;
			if (plugin)
			{
				var list = plugin.toDatabaseQuery();
				for (var j=0; j&lt;list.length; j++)
				{
					result.push([ row.var_menu.get(&#x27;value&#x27;) ].concat(list[j]));
				}
			}
		}

		return result;
	},

	/**
	 * Updates internal data to match ordering of rows.  Useful after
	 * Drag-and-Drop operation is finished.
	 * 
	 * @method rowsReordered
	 */
	rowsReordered: function()
	{
		var orig = this.row_list.slice(0);

		this.row_list = [];
		this.table.all(&#x27;tbody&#x27;).each(function(n)
		{
			var i = Y.Array.findIndexOf(orig, function(r)
			{
				return (r.body === n);
			});

			this.row_list.push(orig[i]);
		},
		this);

		this._renumberRows();
		this._notifyChanged();
	},

	/**
	 * @method _renumberRows
	 * @private
	 */
	_renumberRows: function()
	{
		Y.Array.each(this.row_list, function(row, i)
		{
			var var_menu = row.var_menu;
			var_menu.setAttribute(&#x27;name&#x27;, this.variableName(i));

			var selected_var = this.var_list[ var_menu.get(&#x27;selectedIndex&#x27;) ];
			if (selected_var.type != &#x27;none&#x27;)
			{
				row.plugin.updateName(i);
			}
		},
		this);
	},

	/*
	 * API for plugins
	 */

	/**
	 * @method _createContainer
	 * @protected
	 * @return {DOM element} container for one piece of a query row
	 */
	_createContainer: function()
	{
		return Y.Node.create(&#x27;&lt;td&gt;&lt;/td&gt;&#x27;);
	},

	/**
	 * Fires the queryChanged event.
	 *
	 * @method _notifyChanged
	 * @protected
	 */
	_notifyChanged: function()
	{
		this.fire(&#x27;queryChanged&#x27;);
	},

	/*
	 * Form element names.
	 */

	/**
	 * @method variableName
	 * @param i {int} query row index
	 * @return {String} name for the select form element listing the available query variables
	 */
	variableName: function(
		/* int */	i)
	{
		return Y.Lang.sub(this.var_menu_name_pattern, {i:i});
	},

	//
	// Markup
	//

	/**
	 * @method _variablesMenu
	 * @protected
	 * @param menu_name {String} name for the select form element
	 * @return {String} markup for the query variable menu
	 */
	_variablesMenu: function(
		/* string */	menu_name)
	{
		// This must use a select tag!

		var markup = &#x27;&lt;select name=&quot;{n}&quot; class=&quot;{f} {c}&quot; /&gt;&#x27;;

		return Y.Lang.sub(markup,
		{
			n: menu_name,
			f: Y.FormManager.field_marker_class,
			c: this.getClassName(&#x27;field&#x27;)
		});
	},

	/**
	 * @method _rowControls
	 * @protected
	 * @return {String} markup for the row controls (insert and remove)
	 */
	_rowControls: function()
	{
		var markup =
			&#x27;&lt;button type=&quot;button&quot; class=&quot;{cr}&quot;&gt;&amp;ndash;&lt;/button&gt;&#x27; +
			&#x27;&lt;button type=&quot;button&quot; class=&quot;{ci}&quot;&gt;+&lt;/button&gt;&#x27;;

		if (!this._controls_markup)
		{
			this._controls_markup = Y.Lang.sub(markup,
			{
				ci: this.getClassName(&#x27;insert&#x27;),
				cr: this.getClassName(&#x27;remove&#x27;)
			});
		}

		return this._controls_markup;
	}
});

Y.QueryBuilder = QueryBuilder;

/**
 * &lt;p&gt;Environment information.&lt;/p&gt;
 * 
 * &lt;dl&gt;
 * &lt;dt&gt;has_bubble_problem&lt;/dt&gt;
 * &lt;dd&gt;True if change events from select elements do not bubble.&lt;/dd&gt;
 * &lt;/dl&gt;
 * 
 * @property Env
 * @type {Object}
 * @static
 */
Y.QueryBuilder.Env =
{
	has_bubble_problem: has_bubble_problem
};

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
