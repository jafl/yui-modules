<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/gallery-bulkedit/js/BulkEditDataSource.js - YUI 3 Gallery Modules</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="YUI 3 Gallery Modules" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Accordion.html">Accordion</a></li>
                                <li><a href="../classes/AnimSequence.html">AnimSequence</a></li>
                                <li><a href="../classes/ArrayIterator.html">ArrayIterator</a></li>
                                <li><a href="../classes/ArrayList~extras.html">ArrayList~extras</a></li>
                                <li><a href="../classes/Array~algorithms.html">Array~algorithms</a></li>
                                <li><a href="../classes/Array~funcprog-extras.html">Array~funcprog-extras</a></li>
                                <li><a href="../classes/Array~object-extras.html">Array~object-extras</a></li>
                                <li><a href="../classes/Assert.html">Assert</a></li>
                                <li><a href="../classes/AtLeastOneCheckboxGroup.html">AtLeastOneCheckboxGroup</a></li>
                                <li><a href="../classes/AtMostOneCheckboxGroup.html">AtMostOneCheckboxGroup</a></li>
                                <li><a href="../classes/BulkEditor.html">BulkEditor</a></li>
                                <li><a href="../classes/Canvas.Context2d.html">Canvas.Context2d</a></li>
                                <li><a href="../classes/CheckboxGroup.html">CheckboxGroup</a></li>
                                <li><a href="../classes/Chipper.html">Chipper</a></li>
                                <li><a href="../classes/CollapseToggle.html">CollapseToggle</a></li>
                                <li><a href="../classes/ComplexMath.html">ComplexMath</a></li>
                                <li><a href="../classes/ComplexNumber.html">ComplexNumber</a></li>
                                <li><a href="../classes/DataSource.AsyncFunction.html">DataSource.AsyncFunction</a></li>
                                <li><a href="../classes/DataSource.BulkEdit.html">DataSource.BulkEdit</a></li>
                                <li><a href="../classes/DataSource.Treeble.html">DataSource.Treeble</a></li>
                                <li><a href="../classes/DateTime.html">DateTime</a></li>
                                <li><a href="../classes/DateTimeRange.html">DateTimeRange</a></li>
                                <li><a href="../classes/DateTimeUtils.html">DateTimeUtils</a></li>
                                <li><a href="../classes/EnableIfAnyCheckboxGroup.html">EnableIfAnyCheckboxGroup</a></li>
                                <li><a href="../classes/ExpirationCache.html">ExpirationCache</a></li>
                                <li><a href="../classes/ExpressionBuilder.html">ExpressionBuilder</a></li>
                                <li><a href="../classes/FormManager.html">FormManager</a></li>
                                <li><a href="../classes/HTMLTableBulkEditor.html">HTMLTableBulkEditor</a></li>
                                <li><a href="../classes/InputPopup.html">InputPopup</a></li>
                                <li><a href="../classes/InstanceManager.html">InstanceManager</a></li>
                                <li><a href="../classes/io~multiresponse.html">io~multiresponse</a></li>
                                <li><a href="../classes/Iterable.html">Iterable</a></li>
                                <li><a href="../classes/LinkedList.html">LinkedList</a></li>
                                <li><a href="../classes/LinkedListItem.html">LinkedListItem</a></li>
                                <li><a href="../classes/LinkedListIterator.html">LinkedListIterator</a></li>
                                <li><a href="../classes/LogFilter.html">LogFilter</a></li>
                                <li><a href="../classes/Math.html">Math</a></li>
                                <li><a href="../classes/MathCanvas.html">MathCanvas</a></li>
                                <li><a href="../classes/MathCanvas.Parser.html">MathCanvas.Parser</a></li>
                                <li><a href="../classes/MathCanvas.RectList.html">MathCanvas.RectList</a></li>
                                <li><a href="../classes/MathFunction.html">MathFunction</a></li>
                                <li><a href="../classes/MathFunction.Arccosine.html">MathFunction.Arccosine</a></li>
                                <li><a href="../classes/MathFunction.Arcsine.html">MathFunction.Arcsine</a></li>
                                <li><a href="../classes/MathFunction.Arctangent.html">MathFunction.Arctangent</a></li>
                                <li><a href="../classes/MathFunction.Arctangent2.html">MathFunction.Arctangent2</a></li>
                                <li><a href="../classes/MathFunction.Conjugate.html">MathFunction.Conjugate</a></li>
                                <li><a href="../classes/MathFunction.Cosine.html">MathFunction.Cosine</a></li>
                                <li><a href="../classes/MathFunction.E.html">MathFunction.E</a></li>
                                <li><a href="../classes/MathFunction.Exponential.html">MathFunction.Exponential</a></li>
                                <li><a href="../classes/MathFunction.FunctionWithArgs.html">MathFunction.FunctionWithArgs</a></li>
                                <li><a href="../classes/MathFunction.HyperbolicCosine.html">MathFunction.HyperbolicCosine</a></li>
                                <li><a href="../classes/MathFunction.HyperbolicSine.html">MathFunction.HyperbolicSine</a></li>
                                <li><a href="../classes/MathFunction.HyperbolicTangent.html">MathFunction.HyperbolicTangent</a></li>
                                <li><a href="../classes/MathFunction.I.html">MathFunction.I</a></li>
                                <li><a href="../classes/MathFunction.ImaginaryPart.html">MathFunction.ImaginaryPart</a></li>
                                <li><a href="../classes/MathFunction.InverseHyperbolicCosine.html">MathFunction.InverseHyperbolicCosine</a></li>
                                <li><a href="../classes/MathFunction.InverseHyperbolicSine.html">MathFunction.InverseHyperbolicSine</a></li>
                                <li><a href="../classes/MathFunction.InverseHyperbolicTangent.html">MathFunction.InverseHyperbolicTangent</a></li>
                                <li><a href="../classes/MathFunction.Logarithm.html">MathFunction.Logarithm</a></li>
                                <li><a href="../classes/MathFunction.Magnitude.html">MathFunction.Magnitude</a></li>
                                <li><a href="../classes/MathFunction.Max.html">MathFunction.Max</a></li>
                                <li><a href="../classes/MathFunction.Min.html">MathFunction.Min</a></li>
                                <li><a href="../classes/MathFunction.NaturalLog.html">MathFunction.NaturalLog</a></li>
                                <li><a href="../classes/MathFunction.Negate.html">MathFunction.Negate</a></li>
                                <li><a href="../classes/MathFunction.Phase.html">MathFunction.Phase</a></li>
                                <li><a href="../classes/MathFunction.Pi.html">MathFunction.Pi</a></li>
                                <li><a href="../classes/MathFunction.Product.html">MathFunction.Product</a></li>
                                <li><a href="../classes/MathFunction.Quotient.html">MathFunction.Quotient</a></li>
                                <li><a href="../classes/MathFunction.RealPart.html">MathFunction.RealPart</a></li>
                                <li><a href="../classes/MathFunction.Rotate.html">MathFunction.Rotate</a></li>
                                <li><a href="../classes/MathFunction.Sine.html">MathFunction.Sine</a></li>
                                <li><a href="../classes/MathFunction.SquareRoot.html">MathFunction.SquareRoot</a></li>
                                <li><a href="../classes/MathFunction.Sum.html">MathFunction.Sum</a></li>
                                <li><a href="../classes/MathFunction.Tangent.html">MathFunction.Tangent</a></li>
                                <li><a href="../classes/MathFunction.Value.html">MathFunction.Value</a></li>
                                <li><a href="../classes/MathFunction.Variable.html">MathFunction.Variable</a></li>
                                <li><a href="../classes/MatrixBackground.html">MatrixBackground</a></li>
                                <li><a href="../classes/MatrixCredits.html">MatrixCredits</a></li>
                                <li><a href="../classes/MRUCache.html">MRUCache</a></li>
                                <li><a href="../classes/MultiObject.html">MultiObject</a></li>
                                <li><a href="../classes/NodeList~extras2.html">NodeList~extras2</a></li>
                                <li><a href="../classes/Node~dimensions.html">Node~dimensions</a></li>
                                <li><a href="../classes/Node~event-set.html">Node~event-set</a></li>
                                <li><a href="../classes/Node~optimizations.html">Node~optimizations</a></li>
                                <li><a href="../classes/Node~scrollIntoView.html">Node~scrollIntoView</a></li>
                                <li><a href="../classes/Node~utils.html">Node~utils</a></li>
                                <li><a href="../classes/Object~extras.html">Object~extras</a></li>
                                <li><a href="../classes/PageLayout.html">PageLayout</a></li>
                                <li><a href="../classes/Paginator.ui.CurrentPageInput.html">Paginator.ui.CurrentPageInput</a></li>
                                <li><a href="../classes/Paginator.ui.CurrentPageReport.html">Paginator.ui.CurrentPageReport</a></li>
                                <li><a href="../classes/Paginator.ui.FirstPageLink.html">Paginator.ui.FirstPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.ItemRangeDropdown.html">Paginator.ui.ItemRangeDropdown</a></li>
                                <li><a href="../classes/Paginator.ui.LastPageLink.html">Paginator.ui.LastPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.NextPageLink.html">Paginator.ui.NextPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.PageLinks.html">Paginator.ui.PageLinks</a></li>
                                <li><a href="../classes/Paginator.ui.PreviousPageLink.html">Paginator.ui.PreviousPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.RowsPerPageDropdown.html">Paginator.ui.RowsPerPageDropdown</a></li>
                                <li><a href="../classes/Paginator.ui.ValidationPageLinks.html">Paginator.ui.ValidationPageLinks</a></li>
                                <li><a href="../classes/Parsers.html">Parsers</a></li>
                                <li><a href="../classes/Plugin.BusyOverlay.html">Plugin.BusyOverlay</a></li>
                                <li><a href="../classes/Plugin.ConsoleTest.html">Plugin.ConsoleTest</a></li>
                                <li><a href="../classes/Plugin.DataTableDataSourceBusy.html">Plugin.DataTableDataSourceBusy</a></li>
                                <li><a href="../classes/Plugin.DataTablePaginator.html">Plugin.DataTablePaginator</a></li>
                                <li><a href="../classes/Plugin.DataTableQuickEdit.html">Plugin.DataTableQuickEdit</a></li>
                                <li><a href="../classes/Plugin.DataTableRowExpansion.html">Plugin.DataTableRowExpansion</a></li>
                                <li><a href="../classes/Plugin.DataTableState.html">Plugin.DataTableState</a></li>
                                <li><a href="../classes/Plugin.FixedSizeAccordion.html">Plugin.FixedSizeAccordion</a></li>
                                <li><a href="../classes/Plugin.InputCalendarSync.html">Plugin.InputCalendarSync</a></li>
                                <li><a href="../classes/Plugin.Neon.html">Plugin.Neon</a></li>
                                <li><a href="../classes/Plugin.NodeFXSequence.html">Plugin.NodeFXSequence</a></li>
                                <li><a href="../classes/Plugin.OverlayForm.html">Plugin.OverlayForm</a></li>
                                <li><a href="../classes/Plugin.PageLayoutAnyWidgetModule.html">Plugin.PageLayoutAnyWidgetModule</a></li>
                                <li><a href="../classes/Plugin.PageLayoutDataTableModule.html">Plugin.PageLayoutDataTableModule</a></li>
                                <li><a href="../classes/Popup.html">Popup</a></li>
                                <li><a href="../classes/QueryBuilder.html">QueryBuilder</a></li>
                                <li><a href="../classes/QueryBuilder.DateRange.html">QueryBuilder.DateRange</a></li>
                                <li><a href="../classes/QueryBuilder.MultiselectInput.html">QueryBuilder.MultiselectInput</a></li>
                                <li><a href="../classes/QueryBuilder.Select.html">QueryBuilder.Select</a></li>
                                <li><a href="../classes/QueryBuilder.String.html">QueryBuilder.String</a></li>
                                <li><a href="../classes/RPC.Mojito.html">RPC.Mojito</a></li>
                                <li><a href="../classes/SelectAllCheckboxGroup.html">SelectAllCheckboxGroup</a></li>
                                <li><a href="../classes/Sort.html">Sort</a></li>
                                <li><a href="../classes/Treeble.html">Treeble</a></li>
                                <li><a href="../classes/YUI~funcprog.html">YUI~funcprog</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/gallery-accordion-horiz-vert.html">gallery-accordion-horiz-vert</a></li>
                                <li><a href="../modules/gallery-adobe-air-config.html">gallery-adobe-air-config</a></li>
                                <li><a href="../modules/gallery-adobe-air-page-manager.html">gallery-adobe-air-page-manager</a></li>
                                <li><a href="../modules/gallery-adobe-air-prefs.html">gallery-adobe-air-prefs</a></li>
                                <li><a href="../modules/gallery-algorithms.html">gallery-algorithms</a></li>
                                <li><a href="../modules/gallery-anim-class.html">gallery-anim-class</a></li>
                                <li><a href="../modules/gallery-anim-sequence.html">gallery-anim-sequence</a></li>
                                <li><a href="../modules/gallery-bulkedit.html">gallery-bulkedit</a></li>
                                <li><a href="../modules/gallery-busyoverlay.html">gallery-busyoverlay</a></li>
                                <li><a href="../modules/gallery-canvas.html">gallery-canvas</a></li>
                                <li><a href="../modules/gallery-checkboxgroups.html">gallery-checkboxgroups</a></li>
                                <li><a href="../modules/gallery-chipper.html">gallery-chipper</a></li>
                                <li><a href="../modules/gallery-collapse-toggle.html">gallery-collapse-toggle</a></li>
                                <li><a href="../modules/gallery-complexnumber.html">gallery-complexnumber</a></li>
                                <li><a href="../modules/gallery-console-test.html">gallery-console-test</a></li>
                                <li><a href="../modules/gallery-datasource-async-function.html">gallery-datasource-async-function</a></li>
                                <li><a href="../modules/gallery-datatable-datasource-busy.html">gallery-datatable-datasource-busy</a></li>
                                <li><a href="../modules/gallery-datatable-paginator.html">gallery-datatable-paginator</a></li>
                                <li><a href="../modules/gallery-datatable-row-expansion.html">gallery-datatable-row-expansion</a></li>
                                <li><a href="../modules/gallery-datatable-state.html">gallery-datatable-state</a></li>
                                <li><a href="../modules/gallery-datetime.html">gallery-datetime</a></li>
                                <li><a href="../modules/gallery-datetime-range.html">gallery-datetime-range</a></li>
                                <li><a href="../modules/gallery-datetime-utils.html">gallery-datetime-utils</a></li>
                                <li><a href="../modules/gallery-dimensions.html">gallery-dimensions</a></li>
                                <li><a href="../modules/gallery-expiration-cache.html">gallery-expiration-cache</a></li>
                                <li><a href="../modules/gallery-exprbuilder.html">gallery-exprbuilder</a></li>
                                <li><a href="../modules/gallery-formmgr.html">gallery-formmgr</a></li>
                                <li><a href="../modules/gallery-formmgr-css-validation.html">gallery-formmgr-css-validation</a></li>
                                <li><a href="../modules/gallery-formmgr-overlay-plugin.html">gallery-formmgr-overlay-plugin</a></li>
                                <li><a href="../modules/gallery-funcprog.html">gallery-funcprog</a></li>
                                <li><a href="../modules/gallery-input-calendar-sync.html">gallery-input-calendar-sync</a></li>
                                <li><a href="../modules/gallery-instancemanager.html">gallery-instancemanager</a></li>
                                <li><a href="../modules/gallery-io-adobe-air.html">gallery-io-adobe-air</a></li>
                                <li><a href="../modules/gallery-io-multiresponse.html">gallery-io-multiresponse</a></li>
                                <li><a href="../modules/gallery-iterable-extras.html">gallery-iterable-extras</a></li>
                                <li><a href="../modules/gallery-layout.html">gallery-layout</a></li>
                                <li><a href="../modules/gallery-layout-anywidget.html">gallery-layout-anywidget</a></li>
                                <li><a href="../modules/gallery-layout-cols.html">gallery-layout-cols</a></li>
                                <li><a href="../modules/gallery-layout-datatable.html">gallery-layout-datatable</a></li>
                                <li><a href="../modules/gallery-layout-rows.html">gallery-layout-rows</a></li>
                                <li><a href="../modules/gallery-linkedlist.html">gallery-linkedlist</a></li>
                                <li><a href="../modules/gallery-log-filter.html">gallery-log-filter</a></li>
                                <li><a href="../modules/gallery-math.html">gallery-math</a></li>
                                <li><a href="../modules/gallery-mathcanvas.html">gallery-mathcanvas</a></li>
                                <li><a href="../modules/gallery-matrix-background.html">gallery-matrix-background</a></li>
                                <li><a href="../modules/gallery-matrix-credits.html">gallery-matrix-credits</a></li>
                                <li><a href="../modules/gallery-mojito-rpc.html">gallery-mojito-rpc</a></li>
                                <li><a href="../modules/gallery-mru-cache.html">gallery-mru-cache</a></li>
                                <li><a href="../modules/gallery-multiobject.html">gallery-multiobject</a></li>
                                <li><a href="../modules/gallery-neon.html">gallery-neon</a></li>
                                <li><a href="../modules/gallery-node-event-set.html">gallery-node-event-set</a></li>
                                <li><a href="../modules/gallery-node-optimizations.html">gallery-node-optimizations</a></li>
                                <li><a href="../modules/gallery-node-utils.html">gallery-node-utils</a></li>
                                <li><a href="../modules/gallery-nodelist-extras2.html">gallery-nodelist-extras2</a></li>
                                <li><a href="../modules/gallery-object-extras.html">gallery-object-extras</a></li>
                                <li><a href="../modules/gallery-paginator.html">gallery-paginator</a></li>
                                <li><a href="../modules/gallery-popup.html">gallery-popup</a></li>
                                <li><a href="../modules/gallery-querybuilder.html">gallery-querybuilder</a></li>
                                <li><a href="../modules/gallery-querybuilder-daterange.html">gallery-querybuilder-daterange</a></li>
                                <li><a href="../modules/gallery-querybuilder-multiselect-input.html">gallery-querybuilder-multiselect-input</a></li>
                                <li><a href="../modules/gallery-quickedit.html">gallery-quickedit</a></li>
                                <li><a href="../modules/gallery-scrollintoview.html">gallery-scrollintoview</a></li>
                                <li><a href="../modules/gallery-sort-extras.html">gallery-sort-extras</a></li>
                                <li><a href="../modules/gallery-table-utils.html">gallery-table-utils</a></li>
                                <li><a href="../modules/gallery-test-extras.html">gallery-test-extras</a></li>
                                <li><a href="../modules/gallery-treeble.html">gallery-treeble</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/gallery-bulkedit/js/BulkEditDataSource.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&quot;use strict&quot;;

/**
 * @module gallery-bulkedit
 */

/**********************************************************************
 * &lt;p&gt;BulkEditDataSource manages a YUI DataSource + diffs (insertions,
 * removals, changes to values).&lt;/p&gt;
 * 
 * &lt;p&gt;The YUI DataSource must be immutable, e.g., if it is an XHR
 * datasource, the data must not change.&lt;/p&gt;
 * 
 * &lt;p&gt;By using a DataSource, we can support both client-side pagination
 * (all data pre-loaded, best-effort save allowed) and server-side
 * pagination (load data when needed, only all-or-nothing save allowed).
 * Server-side pagination is useful when editing a large amount of existing
 * records or after uploading a large number of new records. (Store the new
 * records in a scratch space, so everything does not have to be sent back
 * to the client after parsing.)  In the case of bulk upload, server-side
 * validation will catch errors in unviewed records.&lt;/p&gt;
 * 
 * &lt;p&gt;The responseSchema passed to the YUI DataSource must include a
 * comparator for each field that should not be treated like a string.
 * This comparator can either be &#x27;string&#x27; (the default), &#x27;integer&#x27;,
 * &#x27;decimal&#x27;, &#x27;boolean&#x27;, or a function which takes two arguments.&lt;/p&gt;
 *
 * @class BulkEdit
 * @namespace DataSource
 * @extends DataSource.Local 
 * @constructor
 * @param config {Object}
 */
function BulkEditDataSource()
{
	BulkEditDataSource.superclass.constructor.apply(this, arguments);
}

BulkEditDataSource.NAME = &quot;bulkEditDataSource&quot;;

BulkEditDataSource.ATTRS =
{
	/**
	 * The original data.  This must be immutable, i.e., the values must
	 * not change.
	 * 
	 * @attribute ds
	 * @type {DataSource}
	 * @required
	 * @writeonce
	 */
	ds:
	{
		writeOnce: true
	},

	/**
	 * The function to convert the initial request into a request usable by
	 * the underlying DataSource.  This function takes one argument: state
	 * (startIndex,resultCount,...).
	 * 
	 * @attribute generateRequest
	 * @type {Function}
	 * @required
	 * @writeonce
	 */
	generateRequest:
	{
		validator: Y.Lang.isFunction,
		writeOnce: true
	},

	/**
	 * The name of the key in each record that stores an identifier which
	 * is unique across the entire data set.
	 * 
	 * @attribute uniqueIdKey
	 * @type {String}
	 * @required
	 * @writeonce
	 */
	uniqueIdKey:
	{
		validator: Y.Lang.isString,
		writeOnce: true
	},

	/**
	 * The function to call to generate a unique id for a new record.  The
	 * default generates &quot;bulk-edit-new-id-#&quot;.
	 * 
	 * @attribute generateUniqueId
	 * @type {Function}
	 * @writeonce
	 */
	generateUniqueId:
	{
		value: function()
		{
			idCounter++;
			return uniqueIdPrefix + idCounter;
		},
		validator: Y.Lang.isFunction,
		writeOnce: true
	},

	/**
	 * OGNL expression telling how to extract the startIndex from the
	 * received data, e.g., &lt;code&gt;.meta.startIndex&lt;/code&gt;.  If it is not
	 * provided, startIndex is always assumed to be zero.
	 * 
	 * @attribute startIndexExpr
	 * @type {String}
	 * @writeonce
	 */
	startIndexExpr:
	{
		validator: Y.Lang.isString,
		writeOnce: true
	},

	/**
	 * OGNL expression telling where in the response to store the total
	 * number of records, e.g., &lt;code&gt;.meta.totalRecords&lt;/code&gt;.  This is
	 * only appropriate for DataSources that always return the entire data
	 * set.
	 * 
	 * @attribute totalRecordsReturnExpr
	 * @type {String}
	 * @writeonce
	 */
	totalRecordsReturnExpr:
	{
		validator: Y.Lang.isString,
		writeOnce: true
	},

	/**
	 * The function to call to extract the total number of
	 * records from the response.
	 * 
	 * @attribute extractTotalRecords
	 * @type {Function}
	 * @required
	 * @writeonce
	 */
	extractTotalRecords:
	{
		validator: Y.Lang.isFunction,
		writeOnce: true
	}
};

var uniqueIdPrefix = &#x27;bulk-edit-new-id-&#x27;,
	idCounter = 0,

	inserted_prefix   = &#x27;be-ds-i:&#x27;,
	inserted_re       = /^be-ds-i:/,
	removed_prefix    = &#x27;be-ds-r:&#x27;,
	removed_re        = /^be-ds-r:/,
	hidden_prefix     = &#x27;be-ds-h:&#x27;,
	hidden_re         = /^be-ds-h:/,
	removed_hidden_re = /^be-ds-[rh]:/;

BulkEditDataSource.comparator =
{
	&#x27;string&#x27;: function(a,b)
	{
		return (a.toString() === b.toString());
	},

	&#x27;integer&#x27;: function(a,b)
	{
		return (Y.FormManager.integer_value_re.test(a) &amp;&amp;
				Y.FormManager.integer_value_re.test(b) &amp;&amp;
				parseInt(a,10) === parseInt(b,10));
	},

	&#x27;decimal&#x27;: function(a,b)
	{
		return (Y.FormManager.decimal_value_re.test(a) &amp;&amp;
				Y.FormManager.decimal_value_re.test(b) &amp;&amp;
				parseFloat(a,10) === parseFloat(b,10));
	},

	&#x27;boolean&#x27;: function(a,b)
	{
		return (((a &amp;&amp; b) || (!a &amp;&amp; !b)) ? true : false);
	}
};

function fromDisplayIndex(
	/* int */ index)
{
	var count = -1;
	for (var i=0; i&lt;this._index.length; i++)
	{
		var j = this._index[i];
		if (!removed_hidden_re.test(j))
		{
			count++;
			if (count === index)
			{
				return i;
			}
		}
	}

	return false;
}

function adjustRequest()
{
	var r = this._callback.request;
	this._callback.adjust =
	{
		origStart: r.startIndex,
		origCount: r.resultCount
	};

	if (!this._index)
	{
		return;
	}

	// find index of first record to request

	var start = Math.min(r.startIndex, this._index.length);
	var count = 0;
	for (var i=0; i&lt;start; i++)
	{
		var j = this._index[i];
		if (!inserted_re.test(j))
		{
			count++;
		}

		if (removed_hidden_re.test(j))
		{
			start++;
		}
	}

	r.startIndex = count;

	this._callback.adjust.indexStart = i;

	// adjust number of records to request

	count = 0;
	while (i &lt; this._index.length &amp;&amp; count &lt; this._callback.adjust.origCount)
	{
		var j = this._index[i];
		if (inserted_re.test(j))
		{
			r.resultCount--;
		}

		if (removed_hidden_re.test(j))
		{
			r.resultCount++;
		}
		else
		{
			count++;
		}

		i++;
	}

	this._callback.adjust.indexEnd = i;
}

function internalSuccess(e)
{
	if (!e.response || e.error ||
		!Y.Lang.isArray(e.response.results))
	{
		internalFailure.apply(this, arguments);
		return;
	}

	// synch response arrives before setting _tId

	if (!Y.Lang.isUndefined(this._callback._tId) &amp;&amp;
		e.tId !== this._callback._tId)
	{
		return; 	// cancelled request
	}

	this._callback.response = e.response;
	checkFinished.call(this);
}

function internalFailure(e)
{
	if (e.tId === this._callback._tId)
	{
		this._callback.error    = e.error;
		this._callback.response = e.response;
		this.fire(&#x27;response&#x27;, this._callback);
	}
}

function checkFinished()
{
	if (this._generatingRequest || !this._callback.response)
	{
		return;
	}

	if (!this._fields)
	{
		this._fields = {};
		Y.Array.each(this.get(&#x27;ds&#x27;).schema.get(&#x27;schema&#x27;).resultFields, function(value)
		{
			if (Y.Lang.isObject(value))
			{
				this._fields[ value.key ] = value;
			}
		},
		this);
	}

	var response = {};
	Y.mix(response, this._callback.response);
	response.results = [];
	response         = Y.clone(response, true);

	var dataStartIndex = 0;
	if (this.get(&#x27;startIndexExpr&#x27;))
	{
		dataStartIndex = Y.Object.evalGet(this._callback.response, this.get(&#x27;startIndexExpr&#x27;));
	}

	var startIndex   = this._callback.request.startIndex - dataStartIndex;
	response.results = this._callback.response.results.slice(startIndex, startIndex + this._callback.request.resultCount);

	// insertions/removals

	if (!this._index)
	{
		if (this.get(&#x27;totalRecordsReturnExpr&#x27;))
		{
			Y.Object.evalSet(response, this.get(&#x27;totalRecordsReturnExpr&#x27;), this._callback.response.results.length);
		}
		this._count = this.get(&#x27;extractTotalRecords&#x27;)(response);

		this._index = [];
		for (var i=0; i&lt;this._count; i++)
		{
			this._index.push(i);
		}
	}
	else
	{
		var adjust = this._callback.adjust;
		for (var i=adjust.indexStart, k=0; i&lt;adjust.indexEnd; i++, k++)
		{
			var j = this._index[i];
			if (inserted_re.test(j))
			{
				var id = j.substr(inserted_prefix.length);
				response.results.splice(k,0, Y.clone(this._new[id], true));
			}
			else if (removed_hidden_re.test(j))
			{
				response.results.splice(k,1);
				k--;
			}
		}
	}

	// save results so we can refer to them later

	var unique_id_key = this.get(&#x27;uniqueIdKey&#x27;);

	if (!this._callback.request.outOfBand)
	{
		this._records   = [];
		this._recordMap = {};

		Y.Array.each(response.results, function(r)
		{
			var rec = Y.clone(r, true);
			this._records.push(rec);
			this._recordMap[ rec[ unique_id_key ] ] = rec;
		},
		this);
	}

	// merge in diffs

	Y.Array.each(response.results, function(rec)
	{
		var diff = this._diff[ rec[ unique_id_key ] ];
		if (diff)
		{
			Y.mix(rec, diff, true);
		}
	},
	this);

	this._callback.response = response;
	this.fire(&#x27;response&#x27;, this._callback);
}

Y.extend(BulkEditDataSource, Y.DataSource.Local,
{
	initializer: function(config)
	{
		if (!(config.ds instanceof Y.DataSource.Local))
		{
			Y.error(&#x27;BulkEditDataSource requires DataSource&#x27;);
		}

		if (!config.generateRequest)
		{
			Y.error(&#x27;BulkEditDataSource requires generateRequest function&#x27;);
		}

		if (!config.uniqueIdKey)
		{
			Y.error(&#x27;BulkEditDataSource requires uniqueIdKey configuration&#x27;);
		}

		if (!config.extractTotalRecords)
		{
			Y.error(&#x27;BulkEditDataSource requires extractTotalRecords function&#x27;);
		}

		this._index = null;
		this._count = 0;
		this._new   = {};
		this._diff  = {};
	},

	/**
	 * @method _dataIsLocal
	 * @protected
	 * @return {boolean} true if the raw data is stored locally
	 */
	_dataIsLocal: function()
	{
		return (Y.Lang.isArray(this.get(&#x27;ds&#x27;).get(&#x27;source&#x27;)));
	},

	/**
	 * Flush the underlying datasource&#x27;s cache.
	 * 
	 * @method _flushCache
	 * @protected
	 */
	_flushCache: function()
	{
		var ds = this.get(&#x27;ds&#x27;);
		if (ds.cache &amp;&amp; Y.Lang.isFunction(ds.cache.flush))
		{
			ds.cache.flush();
		}
	},

	/**
	 * Use this instead of any meta information in response.
	 * 
	 * @method getRecordCount
	 * @return {Number} the total number of visible records
	 */
	getRecordCount: function()
	{
		return this._count;
	},

	/**
	 * @method getCurrentRecords
	 * @return {Number} the records returned by the latest request
	 */
	getCurrentRecords: function()
	{
		return this._records;
	},

	/**
	 * @method getCurrentRecordMap
	 * @return {Object} the records returned by the latest request, keyed by record id
	 */
	getCurrentRecordMap: function()
	{
		return this._recordMap;
	},

	/**
	 * @method getValue
	 * @param record_index {Number}
	 * @param key {String} field key
	 * @return {mixed} the value of the specified field in the specified record
	 */
	getValue: function(
		/* int */		record_index,
		/* string */	key)
	{
		if (!this._dataIsLocal())
		{
			Y.error(&#x27;BulkEditDataSource.getValue() can only be called when using a local datasource&#x27;);
		}

		var j = fromDisplayIndex.call(this, record_index);
		if (j === false)
		{
			return false;
		}

		j = this._index[j];
		if (inserted_re.test(j))
		{
			var record_id = j.substr(inserted_prefix.length);
			var record    = this._new[ record_id ];
		}
		else
		{
			var record    = this.get(&#x27;ds&#x27;).get(&#x27;source&#x27;)[j];
			var record_id = record[ this.get(&#x27;uniqueIdKey&#x27;) ];
		}

		if (this._diff[ record_id ] &amp;&amp;
			!Y.Lang.isUndefined(this._diff[ record_id ][ key ]))
		{
			return this._diff[ record_id ][ key ];
		}
		else
		{
			return record[key];
		}
	},

	/**
	 * When using a remote datasource, this will include changes made to
	 * deleted records.
	 * 
	 * @method getChanges
	 * @return {Object} map of all changed values, keyed by record id
	 */
	getChanges: function()
	{
		return this._diff;
	},

	/**
	 * @method getRemovedRecordIndexes
	 * @return {Array} list of removed record indices, based on initial ordering
	 */
	getRemovedRecordIndexes: function()
	{
		var list = [];
		Y.Array.each(this._index, function(j)
		{
			if (removed_re.test(j))
			{
				list.push(parseInt(j.substr(removed_prefix.length), 10));
			}
		});

		return list;
	},

	/**
	 * @method getHiddenRecordIndexes
	 * @return {Array} list of hidden record indices, based on initial ordering
	 */
	getHiddenRecordIndexes: function()
	{
		var list = [];
		Y.Array.each(this._index, function(j)
		{
			if (hidden_re.test(j))
			{
				list.push(parseInt(j.substr(hidden_prefix.length), 10));
			}
		});

		return list;
	},

	/**
	 * You must &#x60;reload&#x60; the widget after calling this function!
	 * 
	 * @method insertRecord
	 * @protected
	 * @param index {Number} insertion index
	 * @param record {Object|String} record to insert or id of record to clone
	 * @return {String} id of newly inserted record
	 */
	insertRecord: function(
		/* int */		index,
		/* object */	record)
	{
		this._count++;

		var record_id     = String(this.get(&#x27;generateUniqueId&#x27;)()),
			unique_id_key = this.get(&#x27;uniqueIdKey&#x27;);

		this._new[ record_id ]                  = {};
		this._new[ record_id ][ unique_id_key ] = record_id;

		var j = fromDisplayIndex.call(this, index);
		if (j === false)
		{
			j = this._index.length;
		}
		this._index.splice(j, 0, inserted_prefix+record_id);

		if (record &amp;&amp; !Y.Lang.isObject(record))		// clone existing record
		{
			var s    = record.toString();
			record   = Y.clone(this._recordMap[s] || this._new[s], true);
			var diff = this._diff[s];
			if (record &amp;&amp; diff)
			{
				Y.mix(record, diff, true);
			}
		}

		if (record)		// insert initial values into _diff
		{
			Y.Object.each(record, function(value, key)
			{
				if (key != unique_id_key)
				{
					this.updateValue(record_id, key, value);
				}
			},
			this);
		}

		return record_id;
	},

	/**
	 * You must &#x60;reload&#x60; the widget after calling this function!
	 * 
	 * @method removeRecord
	 * @protected
	 * @param index {Number} index of record to remove
	 * @return {boolean} true if record was removed
	 */
	removeRecord: function(
		/* int */ index)
	{
		var j = fromDisplayIndex.call(this, index);
		if (j === false)
		{
			return false;
		}

		this._count--;

		if (inserted_re.test(this._index[j]))
		{
			var record_id = this._index[j].substr(inserted_prefix.length);
			delete this._new[ record_id ];
			this._index.splice(j,1);
		}
		else
		{
			if (this._dataIsLocal())
			{
				var record_id = this.get(&#x27;ds&#x27;).get(&#x27;source&#x27;)[ this._index[j] ][ this.get(&#x27;uniqueIdKey&#x27;) ].toString();
			}

			this._index[j] = removed_prefix + this._index[j];
		}

		if (record_id)
		{
			delete this._diff[ record_id ];
		}

		return true;
	},

	/**
	 * Inverse of &#x60;removeRecord&#x60;, but only for pre-existing records and
	 * only with &#x60;DataSource.Local&#x60;.  Changes made before the record was
	 * removed are not restored.
	 *
	 * You must &#x60;reload&#x60; the widget after calling this function!
	 * 
	 * @method restoreRecord
	 * @protected
	 * @param record_id {String}
	 * @return {int} the restored record&#x27;s index or -1 if record id is not found
	 */
	restoreRecord: function(
		/* string */ record_id)
	{
		return this._restoreRecord(record_id, removed_re, removed_prefix, &#x27;restoreRecord&#x27;);
	},

	/**
	 * Update a value in a record.
	 *
	 * @method updateValue
	 * @protected
	 * @param record_id {String}
	 * @param key {String} field key
	 * @param value {String} new item value
	 * @param [set_as_default] {boolean} pass &#x60;true&#x60; to make this the new default value - must call editor.reload() afterwards!
	 */
	updateValue: function(
		/* string */	record_id,
		/* string */	key,
		/* string */	value,
		/* bool */		set_as_default)
	{
		if (key == this.get(&#x27;uniqueIdKey&#x27;))
		{
			Y.error(&#x27;BulkEditDataSource.updateValue() does not allow changing the id for a record.  Use BulkEditDataSource.updateRecordId() instead.&#x27;);
		}

		if (set_as_default &amp;&amp; !this._dataIsLocal())
		{
			Y.error(&#x27;BulkEditDataSource.updateValue() can only be called with set_as_default=true when using a local datasource&#x27;);
		}

		record_id  = record_id.toString();
		var record = this._recordMap[ record_id ];

		function removeFromDiff()
		{
			if (this._diff[ record_id ])
			{
				delete this._diff[ record_id ][ key ];

				if (Y.Object.keys(this._diff[ record_id ]).length === 0)
				{
					delete this._diff[ record_id ];
				}
			}
		}

		if (set_as_default)
		{
			var unique_id_key = this.get(&#x27;uniqueIdKey&#x27;);
			Y.Array.some(this.get(&#x27;ds&#x27;).get(&#x27;source&#x27;), function(rec)
			{
				if (rec[ unique_id_key ].toString() === record_id)
				{
					rec[ key ] = value;
					removeFromDiff.call(this);
					return true;
				}
			},
			this);
		}
		else if (record &amp;&amp; this._getComparator(key)(Y.Lang.isValue(record[key]) ? record[key] : &#x27;&#x27;, Y.Lang.isValue(value) ? value : &#x27;&#x27;))
		{
			removeFromDiff.call(this);
		}
		else	// might be new record
		{
			if (!this._diff[ record_id ])
			{
				this._diff[ record_id ] = {};
			}
			this._diff[ record_id ][ key ] = value;
		}
	},

	/**
	 * @method _getComparator
	 * @protected
	 * @param key {String} field key
	 * @return {Function} comparator function for the given field
	 */
	_getComparator: function(
		/* string */ key)
	{
		var f = (this._fields[key] &amp;&amp; this._fields[key].comparator) || &#x27;string&#x27;;
		if (Y.Lang.isFunction(f))
		{
			return f;
		}
		else if (BulkEditDataSource.comparator[f])
		{
			return BulkEditDataSource.comparator[f];
		}
		else
		{
			return BulkEditDataSource.comparator.string;
		}
	},

	/**
	 * Merge changes into the underlying data, to flush diffs for a record.
	 * Only usable with DataSource.Local.  When using best-effort save on
	 * the server, call this for each record that was successfully saved.
	 *
	 * @method mergeChanges
	 * @param record_id {String}
	 */
	mergeChanges: function(
		/* string */ record_id)
	{
		if (!this._dataIsLocal())
		{
			Y.error(&#x27;BulkEditDataSource.mergeChanges() can only be called when using a local datasource&#x27;);
		}

		record_id         = record_id.toString();
		var unique_id_key = this.get(&#x27;uniqueIdKey&#x27;);

		function merge(rec)
		{
			if (rec[ unique_id_key ].toString() === record_id)
			{
				var diff = this._diff[ record_id ];
				if (diff)
				{
					Y.mix(rec, diff, true);
					delete this._diff[ record_id ];
				}
				return true;
			}
		}

		var found = false;
		this._flushCache();

		Y.Array.some(this.get(&#x27;ds&#x27;).get(&#x27;source&#x27;), function(rec)
		{
			if (merge.call(this, rec))
			{
				found = true;
				return true;
			}
		},
		this);

		if (!found)
		{
			Y.Object.some(this._new, function(rec)
			{
				if (merge.call(this, rec))
				{
					found = true;
					return true;
				}
			},
			this);
		}
	},

	/**
	 * &lt;p&gt;Completely remove a record, from both the display and the
	 * underlying data.  Only usable with DataSource.Local.  When using
	 * best-effort save on the server, call this for each record that was
	 * successfully deleted.&lt;/p&gt;
	 * 
	 * &lt;p&gt;You must &#x60;reload&#x60; the widget after calling this function!&lt;/p&gt;
	 * 
	 * @method killRecord
	 * @param record_id {String}
	 */
	killRecord: function(
		/* string */ record_id)
	{
		if (!this._dataIsLocal())
		{
			Y.error(&#x27;BulkEditDataSource.killRecord() can only be called when using a local datasource&#x27;);
		}

		record_id         = record_id.toString();
		var unique_id_key = this.get(&#x27;uniqueIdKey&#x27;);

		function kill(rec)
		{
			if (rec[ unique_id_key ].toString() === record_id)
			{
				var info = {};
				this.recordIdToIndex(record_id, info);

				var j = this._index[ info.internal_index ];
				this._index.splice(info.internal_index, 1);
				if (!inserted_re.test(j))
				{
					for (var i=info.internal_index; i&lt;this._index.length; i++)
					{
						var k = this._index[i];
						if (removed_re.test(k))
						{
							this._index[i] = removed_prefix +
								(parseInt(k.substr(removed_prefix.length), 10)-1);
						}
						else if (hidden_re.test(k))
						{
							this._index[i] = hidden_prefix +
								(parseInt(k.substr(hidden_prefix.length), 10)-1);
						}
						else if (!inserted_re.test(k))
						{
							this._index[i]--;
						}
					}
				}

				this._count--;
				delete this._diff[ record_id ];
				return true;
			}
		}

		var found = false;
		this._flushCache();

		var data = this.get(&#x27;ds&#x27;).get(&#x27;source&#x27;);
		Y.Array.some(data, function(value, i)
		{
			if (kill.call(this, value))
			{
				data.splice(i,1);
				found = true;
				return true;
			}
		},
		this);

		if (!found)
		{
			Y.Object.some(this._new, function(value, id)
			{
				if (kill.call(this, value))
				{
					delete this._new[id];
					found = true;
					return true;
				}
			},
			this);
		}
	},

	/**
	 * &lt;p&gt;Change the id of a record.  Only usable with DataSource.Local.
	 * When using best-effort save on the server, call this for each newly
	 * created record that was successfully saved.&lt;/p&gt;
	 * 
	 * &lt;p&gt;You must &#x60;reload&#x60; the widget after calling this function!&lt;/p&gt;
	 * 
	 * @method updateRecordId
	 * @param orig_record_id {String}
	 * @param new_record_id {String}
	 */
	updateRecordId: function(
		/* string */	orig_record_id,
		/* string */	new_record_id)
	{
		if (!this._dataIsLocal())
		{
			Y.error(&#x27;BulkEditDataSource.updateRecordId() can only be called when using a local datasource&#x27;);
		}

		orig_record_id    = orig_record_id.toString();
		new_record_id     = new_record_id.toString();
		var unique_id_key = this.get(&#x27;uniqueIdKey&#x27;);

		function update(rec)
		{
			if (rec[ unique_id_key ].toString() === orig_record_id)
			{
				var info = {};
				this.recordIdToIndex(orig_record_id, info);
				var j = info.internal_index;
				if (inserted_re.test(this._index[j]))
				{
					this._index[j] = inserted_prefix + new_record_id;
				}

				rec[ unique_id_key ] = new_record_id;
				if (this._diff[ orig_record_id ])
				{
					this._diff[ new_record_id ] = this._diff[ orig_record_id ];
					delete this._diff[ orig_record_id ];
				}
				return true;
			}
		}

		var found = false;
		this._flushCache();

		Y.Array.some(this.get(&#x27;ds&#x27;).get(&#x27;source&#x27;), function(value)
		{
			if (update.call(this, value))
			{
				found = true;
				return true;
			}
		},
		this);

		if (!found)
		{
			Y.Object.some(this._new, function(value, id)
			{
				if (update.call(this, value))
				{
					this._new[ new_record_id ] = value;
					delete this._new[id];
					found = true;
					return true;
				}
			},
			this);
		}
	},

	/**
	 * Only usable with &#x60;DataSource.Local&#x60;.
	 *
	 * You must &#x60;reload&#x60; the widget after calling this function!
	 * 
	 * @method showRecord
	 * @protected
	 * @param record_id {String}
	 * @return {int} the newly visible record&#x27;s index or -1 if record id is not found
	 */
	showRecord: function(
		/* string */ record_id)
	{
		return this._restoreRecord(record_id, hidden_re, hidden_prefix, &#x27;showRecord&#x27;);
	},

	/**
	 * Only usable with &#x60;DataSource.Local&#x60;.
	 *
	 * You must &#x60;reload&#x60; the widget after calling this function!
	 * 
	 * You can only hide pre-existing, unmodified records.  Otherwise, you
	 * might get a validation error on a hidden record.
	 * 
	 * @method hideRecord
	 * @protected
	 * @param index {Number} index of record to hide
	 * @return {boolean} true if record is now hidden
	 */
	hideRecord: function(
		/* int */ index)
	{
		if (!this._dataIsLocal())
		{
			Y.error(&#x27;BulkEditDataSource.hideRecord() can only be called when using a local datasource&#x27;);
		}

		var j = fromDisplayIndex.call(this, index);
		if (j === false || inserted_re.test(this._index[j]))
		{
			return false;
		}

		var record_id = this.get(&#x27;ds&#x27;).get(&#x27;source&#x27;)[ this._index[j] ][ this.get(&#x27;uniqueIdKey&#x27;) ].toString();
		if (this._diff[ record_id ])
		{
			return false;
		}

		this._count--;
		this._index[j] = hidden_prefix + this._index[j];
		return true;
	},

	/**
	 * Only usable with &#x60;DataSource.Local&#x60;.
	 *
	 * You must &#x60;reload&#x60; the widget after calling this function!
	 * 
	 * @method _restoreRecord
	 * @private
	 * @param record_id {String}
	 * @return {int} the newly visible record&#x27;s index or -1 if record id is not found
	 */
	_restoreRecord: function(
		/* string */	record_id,
		/* RegExp */	re,
		/* string */	prefix,
		/* string */	caller_name)
	{
		if (!this._dataIsLocal())
		{
			Y.error(&#x27;BulkEditDataSource.&#x27; + caller_name + &#x27;() can only be called when using a local datasource&#x27;);
		}

		record_id         = record_id.toString();
		var unique_id_key = this.get(&#x27;uniqueIdKey&#x27;);

		var records = this.get(&#x27;ds&#x27;).get(&#x27;source&#x27;);
		var count   = 0;
		for (var i=0; i&lt;this._index.length; i++)
		{
			var j = this._index[i];
			if (re.test(j))
			{
				var k = j.substr(prefix.length);
				if (records[k][ unique_id_key ].toString() === record_id)
				{
					this._count++;
					this._index[i] = k;
					return count;
				}
			}

			if (!removed_re.test(j))
			{
				count++;
			}
		}

		return -1;
	},

	/**
	 * Find the index of the given record id.  Only usable with
	 * &#x60;DataSource.Local&#x60;.
	 * 
	 * @method recordIdToIndex
	 * @param record_id {String}
	 * @return {Number} index of record or -1 if not found
	 */
	recordIdToIndex: function(
		/* string */	record_id,
		/* object */	return_info)
	{
		if (!this._dataIsLocal())
		{
			Y.error(&#x27;BulkEditDataSource.recordIdToIndex() can only be called when using a local datasource&#x27;);
		}

		record_id         = record_id.toString();
		var unique_id_key = this.get(&#x27;uniqueIdKey&#x27;);

		var records = this.get(&#x27;ds&#x27;).get(&#x27;source&#x27;);
		var count   = 0;
		for (var i=0; i&lt;this._index.length; i++)
		{
			var j   = this._index[i];
			var ins = inserted_re.test(j);
			var del = removed_hidden_re.test(j);
			if ((ins &amp;&amp;
				 j.substr(inserted_prefix.length) === record_id) ||
				(!ins &amp;&amp; !del &amp;&amp;
				 records[j][ unique_id_key ].toString() === record_id))
			{
				if (return_info)
				{
					return_info.internal_index = i;
				}
				return count;
			}

			if (!del)
			{
				count++;
			}
		}

		return -1;
	},

	/**
	 * Merges edits into data and returns result.
	 * 
	 * @method _defRequestFn
	 * @protected
	 */
	_defRequestFn: function(e)
	{
		this._callback = e;
		adjustRequest.call(this);

		this._generatingRequest = true;

		delete this._callback._tId;		// clear it so internalSuccess works for synch response
		this._callback._tId = this.get(&#x27;ds&#x27;).sendRequest(
		{
			request: this.get(&#x27;generateRequest&#x27;)(this._callback.request),
			callback:
			{
				success: Y.bind(internalSuccess, this),
				failure: Y.bind(internalFailure, this)
			}
		});

		this._generatingRequest = false;
		checkFinished.call(this);
	}
});

Y.BulkEditDataSource = BulkEditDataSource;
Y.namespace(&#x27;DataSource&#x27;).BulkEdit = BulkEditDataSource;

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
