<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src&#x2F;gallery-treeble&#x2F;js&#x2F;TreebleDataSource.js - YUI 3 Gallery Modules</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.7.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.7.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="YUI 3 Gallery Modules"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/Accordion.html">Accordion</a></li>
            
                <li><a href="..&#x2F;classes/AnimSequence.html">AnimSequence</a></li>
            
                <li><a href="..&#x2F;classes/ArrayIterator.html">ArrayIterator</a></li>
            
                <li><a href="..&#x2F;classes/ArrayList~extras.html">ArrayList~extras</a></li>
            
                <li><a href="..&#x2F;classes/Array~algorithms.html">Array~algorithms</a></li>
            
                <li><a href="..&#x2F;classes/Array~funcprog-extras.html">Array~funcprog-extras</a></li>
            
                <li><a href="..&#x2F;classes/Array~object-extras.html">Array~object-extras</a></li>
            
                <li><a href="..&#x2F;classes/Assert.html">Assert</a></li>
            
                <li><a href="..&#x2F;classes/AtLeastOneCheckboxGroup.html">AtLeastOneCheckboxGroup</a></li>
            
                <li><a href="..&#x2F;classes/AtMostOneCheckboxGroup.html">AtMostOneCheckboxGroup</a></li>
            
                <li><a href="..&#x2F;classes/BulkEditor.html">BulkEditor</a></li>
            
                <li><a href="..&#x2F;classes/Canvas.Context2d.html">Canvas.Context2d</a></li>
            
                <li><a href="..&#x2F;classes/CheckboxGroup.html">CheckboxGroup</a></li>
            
                <li><a href="..&#x2F;classes/Chipper.html">Chipper</a></li>
            
                <li><a href="..&#x2F;classes/ComplexMath.html">ComplexMath</a></li>
            
                <li><a href="..&#x2F;classes/ComplexNumber.html">ComplexNumber</a></li>
            
                <li><a href="..&#x2F;classes/DataSource.AsyncFunction.html">DataSource.AsyncFunction</a></li>
            
                <li><a href="..&#x2F;classes/DataSource.BulkEdit.html">DataSource.BulkEdit</a></li>
            
                <li><a href="..&#x2F;classes/DataSource.Treeble.html">DataSource.Treeble</a></li>
            
                <li><a href="..&#x2F;classes/DateTimeUtils.html">DateTimeUtils</a></li>
            
                <li><a href="..&#x2F;classes/EnableIfAnyCheckboxGroup.html">EnableIfAnyCheckboxGroup</a></li>
            
                <li><a href="..&#x2F;classes/ExpirationCache.html">ExpirationCache</a></li>
            
                <li><a href="..&#x2F;classes/ExpressionBuilder.html">ExpressionBuilder</a></li>
            
                <li><a href="..&#x2F;classes/FormManager.html">FormManager</a></li>
            
                <li><a href="..&#x2F;classes/HTMLTableBulkEditor.html">HTMLTableBulkEditor</a></li>
            
                <li><a href="..&#x2F;classes/InstanceManager.html">InstanceManager</a></li>
            
                <li><a href="..&#x2F;classes/io~multiresponse.html">io~multiresponse</a></li>
            
                <li><a href="..&#x2F;classes/Iterable.html">Iterable</a></li>
            
                <li><a href="..&#x2F;classes/LinkedList.html">LinkedList</a></li>
            
                <li><a href="..&#x2F;classes/LinkedListItem.html">LinkedListItem</a></li>
            
                <li><a href="..&#x2F;classes/LinkedListIterator.html">LinkedListIterator</a></li>
            
                <li><a href="..&#x2F;classes/LogFilter.html">LogFilter</a></li>
            
                <li><a href="..&#x2F;classes/Math.html">Math</a></li>
            
                <li><a href="..&#x2F;classes/MathCanvas.html">MathCanvas</a></li>
            
                <li><a href="..&#x2F;classes/MathCanvas.Parser.html">MathCanvas.Parser</a></li>
            
                <li><a href="..&#x2F;classes/MathCanvas.RectList.html">MathCanvas.RectList</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.html">MathFunction</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Arccosine.html">MathFunction.Arccosine</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Arcsine.html">MathFunction.Arcsine</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Arctangent.html">MathFunction.Arctangent</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Arctangent2.html">MathFunction.Arctangent2</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Conjugate.html">MathFunction.Conjugate</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Cosine.html">MathFunction.Cosine</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.E.html">MathFunction.E</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Exponential.html">MathFunction.Exponential</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.FunctionWithArgs.html">MathFunction.FunctionWithArgs</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.HyperbolicCosine.html">MathFunction.HyperbolicCosine</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.HyperbolicSine.html">MathFunction.HyperbolicSine</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.HyperbolicTangent.html">MathFunction.HyperbolicTangent</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.I.html">MathFunction.I</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.ImaginaryPart.html">MathFunction.ImaginaryPart</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.InverseHyperbolicCosine.html">MathFunction.InverseHyperbolicCosine</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.InverseHyperbolicSine.html">MathFunction.InverseHyperbolicSine</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.InverseHyperbolicTangent.html">MathFunction.InverseHyperbolicTangent</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Logarithm.html">MathFunction.Logarithm</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Magnitude.html">MathFunction.Magnitude</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Max.html">MathFunction.Max</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Min.html">MathFunction.Min</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.NaturalLog.html">MathFunction.NaturalLog</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Negate.html">MathFunction.Negate</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Phase.html">MathFunction.Phase</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Pi.html">MathFunction.Pi</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Product.html">MathFunction.Product</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Quotient.html">MathFunction.Quotient</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.RealPart.html">MathFunction.RealPart</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Rotate.html">MathFunction.Rotate</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Sine.html">MathFunction.Sine</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.SquareRoot.html">MathFunction.SquareRoot</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Sum.html">MathFunction.Sum</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Tangent.html">MathFunction.Tangent</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Value.html">MathFunction.Value</a></li>
            
                <li><a href="..&#x2F;classes/MathFunction.Variable.html">MathFunction.Variable</a></li>
            
                <li><a href="..&#x2F;classes/MatrixBackground.html">MatrixBackground</a></li>
            
                <li><a href="..&#x2F;classes/MatrixCredits.html">MatrixCredits</a></li>
            
                <li><a href="..&#x2F;classes/MRUCache.html">MRUCache</a></li>
            
                <li><a href="..&#x2F;classes/MultiObject.html">MultiObject</a></li>
            
                <li><a href="..&#x2F;classes/NodeList~extras2.html">NodeList~extras2</a></li>
            
                <li><a href="..&#x2F;classes/Node~dimensions.html">Node~dimensions</a></li>
            
                <li><a href="..&#x2F;classes/Node~event-set.html">Node~event-set</a></li>
            
                <li><a href="..&#x2F;classes/Node~optimizations.html">Node~optimizations</a></li>
            
                <li><a href="..&#x2F;classes/Node~scrollIntoView.html">Node~scrollIntoView</a></li>
            
                <li><a href="..&#x2F;classes/Object~extras.html">Object~extras</a></li>
            
                <li><a href="..&#x2F;classes/PageLayout.html">PageLayout</a></li>
            
                <li><a href="..&#x2F;classes/Paginator.html">Paginator</a></li>
            
                <li><a href="..&#x2F;classes/Paginator.ui.CurrentPageInput.html">Paginator.ui.CurrentPageInput</a></li>
            
                <li><a href="..&#x2F;classes/Paginator.ui.CurrentPageReport.html">Paginator.ui.CurrentPageReport</a></li>
            
                <li><a href="..&#x2F;classes/Paginator.ui.FirstPageLink.html">Paginator.ui.FirstPageLink</a></li>
            
                <li><a href="..&#x2F;classes/Paginator.ui.ItemRangeDropdown.html">Paginator.ui.ItemRangeDropdown</a></li>
            
                <li><a href="..&#x2F;classes/Paginator.ui.LastPageLink.html">Paginator.ui.LastPageLink</a></li>
            
                <li><a href="..&#x2F;classes/Paginator.ui.NextPageLink.html">Paginator.ui.NextPageLink</a></li>
            
                <li><a href="..&#x2F;classes/Paginator.ui.PageLinks.html">Paginator.ui.PageLinks</a></li>
            
                <li><a href="..&#x2F;classes/Paginator.ui.PreviousPageLink.html">Paginator.ui.PreviousPageLink</a></li>
            
                <li><a href="..&#x2F;classes/Paginator.ui.RowsPerPageDropdown.html">Paginator.ui.RowsPerPageDropdown</a></li>
            
                <li><a href="..&#x2F;classes/Paginator.ui.ValidationPageLinks.html">Paginator.ui.ValidationPageLinks</a></li>
            
                <li><a href="..&#x2F;classes/Parsers.html">Parsers</a></li>
            
                <li><a href="..&#x2F;classes/Plugin.BusyOverlay.html">Plugin.BusyOverlay</a></li>
            
                <li><a href="..&#x2F;classes/Plugin.ConsoleTest.html">Plugin.ConsoleTest</a></li>
            
                <li><a href="..&#x2F;classes/Plugin.DataTableQuickEdit.html">Plugin.DataTableQuickEdit</a></li>
            
                <li><a href="..&#x2F;classes/Plugin.DataTableRowExpansion.html">Plugin.DataTableRowExpansion</a></li>
            
                <li><a href="..&#x2F;classes/Plugin.DataTableState.html">Plugin.DataTableState</a></li>
            
                <li><a href="..&#x2F;classes/Plugin.FixedSizeAccordion.html">Plugin.FixedSizeAccordion</a></li>
            
                <li><a href="..&#x2F;classes/Plugin.InputCalendarSync.html">Plugin.InputCalendarSync</a></li>
            
                <li><a href="..&#x2F;classes/Plugin.Neon.html">Plugin.Neon</a></li>
            
                <li><a href="..&#x2F;classes/Plugin.NodeFXSequence.html">Plugin.NodeFXSequence</a></li>
            
                <li><a href="..&#x2F;classes/Plugin.OverlayForm.html">Plugin.OverlayForm</a></li>
            
                <li><a href="..&#x2F;classes/Plugin.PageLayoutDataTableModule.html">Plugin.PageLayoutDataTableModule</a></li>
            
                <li><a href="..&#x2F;classes/QueryBuilder.html">QueryBuilder</a></li>
            
                <li><a href="..&#x2F;classes/QueryBuilder.Select.html">QueryBuilder.Select</a></li>
            
                <li><a href="..&#x2F;classes/QueryBuilder.String.html">QueryBuilder.String</a></li>
            
                <li><a href="..&#x2F;classes/RPC.Mojito.html">RPC.Mojito</a></li>
            
                <li><a href="..&#x2F;classes/SelectAllCheckboxGroup.html">SelectAllCheckboxGroup</a></li>
            
                <li><a href="..&#x2F;classes/Sort.html">Sort</a></li>
            
                <li><a href="..&#x2F;classes/Treeble.html">Treeble</a></li>
            
                <li><a href="..&#x2F;classes/YUI~funcprog.html">YUI~funcprog</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/gallery-accordion-horiz-vert.html">gallery-accordion-horiz-vert</a></li>
            
                <li><a href="..&#x2F;modules/gallery-algorithms.html">gallery-algorithms</a></li>
            
                <li><a href="..&#x2F;modules/gallery-anim-class.html">gallery-anim-class</a></li>
            
                <li><a href="..&#x2F;modules/gallery-anim-sequence.html">gallery-anim-sequence</a></li>
            
                <li><a href="..&#x2F;modules/gallery-bulkedit.html">gallery-bulkedit</a></li>
            
                <li><a href="..&#x2F;modules/gallery-busyoverlay.html">gallery-busyoverlay</a></li>
            
                <li><a href="..&#x2F;modules/gallery-canvas.html">gallery-canvas</a></li>
            
                <li><a href="..&#x2F;modules/gallery-checkboxgroups.html">gallery-checkboxgroups</a></li>
            
                <li><a href="..&#x2F;modules/gallery-chipper.html">gallery-chipper</a></li>
            
                <li><a href="..&#x2F;modules/gallery-complexnumber.html">gallery-complexnumber</a></li>
            
                <li><a href="..&#x2F;modules/gallery-console-test.html">gallery-console-test</a></li>
            
                <li><a href="..&#x2F;modules/gallery-datasource-async-function.html">gallery-datasource-async-function</a></li>
            
                <li><a href="..&#x2F;modules/gallery-datatable-row-expansion.html">gallery-datatable-row-expansion</a></li>
            
                <li><a href="..&#x2F;modules/gallery-datatable-state.html">gallery-datatable-state</a></li>
            
                <li><a href="..&#x2F;modules/gallery-datetime-utils.html">gallery-datetime-utils</a></li>
            
                <li><a href="..&#x2F;modules/gallery-dimensions.html">gallery-dimensions</a></li>
            
                <li><a href="..&#x2F;modules/gallery-expiration-cache.html">gallery-expiration-cache</a></li>
            
                <li><a href="..&#x2F;modules/gallery-exprbuilder.html">gallery-exprbuilder</a></li>
            
                <li><a href="..&#x2F;modules/gallery-formmgr.html">gallery-formmgr</a></li>
            
                <li><a href="..&#x2F;modules/gallery-formmgr-css-validation.html">gallery-formmgr-css-validation</a></li>
            
                <li><a href="..&#x2F;modules/gallery-formmgr-overlay-plugin.html">gallery-formmgr-overlay-plugin</a></li>
            
                <li><a href="..&#x2F;modules/gallery-funcprog.html">gallery-funcprog</a></li>
            
                <li><a href="..&#x2F;modules/gallery-input-calendar-sync.html">gallery-input-calendar-sync</a></li>
            
                <li><a href="..&#x2F;modules/gallery-instancemanager.html">gallery-instancemanager</a></li>
            
                <li><a href="..&#x2F;modules/gallery-io-multiresponse.html">gallery-io-multiresponse</a></li>
            
                <li><a href="..&#x2F;modules/gallery-iterable-extras.html">gallery-iterable-extras</a></li>
            
                <li><a href="..&#x2F;modules/gallery-layout.html">gallery-layout</a></li>
            
                <li><a href="..&#x2F;modules/gallery-layout-cols.html">gallery-layout-cols</a></li>
            
                <li><a href="..&#x2F;modules/gallery-layout-datatable.html">gallery-layout-datatable</a></li>
            
                <li><a href="..&#x2F;modules/gallery-layout-rows.html">gallery-layout-rows</a></li>
            
                <li><a href="..&#x2F;modules/gallery-linkedlist.html">gallery-linkedlist</a></li>
            
                <li><a href="..&#x2F;modules/gallery-log-filter.html">gallery-log-filter</a></li>
            
                <li><a href="..&#x2F;modules/gallery-math.html">gallery-math</a></li>
            
                <li><a href="..&#x2F;modules/gallery-mathcanvas.html">gallery-mathcanvas</a></li>
            
                <li><a href="..&#x2F;modules/gallery-matrix-background.html">gallery-matrix-background</a></li>
            
                <li><a href="..&#x2F;modules/gallery-matrix-credits.html">gallery-matrix-credits</a></li>
            
                <li><a href="..&#x2F;modules/gallery-mojito-rpc.html">gallery-mojito-rpc</a></li>
            
                <li><a href="..&#x2F;modules/gallery-mru-cache.html">gallery-mru-cache</a></li>
            
                <li><a href="..&#x2F;modules/gallery-multiobject.html">gallery-multiobject</a></li>
            
                <li><a href="..&#x2F;modules/gallery-neon.html">gallery-neon</a></li>
            
                <li><a href="..&#x2F;modules/gallery-node-event-set.html">gallery-node-event-set</a></li>
            
                <li><a href="..&#x2F;modules/gallery-node-optimizations.html">gallery-node-optimizations</a></li>
            
                <li><a href="..&#x2F;modules/gallery-nodelist-extras2.html">gallery-nodelist-extras2</a></li>
            
                <li><a href="..&#x2F;modules/gallery-object-extras.html">gallery-object-extras</a></li>
            
                <li><a href="..&#x2F;modules/gallery-paginator.html">gallery-paginator</a></li>
            
                <li><a href="..&#x2F;modules/gallery-querybuilder.html">gallery-querybuilder</a></li>
            
                <li><a href="..&#x2F;modules/gallery-quickedit.html">gallery-quickedit</a></li>
            
                <li><a href="..&#x2F;modules/gallery-scrollintoview.html">gallery-scrollintoview</a></li>
            
                <li><a href="..&#x2F;modules/gallery-sort-extras.html">gallery-sort-extras</a></li>
            
                <li><a href="..&#x2F;modules/gallery-test-extras.html">gallery-test-extras</a></li>
            
                <li><a href="..&#x2F;modules/gallery-treeble.html">gallery-treeble</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src&#x2F;gallery-treeble&#x2F;js&#x2F;TreebleDataSource.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&quot;use strict&quot;;

&#x2F;**
 * @module gallery-treeble
 *&#x2F;

&#x2F;**********************************************************************
 * &lt;p&gt;Hierarchical data source.&lt;&#x2F;p&gt;
 *
 * &lt;p&gt;TreebleDataSource converts a tree of DataSources into a flat list of
 * visible items.  The merged list must be paginated if the number of child
 * nodes might be very large.  To turn on this feature, set
 * paginateChildren:true.&lt;&#x2F;p&gt;
 * 
 * &lt;p&gt;The tree must be immutable.  The total number of items available from
 * each DataSource must remain constant.  (The one exception to this rule
 * is that filtering and sorting are allowed.  This is done by detecting
 * that the request parameters have changed.)&lt;&#x2F;p&gt;
 * 
 * @namespace DataSource
 * @class Treeble
 * @extends DataSource.Local
 * @constructor
 * @param config {Object}
 *&#x2F;

function TreebleDataSource()
{
	TreebleDataSource.superclass.constructor.apply(this, arguments);
}

TreebleDataSource.NAME = &quot;treebleDataSource&quot;;

TreebleDataSource.ATTRS =
{
	&#x2F;**
	 * &lt;p&gt;The root datasource.&lt;&#x2F;p&gt;
	 * 
	 * &lt;p&gt;You &lt;em&gt;must&lt;&#x2F;em&gt; directly set a &lt;code&gt;treeble_config&lt;&#x2F;code&gt;
	 * object on this datasource.  (You cannot use
	 * &lt;code&gt;set(&#x27;treeble_config&#x27;,...)&lt;&#x2F;code&gt;.) &lt;code&gt;treeble_config&lt;&#x2F;code&gt; can
	 * contain the following configuration:&lt;&#x2F;p&gt;
	 * 
	 * &lt;dl&gt;
	 * &lt;dt&gt;generateRequest&lt;&#x2F;dt&gt;
	 * &lt;dd&gt;(required) The function to convert the initial request into
	 *		a request usable by the actual DataSource.  This function takes
	 *		two arguments: state (sort,dir,startIndex,resultCount) and path
	 *		(an array of node indices telling how to reach the node).
	 *		&lt;&#x2F;dd&gt;
	 * &lt;dt&gt;requestCfg&lt;&#x2F;dt&gt;
	 * &lt;dd&gt;(optional) Configuration object passed as &lt;code&gt;cfg&lt;&#x2F;code&gt; to
	 *		&lt;code&gt;sendRequest&lt;&#x2F;code&gt;.&lt;&#x2F;dd&gt;
	 * &lt;dt&gt;schemaPluginConfig&lt;&#x2F;dt&gt;
	 * &lt;dd&gt;(required) Object to pass to &lt;code&gt;plug&lt;&#x2F;code&gt; to install a schema.&lt;&#x2F;dd&gt;
	 * &lt;dt&gt;cachePluginConfig&lt;&#x2F;dt&gt;
	 * &lt;dd&gt;(optional) Object to pass to &lt;code&gt;plug&lt;&#x2F;code&gt; to install a cache.&lt;&#x2F;dd&gt;
	 * &lt;dt&gt;childNodesKey&lt;&#x2F;dt&gt;
	 * &lt;dd&gt;(semi-optional) The name of the key inside a node which contains
	 *		the data used to construct the DataSource for retrieving the children.
	 *		This config is only required if you provide a custom parser.&lt;&#x2F;dd&gt;
	 * &lt;dt&gt;nodeOpenKey&lt;&#x2F;dt&gt;
	 * &lt;dd&gt;(optional) The name of the key inside a node which contains
	 *		the initial open state of the node.  If it is true, the node will
	 *		automatically be opened the first time it is shown.  (After that,
	 *		it will remember the state set by the user.)&lt;&#x2F;dd&gt;
	 * &lt;dt&gt;startIndexExpr&lt;&#x2F;dt&gt;
	 * &lt;dd&gt;(optional) OGNL expression telling how to extract the startIndex
	 *		from the received data, e.g., &lt;code&gt;.meta.startIndex&lt;&#x2F;code&gt;.
	 *		If it is not provided, startIndex is always assumed to be zero.&lt;&#x2F;dd&gt;
	 * &lt;dt&gt;totalRecordsExpr&lt;&#x2F;dt&gt;
	 * &lt;dd&gt;(semi-optional) OGNL expression telling how to extract the total number
	 *		of records from the received data, e.g., &lt;code&gt;.meta.totalRecords&lt;&#x2F;code&gt;.
	 *		If this is not provided, &lt;code&gt;totalRecordsReturnExpr&lt;&#x2F;code&gt; must be
	 *		specified.&lt;&#x2F;dd&gt;
	 * &lt;dt&gt;totalRecordsReturnExpr&lt;&#x2F;dt&gt;
	 * &lt;dd&gt;(semi-optional) OGNL expression telling where in the response to store
	 *		the total number of records, e.g., &lt;code&gt;.meta.totalRecords&lt;&#x2F;code&gt;.
	 *		This is only appropriate for DataSources that always return the
	 *		entire data set.  If this is not provided,
	 *		&lt;code&gt;totalRecordsExpr&lt;&#x2F;code&gt; must be specified.  If both are provided,
	 *		&lt;code&gt;totalRecordsExpr&lt;&#x2F;code&gt; takes priority.&lt;&#x2F;dd&gt;
	 * &lt;&#x2F;dl&gt;
	 * 
	 * @attribute root
	 * @type {DataSource}
	 * @writeonce
	 *&#x2F;
	root:
	{
		writeOnce: true
	},

	&#x2F;**
	 * Pass &lt;code&gt;true&lt;&#x2F;code&gt; to paginate the result after merging child
	 * nodes into the list.  The default (&lt;code&gt;false&lt;&#x2F;code&gt;) is to
	 * paginate only root nodes, so all children are visible.
	 * 
	 * @attribute paginateChildren
	 * @type {boolean}
	 * @default false
	 * @writeonce
	 *&#x2F;
	paginateChildren:
	{
		value:     false,
		validator: Y.Lang.isBoolean,
		writeOnce: true
	},

	&#x2F;**
	 * The key in each record that stores an identifier which is unique
	 * across the entire tree.  If this is not specified, then all nodes
	 * will close when the data is sorted.
	 * 
	 * @attribute uniqueIdKey
	 * @type {String}
	 *&#x2F;
	uniqueIdKey:
	{
		validator: Y.Lang.isString
	}
};

&#x2F;*

	Each element in this._open contains information about an openable,
	top-level node and is the root of a tree of open (or previously opened)
	items.  Each node in a tree contains the following data:

		index:      {Number} sorting key; the index of the node
		open:       null if never opened, true if open, false otherwise
		ds:         {DataSource} source for child nodes
		childTotal: {Number} total number of child nodes
		children:   {Array} (recursive) child nodes which are or have been opened
		parent:     {Object} parent item

	Each level is sorted by index to allow simple traversal in display
	order.

 *&#x2F;

function populateOpen(
	&#x2F;* object *&#x2F;	parent,
	&#x2F;* array *&#x2F;		open,
	&#x2F;* object *&#x2F;	req)
{
	var data          = req.data;
	var startIndex    = req.start;
	var childNodesKey = req.ds.treeble_config.childNodesKey;
	var nodeOpenKey   = req.ds.treeble_config.nodeOpenKey;

	for (var j=0; j&lt;open.length; j++)
	{
		if (open[j].index &gt;= startIndex)
		{
			break;
		}
	}

	var uniqueIdKey = this.get(&#x27;uniqueIdKey&#x27;);

	var result = true;
	for (var k=0; k&lt;data.length; k++)
	{
		var i = startIndex + k;
		var ds = data[k][ childNodesKey ];
		if (!ds)
		{
			continue;
		}

		while (j &lt; open.length &amp;&amp; open[j].index &lt; i)
		{
			open.splice(j, 1);
			result = false;

			if (uniqueIdKey)
			{
				delete this._open_cache[ data[k][ uniqueIdKey ] ];
			}
		}

		if (j &gt;= open.length || open[j].index &gt; i)
		{
			var item =
			{
				index:      i,
				open:       null,
				ds:         ds,
				children:   [],
				childTotal: 0,
				parent:     parent
			};

			var cached_item = null;
			if (uniqueIdKey)
			{
				cached_item = this._open_cache[ data[k][ uniqueIdKey ] ];
				if (cached_item)
				{
					item.open       = cached_item.open;
					item.childTotal = cached_item.childTotal;
					this._redo      = this._redo || item.open;
				}

				this._open_cache[ data[k][ uniqueIdKey ] ] = item;
			}

			if (!cached_item &amp;&amp; nodeOpenKey &amp;&amp; data[k][ nodeOpenKey ])
			{
				this._toggle.push(req.path.concat(i));
			}

			open.splice(j, 0, item);
		}

		j++;
	}

	return result;
}

&#x2F;&#x2F; TODO: worth switching to binary search?
function searchOpen(
	&#x2F;* array *&#x2F;	list,
	&#x2F;* int *&#x2F;	nodeIndex)
{
	for (var i=0; i&lt;list.length; i++)
	{
		if (list[i].index == nodeIndex)
		{
			return list[i];
		}
	}

	return false;
}

function getNode(
	&#x2F;* array *&#x2F;	path)
{
	var open = this._open;
	var last = path.length-1;
	for (var i=0; i&lt;last; i++)
	{
		var node = searchOpen(open, path[i]);
		open     = node.children;
	}

	return searchOpen(open, path[last]);
}

function countVisibleNodes(

	&#x2F;&#x2F; not sent by initiator

	&#x2F;* array *&#x2F; open)
{
	var total = 0;
	if (!open)
	{
		open  = this._open;
		total = this._topNodeTotal;
	}

	if (this.get(&#x27;paginateChildren&#x27;))
	{
		for (var i=0; i&lt;open.length; i++)
		{
			var node = open[i];
			if (node.open)
			{
				total += node.childTotal;
				total += countVisibleNodes.call(this, node.children);
			}
		}
	}

	return total;
}

function requestTree()
{
	this._cancelAllRequests();

	this._redo                = false;
	this._generating_requests = true;

	var req = this._callback.request;
	if (this.get(&#x27;paginateChildren&#x27;))
	{
		this._slices = getVisibleSlicesPgAll(req.startIndex, req.resultCount,
											 this.get(&#x27;root&#x27;), this._open);
	}
	else
	{
		this._slices = getVisibleSlicesPgTop(req.startIndex, req.resultCount,
											 this.get(&#x27;root&#x27;), this._open);
	}

	requestSlices.call(this, req);

	this._generating_requests = false;
	checkFinished.call(this);
}

function getVisibleSlicesPgTop(
	&#x2F;* int *&#x2F;			skip,
	&#x2F;* int *&#x2F;			show,
	&#x2F;* DataSource *&#x2F;	ds,
	&#x2F;* array *&#x2F;			open,

	&#x2F;&#x2F; not sent by initiator

	&#x2F;* array *&#x2F;			path)
{
	open = open.concat(
	{
		index:      -1,
		open:       true,
		childTotal: 0,
		children:   null
	});

	if (!path)
	{
		path = [];
	}

	var slices = [],
		send   = false;

	var m = 0, prev = -1, presend = false;
	for (var i=0; i&lt;open.length; i++)
	{
		var node = open[i];
		if (!node.open)
		{
			continue;
		}

		var delta = node.index - prev;

		if (m + delta &gt;= skip + show ||
			node.index == -1)
		{
			slices.push(
			{
				ds:    ds,
				path:  path.slice(0),
				start: send ? m : skip,
				end:   skip + show - 1
			});

			if (m + delta == skip + show)
			{
				slices = slices.concat(
					getVisibleSlicesPgTop(0, node.childTotal, node.ds,
										  node.children, path.concat(node.index)));
			}

			return slices;
		}
		else if (!send &amp;&amp; m + delta == skip)
		{
			presend = true;
		}
		else if (m + delta &gt; skip)
		{
			slices.push(
			{
				ds:    ds,
				path:  path.slice(0),
				start: send ? prev + 1 : skip,
				end:   m + delta - 1
			});
			send = true;
		}

		m += delta;

		if (send &amp;&amp; node.childTotal &gt; 0)
		{
			slices = slices.concat(
				getVisibleSlicesPgTop(0, node.childTotal, node.ds,
									  node.children, path.concat(node.index)));
		}

		prev = node.index;
		send = send || presend;
	}
}

function getVisibleSlicesPgAll(
	&#x2F;* int *&#x2F;			skip,
	&#x2F;* int *&#x2F;			show,
	&#x2F;* DataSource *&#x2F;	rootDS,
	&#x2F;* array *&#x2F;			open,

	&#x2F;&#x2F; not sent by initiator

	&#x2F;* array *&#x2F;			path,
	&#x2F;* node *&#x2F;			parent,
	&#x2F;* int *&#x2F;			pre,
	&#x2F;* bool *&#x2F;			send,
	&#x2F;* array *&#x2F;			slices)
{
	if (!parent)
	{
		path   = [];
		parent = null;
		pre    = 0;
		send   = false;
		slices = [];
	}

	var ds = parent ? parent.ds : rootDS;

	open = open.concat(
	{
		index:      parent ? parent.childTotal : -1,
		open:       true,
		childTotal: 0,
		children:   null
	});

	var n = 0, m = 0, prev = -1;
	for (var i=0; i&lt;open.length; i++)
	{
		var node = open[i];
		if (!node.open)
		{
			continue;
		}

		var delta = node.index - prev;
		if (node.children === null)
		{
			delta--;	&#x2F;&#x2F; last item is off the end
		}

		if (pre + n + delta &gt;= skip + show ||
			node.index == -1)
		{
			slices.push(
			{
				ds:    ds,
				path:  path.slice(0),
				start: m + (send ? 0 : skip - pre - n),
				end:   m + (skip + show - 1 - pre - n)
			});

			return slices;
		}
		else if (!send &amp;&amp; pre + n + delta == skip)
		{
			send = true;
		}
		else if (pre + n + delta &gt; skip)
		{
			slices.push(
			{
				ds:    ds,
				path:  path.slice(0),
				start: m + (send ? 0 : skip - pre - n),
				end:   m + delta - 1
			});
			send = true;
		}

		n += delta;
		m += delta;

		if (node.childTotal &gt; 0)
		{
			var info = getVisibleSlicesPgAll(skip, show, rootDS, node.children,
											 path.concat(node.index),
											 node, pre+n, send, slices);
			if (Y.Lang.isArray(info))
			{
				return info;
			}
			else
			{
				n   += info.count;
				send = info.send;
			}
		}

		prev = node.index;
	}

	&#x2F;&#x2F; only reached when parent != null

	var info =
	{
		count: n,
		send:  send
	};
	return info;
}

function requestSlices(
	&#x2F;* object *&#x2F;	request)
{
	for (var i=0; i&lt;this._slices.length; i++)
	{
		var slice = this._slices[i];
		var ds    = slice.ds;
		var req   = findRequest.call(this, ds);
		if (req)
		{
			if (Y.Console)
			{
				if (req.end+1 &lt; slice.start)
				{
					Y.error(&#x27;TreebleDataSource found discontinuous range&#x27;);
				}

				if (req.path.length != slice.path.length)
				{
					Y.error(&#x27;TreebleDataSource found path length mismatch&#x27;);
				}
				else
				{
					for (var j=0; j&lt;slice.path.length; j++)
					{
						if (req.path[j] != slice.path[j])
						{
							Y.error(&#x27;TreebleDataSource found path mismatch&#x27;);
							break;
						}
					}
				}
			}

			req.end = slice.end;
		}
		else
		{
			this._req.push(
			{
				ds:    ds,
				path:  slice.path,
				start: slice.start,
				end:   slice.end
			});
		}
	}

	request = Y.clone(request, true);
	for (var i=0; i&lt;this._req.length; i++)
	{
		var req             = this._req[i];
		request.startIndex  = req.start;
		request.resultCount = req.end - req.start + 1;

		req.txId = req.ds.sendRequest(
		{
			request: req.ds.treeble_config.generateRequest(request, req.path),
			cfg:     req.ds.treeble_config.requestCfg,
			callback:
			{
				success: Y.rbind(treeSuccess, this, i),
				failure: Y.rbind(treeFailure, this, i)
			}
		});
	}
}

function findRequest(
	&#x2F;* DataSource *&#x2F;	ds)
{
	for (var i=0; i&lt;this._req.length; i++)
	{
		var req = this._req[i];
		if (ds == req.ds)
		{
			return req;
		}
	}

	return null;
}

function treeSuccess(e, reqIndex)
{
	if (!e.response || e.error ||
		!Y.Lang.isArray(e.response.results))
	{
		treeFailure.apply(this, arguments);
		return;
	}

	var req = searchTxId(this._req, e.tId, reqIndex);
	if (!req)
	{
		return;		&#x2F;&#x2F; cancelled request
	}

	if (!this._topResponse &amp;&amp; req.ds == this.get(&#x27;root&#x27;))
	{
		this._topResponse = e.response;
	}

	req.txId  = null;
	req.resp  = e.response;
	req.error = false;

	var dataStartIndex = 0;
	if (req.ds.treeble_config.startIndexExpr)
	{
		eval(&#x27;dataStartIndex=req.resp&#x27;+req.ds.treeble_config.startIndexExpr);
	}

	var sliceStartIndex = req.start - dataStartIndex;
	req.data            = e.response.results.slice(sliceStartIndex, req.end - dataStartIndex + 1);
	setNodeInfo(req.data, req.start, req.path, req.ds);

	var parent = (req.path.length &gt; 0 ? getNode.call(this, req.path) : null);
	var open   = (parent !== null ? parent.children : this._open);
	if (!populateOpen.call(this, parent, open, req))
	{
		treeFailure.apply(this, arguments);
		return;
	}

	if (!parent &amp;&amp; req.ds.treeble_config.totalRecordsExpr)
	{
		eval(&#x27;this._topNodeTotal=e.response&#x27;+req.ds.treeble_config.totalRecordsExpr);
	}
	else if (!parent &amp;&amp; req.ds.treeble_config.totalRecordsReturnExpr)
	{
		this._topNodeTotal = e.response.results.length;
	}

	checkFinished.call(this);
}

function treeFailure(e, reqIndex)
{
	var req = searchTxId(this._req, e.tId, reqIndex);
	if (!req)
	{
		return;		&#x2F;&#x2F; cancelled request
	}

	this._cancelAllRequests();

	this._callback.error    = e.error;
	this._callback.response = e.response;
	this.fire(&#x27;response&#x27;, this._callback);
}

function setNodeInfo(
	&#x2F;* array *&#x2F;			list,
	&#x2F;* int *&#x2F;			offset,
	&#x2F;* array *&#x2F;			path,
	&#x2F;* datasource *&#x2F;	ds)
{
	var depth = path.length;
	for (var i=0; i&lt;list.length; i++)
	{
		list[i]._yui_node_depth = depth;
		list[i]._yui_node_path  = path.concat(offset+i);
		list[i]._yui_node_ds    = ds;
	}
}

function searchTxId(
	&#x2F;* array *&#x2F;	req,
	&#x2F;* int *&#x2F;	id,
	&#x2F;* int *&#x2F;	fallbackIndex)
{
	for (var i=0; i&lt;req.length; i++)
	{
		if (req[i].txId === id)
		{
			return req[i];
		}
	}

	&#x2F;&#x2F; synch response arrives before setting txId

	if (fallbackIndex &lt; req.length &amp;&amp;
		Y.Lang.isUndefined(req[ fallbackIndex ].txId))
	{
		return req[ fallbackIndex ];
	}

	return null;
}

function checkFinished()
{
	if (this._generating_requests)
	{
		return;
	}

	var count = this._req.length;
	for (var i=0; i&lt;count; i++)
	{
		if (!this._req[i].resp)
		{
			return;
		}
	}

	if (this._redo)
	{
		Y.Lang.later(0, this, requestTree);
		return;
	}
	else if (this._toggle.length &gt; 0)
	{
		this.toggle(this._toggle[0], Y.clone(this._callback.request, true),
		{
			fn: function()
			{
				Y.Lang.later(0, this, requestTree);
			},
			scope: this
		});
		return;
	}

	var response = { meta:{} };
	Y.mix(response, this._topResponse, true);
	response.results = [];
	response         = Y.clone(response, true);

	count = this._slices.length;
	for (i=0; i&lt;count; i++)
	{
		var slice = this._slices[i];
		var req   = findRequest.call(this, slice.ds);
		if (!req)
		{
			Y.error(&#x27;Failed to find request for a slice&#x27;);
			continue;
		}

		var j    = slice.start - req.start;
		var data = req.data.slice(j, j + slice.end - slice.start + 1);

		response.results = response.results.concat(data);
	}

	var rootDS = this.get(&#x27;root&#x27;);
	if (rootDS.treeble_config.totalRecordsExpr)
	{
		eval(&#x27;response&#x27;+rootDS.treeble_config.totalRecordsExpr+&#x27;=&#x27;+countVisibleNodes.call(this));
	}
	else if (rootDS.treeble_config.totalRecordsReturnExpr)
	{
		eval(&#x27;response&#x27;+rootDS.treeble_config.totalRecordsReturnExpr+&#x27;=&#x27;+countVisibleNodes.call(this));
	}

	this._callback.response = response;
	this.fire(&#x27;response&#x27;, this._callback);
}

function toggleSuccess(e, node, completion)
{
	if (node.ds.treeble_config.totalRecordsExpr)
	{
		eval(&#x27;node.childTotal=e.response&#x27;+node.ds.treeble_config.totalRecordsExpr);
	}
	else if (node.ds.treeble_config.totalRecordsReturnExpr)
	{
		node.childTotal = e.response.results.length;
	}

	node.open     = true;
	node.children = [];
	complete(completion);
}

function toggleFailure(e, node, completion)
{
	node.childTotal = 0;

	node.open     = true;
	node.children = [];
	complete(completion);
}

function complete(f)
{
	if (Y.Lang.isFunction(f))
	{
		f();
	}
	else if (f &amp;&amp; f.fn)
	{
		f.fn.apply(f.scope || window, Y.Lang.isUndefined(f.args) ? [] : f.args);
	}
}

function compareRequests(r1, r2)
{
	var k1 = Y.Object.keys(r1),
		k2 = Y.Object.keys(r2);

	if (k1.length != k2.length)
	{
		return false;
	}

	for (var i=0; i&lt;k1.length; i++)
	{
		var k = k1[i];
		if (k != &#x27;startIndex&#x27; &amp;&amp; k != &#x27;resultCount&#x27; &amp;&amp; r1[k] !== r2[k])
		{
			return false;
		}
	}

	return true;
}

Y.extend(TreebleDataSource, Y.DataSource.Local,
{
	initializer: function(config)
	{
		if (!config.root)
		{
			Y.error(&#x27;TreebleDataSource requires DataSource&#x27;);
		}

		if (!config.root.treeble_config.childNodesKey)
		{
			var fields = config.root.schema.get(&#x27;schema&#x27;).resultFields;
			if (!fields || !Y.Lang.isArray(fields))
			{
				Y.error(&#x27;TreebleDataSource root DataSource requires schema.resultFields because treeble_config.childNodesKey was not specified.&#x27;);
			}

			for (var i=0; i&lt;fields.length; i++)
			{
				if (Y.Lang.isObject(fields[i]) &amp;&amp; fields[i].parser == &#x27;treebledatasource&#x27;)
				{
					config.root.treeble_config.childNodesKey = fields[i].key;
					break;
				}
			}

			if (!config.root.treeble_config.childNodesKey)
			{
				Y.error(&#x27;TreebleDataSource requires treeble_config.childNodesKey configuration to be set on root DataSource&#x27;);
			}
		}

		if (!config.root.treeble_config.generateRequest)
		{
			Y.error(&#x27;TreebleDataSource requires treeble_config.generateRequest configuration to be set on root DataSource&#x27;);
		}

		if (!config.root.treeble_config.totalRecordsExpr &amp;&amp; !config.root.treeble_config.totalRecordsReturnExpr)
		{
			Y.error(&#x27;TreebleDataSource requires either treeble_config.totalRecordsExpr or treeble_config.totalRecordsReturnExpr configuration to be set on root DataSource&#x27;);
		}

		this._open       = [];
		this._open_cache = {};
		this._toggle     = [];
		this._req        = [];
	},

	&#x2F;**
	 * @method isOpen
	 * @param path {Array} Path to node
	 * @return {boolean} true if the node is open
	 *&#x2F;
	isOpen: function(path)
	{
		var list = this._open;
		for (var i=0; i&lt;path.length; i++)
		{
			var node = searchOpen.call(this, list, path[i]);
			if (!node || !node.open)
			{
				return false;
			}
			list = node.children;
		}

		return true;
	},

	&#x2F;**
	 * Toggle the specified node between open and closed.  When a node is
	 * opened for the first time, this requires a request to the
	 * DataSource.  Any code that assumes the node has been opened must be
	 * passed in as a completion function.
	 * 
	 * @method toggle
	 * @param path {Array} Path to the node
	 * @param request {Object} {sort,dir,startIndex,resultCount}
	 * @param completion {Function|Object} Function to call when the operation completes.  Can be object: {fn,scope,args}
	 * @return {boolean} false if the path to the node has not yet been fully explored or is not openable, true otherwise
	 *&#x2F;
	toggle: function(path, request, completion)
	{
		var list = this._open;
		for (var i=0; i&lt;path.length; i++)
		{
			var node = searchOpen.call(this, list, path[i]);
			if (!node)
			{
				return false;
			}
			list = node.children;
		}

		if (node.open === null)
		{
			request.startIndex  = 0;
			request.resultCount = 0;
			node.ds.sendRequest(
			{
				request: node.ds.treeble_config.generateRequest(request, path),
				cfg:     node.ds.treeble_config.requestCfg,
				callback:
				{
					success: Y.rbind(toggleSuccess, this, node, completion),
					failure: Y.rbind(toggleFailure, this, node, completion)
				}
			});
		}
		else
		{
			node.open = !node.open;
			complete(completion);
		}
		return true;
	},

	_defRequestFn: function(e)
	{
		&#x2F;&#x2F; wipe out all state if the request parameters change

		if (this._callback &amp;&amp; !compareRequests(this._callback.request, e.request))
		{
			this._open = [];
		}

		this._callback = e;
		requestTree.call(this);
	},

	_cancelAllRequests: function()
	{
		this._req    = [];
		this._toggle = [];
		delete this._topResponse;
	}
});

Y.TreebleDataSource = TreebleDataSource;
Y.namespace(&#x27;DataSource&#x27;).Treeble = TreebleDataSource;

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
