<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/gallery-eventsource/js/eventsource.js - YUI 3 Gallery Modules</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="YUI 3 Gallery Modules" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Accordion.html">Accordion</a></li>
                                <li><a href="../classes/AnimSequence.html">AnimSequence</a></li>
                                <li><a href="../classes/ArrayIterator.html">ArrayIterator</a></li>
                                <li><a href="../classes/ArrayList~extras.html">ArrayList~extras</a></li>
                                <li><a href="../classes/Array~algorithms.html">Array~algorithms</a></li>
                                <li><a href="../classes/Array~funcprog-extras.html">Array~funcprog-extras</a></li>
                                <li><a href="../classes/Array~object-extras.html">Array~object-extras</a></li>
                                <li><a href="../classes/Assert.html">Assert</a></li>
                                <li><a href="../classes/AtLeastOneCheckboxGroup.html">AtLeastOneCheckboxGroup</a></li>
                                <li><a href="../classes/AtMostOneCheckboxGroup.html">AtMostOneCheckboxGroup</a></li>
                                <li><a href="../classes/BulkEditor.html">BulkEditor</a></li>
                                <li><a href="../classes/Canvas.Context2d.html">Canvas.Context2d</a></li>
                                <li><a href="../classes/CheckboxGroup.html">CheckboxGroup</a></li>
                                <li><a href="../classes/Chipper.html">Chipper</a></li>
                                <li><a href="../classes/CollapseToggle.html">CollapseToggle</a></li>
                                <li><a href="../classes/ComplexMath.html">ComplexMath</a></li>
                                <li><a href="../classes/ComplexNumber.html">ComplexNumber</a></li>
                                <li><a href="../classes/DataSource.AsyncFunction.html">DataSource.AsyncFunction</a></li>
                                <li><a href="../classes/DataSource.BulkEdit.html">DataSource.BulkEdit</a></li>
                                <li><a href="../classes/DataSource.Treeble.html">DataSource.Treeble</a></li>
                                <li><a href="../classes/DateTime.html">DateTime</a></li>
                                <li><a href="../classes/DateTimeRange.html">DateTimeRange</a></li>
                                <li><a href="../classes/DateTimeUtils.html">DateTimeUtils</a></li>
                                <li><a href="../classes/EnableIfAnyCheckboxGroup.html">EnableIfAnyCheckboxGroup</a></li>
                                <li><a href="../classes/ExpirationCache.html">ExpirationCache</a></li>
                                <li><a href="../classes/ExpressionBuilder.html">ExpressionBuilder</a></li>
                                <li><a href="../classes/FormManager.html">FormManager</a></li>
                                <li><a href="../classes/HTMLTableBulkEditor.html">HTMLTableBulkEditor</a></li>
                                <li><a href="../classes/InputPopup.html">InputPopup</a></li>
                                <li><a href="../classes/InstanceManager.html">InstanceManager</a></li>
                                <li><a href="../classes/io~multiresponse.html">io~multiresponse</a></li>
                                <li><a href="../classes/Iterable.html">Iterable</a></li>
                                <li><a href="../classes/LinkedList.html">LinkedList</a></li>
                                <li><a href="../classes/LinkedListItem.html">LinkedListItem</a></li>
                                <li><a href="../classes/LinkedListIterator.html">LinkedListIterator</a></li>
                                <li><a href="../classes/LogFilter.html">LogFilter</a></li>
                                <li><a href="../classes/Math.html">Math</a></li>
                                <li><a href="../classes/MathCanvas.html">MathCanvas</a></li>
                                <li><a href="../classes/MathCanvas.Parser.html">MathCanvas.Parser</a></li>
                                <li><a href="../classes/MathCanvas.RectList.html">MathCanvas.RectList</a></li>
                                <li><a href="../classes/MathFunction.html">MathFunction</a></li>
                                <li><a href="../classes/MathFunction.Arccosine.html">MathFunction.Arccosine</a></li>
                                <li><a href="../classes/MathFunction.Arcsine.html">MathFunction.Arcsine</a></li>
                                <li><a href="../classes/MathFunction.Arctangent.html">MathFunction.Arctangent</a></li>
                                <li><a href="../classes/MathFunction.Arctangent2.html">MathFunction.Arctangent2</a></li>
                                <li><a href="../classes/MathFunction.Conjugate.html">MathFunction.Conjugate</a></li>
                                <li><a href="../classes/MathFunction.Cosine.html">MathFunction.Cosine</a></li>
                                <li><a href="../classes/MathFunction.E.html">MathFunction.E</a></li>
                                <li><a href="../classes/MathFunction.Exponential.html">MathFunction.Exponential</a></li>
                                <li><a href="../classes/MathFunction.FunctionWithArgs.html">MathFunction.FunctionWithArgs</a></li>
                                <li><a href="../classes/MathFunction.HyperbolicCosine.html">MathFunction.HyperbolicCosine</a></li>
                                <li><a href="../classes/MathFunction.HyperbolicSine.html">MathFunction.HyperbolicSine</a></li>
                                <li><a href="../classes/MathFunction.HyperbolicTangent.html">MathFunction.HyperbolicTangent</a></li>
                                <li><a href="../classes/MathFunction.I.html">MathFunction.I</a></li>
                                <li><a href="../classes/MathFunction.ImaginaryPart.html">MathFunction.ImaginaryPart</a></li>
                                <li><a href="../classes/MathFunction.InverseHyperbolicCosine.html">MathFunction.InverseHyperbolicCosine</a></li>
                                <li><a href="../classes/MathFunction.InverseHyperbolicSine.html">MathFunction.InverseHyperbolicSine</a></li>
                                <li><a href="../classes/MathFunction.InverseHyperbolicTangent.html">MathFunction.InverseHyperbolicTangent</a></li>
                                <li><a href="../classes/MathFunction.Logarithm.html">MathFunction.Logarithm</a></li>
                                <li><a href="../classes/MathFunction.Magnitude.html">MathFunction.Magnitude</a></li>
                                <li><a href="../classes/MathFunction.Max.html">MathFunction.Max</a></li>
                                <li><a href="../classes/MathFunction.Min.html">MathFunction.Min</a></li>
                                <li><a href="../classes/MathFunction.NaturalLog.html">MathFunction.NaturalLog</a></li>
                                <li><a href="../classes/MathFunction.Negate.html">MathFunction.Negate</a></li>
                                <li><a href="../classes/MathFunction.Phase.html">MathFunction.Phase</a></li>
                                <li><a href="../classes/MathFunction.Pi.html">MathFunction.Pi</a></li>
                                <li><a href="../classes/MathFunction.Product.html">MathFunction.Product</a></li>
                                <li><a href="../classes/MathFunction.Quotient.html">MathFunction.Quotient</a></li>
                                <li><a href="../classes/MathFunction.RealPart.html">MathFunction.RealPart</a></li>
                                <li><a href="../classes/MathFunction.Rotate.html">MathFunction.Rotate</a></li>
                                <li><a href="../classes/MathFunction.Sine.html">MathFunction.Sine</a></li>
                                <li><a href="../classes/MathFunction.SquareRoot.html">MathFunction.SquareRoot</a></li>
                                <li><a href="../classes/MathFunction.Sum.html">MathFunction.Sum</a></li>
                                <li><a href="../classes/MathFunction.Tangent.html">MathFunction.Tangent</a></li>
                                <li><a href="../classes/MathFunction.Value.html">MathFunction.Value</a></li>
                                <li><a href="../classes/MathFunction.Variable.html">MathFunction.Variable</a></li>
                                <li><a href="../classes/MatrixBackground.html">MatrixBackground</a></li>
                                <li><a href="../classes/MatrixCredits.html">MatrixCredits</a></li>
                                <li><a href="../classes/MRUCache.html">MRUCache</a></li>
                                <li><a href="../classes/MultiObject.html">MultiObject</a></li>
                                <li><a href="../classes/NodeList~extras2.html">NodeList~extras2</a></li>
                                <li><a href="../classes/Node~dimensions.html">Node~dimensions</a></li>
                                <li><a href="../classes/Node~event-set.html">Node~event-set</a></li>
                                <li><a href="../classes/Node~optimizations.html">Node~optimizations</a></li>
                                <li><a href="../classes/Node~scrollIntoView.html">Node~scrollIntoView</a></li>
                                <li><a href="../classes/Node~utils.html">Node~utils</a></li>
                                <li><a href="../classes/Object~extras.html">Object~extras</a></li>
                                <li><a href="../classes/PageLayout.html">PageLayout</a></li>
                                <li><a href="../classes/Paginator.ui.CurrentPageInput.html">Paginator.ui.CurrentPageInput</a></li>
                                <li><a href="../classes/Paginator.ui.CurrentPageReport.html">Paginator.ui.CurrentPageReport</a></li>
                                <li><a href="../classes/Paginator.ui.FirstPageLink.html">Paginator.ui.FirstPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.ItemRangeDropdown.html">Paginator.ui.ItemRangeDropdown</a></li>
                                <li><a href="../classes/Paginator.ui.LastPageLink.html">Paginator.ui.LastPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.NextPageLink.html">Paginator.ui.NextPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.PageLinks.html">Paginator.ui.PageLinks</a></li>
                                <li><a href="../classes/Paginator.ui.PreviousPageLink.html">Paginator.ui.PreviousPageLink</a></li>
                                <li><a href="../classes/Paginator.ui.RowsPerPageDropdown.html">Paginator.ui.RowsPerPageDropdown</a></li>
                                <li><a href="../classes/Paginator.ui.ValidationPageLinks.html">Paginator.ui.ValidationPageLinks</a></li>
                                <li><a href="../classes/Parsers.html">Parsers</a></li>
                                <li><a href="../classes/Plugin.BusyOverlay.html">Plugin.BusyOverlay</a></li>
                                <li><a href="../classes/Plugin.ConsoleTest.html">Plugin.ConsoleTest</a></li>
                                <li><a href="../classes/Plugin.DataTableDataSourceBusy.html">Plugin.DataTableDataSourceBusy</a></li>
                                <li><a href="../classes/Plugin.DataTablePaginator.html">Plugin.DataTablePaginator</a></li>
                                <li><a href="../classes/Plugin.DataTableQuickEdit.html">Plugin.DataTableQuickEdit</a></li>
                                <li><a href="../classes/Plugin.DataTableRowExpansion.html">Plugin.DataTableRowExpansion</a></li>
                                <li><a href="../classes/Plugin.DataTableState.html">Plugin.DataTableState</a></li>
                                <li><a href="../classes/Plugin.FixedSizeAccordion.html">Plugin.FixedSizeAccordion</a></li>
                                <li><a href="../classes/Plugin.InputCalendarSync.html">Plugin.InputCalendarSync</a></li>
                                <li><a href="../classes/Plugin.Neon.html">Plugin.Neon</a></li>
                                <li><a href="../classes/Plugin.NodeFXSequence.html">Plugin.NodeFXSequence</a></li>
                                <li><a href="../classes/Plugin.OverlayForm.html">Plugin.OverlayForm</a></li>
                                <li><a href="../classes/Plugin.PageLayoutAnyWidgetModule.html">Plugin.PageLayoutAnyWidgetModule</a></li>
                                <li><a href="../classes/Plugin.PageLayoutDataTableModule.html">Plugin.PageLayoutDataTableModule</a></li>
                                <li><a href="../classes/Popup.html">Popup</a></li>
                                <li><a href="../classes/QueryBuilder.html">QueryBuilder</a></li>
                                <li><a href="../classes/QueryBuilder.DateRange.html">QueryBuilder.DateRange</a></li>
                                <li><a href="../classes/QueryBuilder.MultiselectInput.html">QueryBuilder.MultiselectInput</a></li>
                                <li><a href="../classes/QueryBuilder.Select.html">QueryBuilder.Select</a></li>
                                <li><a href="../classes/QueryBuilder.String.html">QueryBuilder.String</a></li>
                                <li><a href="../classes/RPC.Mojito.html">RPC.Mojito</a></li>
                                <li><a href="../classes/SelectAllCheckboxGroup.html">SelectAllCheckboxGroup</a></li>
                                <li><a href="../classes/Sort.html">Sort</a></li>
                                <li><a href="../classes/Treeble.html">Treeble</a></li>
                                <li><a href="../classes/YUI~funcprog.html">YUI~funcprog</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/gallery-accordion-horiz-vert.html">gallery-accordion-horiz-vert</a></li>
                                <li><a href="../modules/gallery-adobe-air-config.html">gallery-adobe-air-config</a></li>
                                <li><a href="../modules/gallery-adobe-air-page-manager.html">gallery-adobe-air-page-manager</a></li>
                                <li><a href="../modules/gallery-adobe-air-prefs.html">gallery-adobe-air-prefs</a></li>
                                <li><a href="../modules/gallery-algorithms.html">gallery-algorithms</a></li>
                                <li><a href="../modules/gallery-anim-class.html">gallery-anim-class</a></li>
                                <li><a href="../modules/gallery-anim-sequence.html">gallery-anim-sequence</a></li>
                                <li><a href="../modules/gallery-bulkedit.html">gallery-bulkedit</a></li>
                                <li><a href="../modules/gallery-busyoverlay.html">gallery-busyoverlay</a></li>
                                <li><a href="../modules/gallery-canvas.html">gallery-canvas</a></li>
                                <li><a href="../modules/gallery-checkboxgroups.html">gallery-checkboxgroups</a></li>
                                <li><a href="../modules/gallery-chipper.html">gallery-chipper</a></li>
                                <li><a href="../modules/gallery-collapse-toggle.html">gallery-collapse-toggle</a></li>
                                <li><a href="../modules/gallery-complexnumber.html">gallery-complexnumber</a></li>
                                <li><a href="../modules/gallery-console-test.html">gallery-console-test</a></li>
                                <li><a href="../modules/gallery-datasource-async-function.html">gallery-datasource-async-function</a></li>
                                <li><a href="../modules/gallery-datatable-datasource-busy.html">gallery-datatable-datasource-busy</a></li>
                                <li><a href="../modules/gallery-datatable-paginator.html">gallery-datatable-paginator</a></li>
                                <li><a href="../modules/gallery-datatable-row-expansion.html">gallery-datatable-row-expansion</a></li>
                                <li><a href="../modules/gallery-datatable-state.html">gallery-datatable-state</a></li>
                                <li><a href="../modules/gallery-datetime.html">gallery-datetime</a></li>
                                <li><a href="../modules/gallery-datetime-range.html">gallery-datetime-range</a></li>
                                <li><a href="../modules/gallery-datetime-utils.html">gallery-datetime-utils</a></li>
                                <li><a href="../modules/gallery-dimensions.html">gallery-dimensions</a></li>
                                <li><a href="../modules/gallery-expiration-cache.html">gallery-expiration-cache</a></li>
                                <li><a href="../modules/gallery-exprbuilder.html">gallery-exprbuilder</a></li>
                                <li><a href="../modules/gallery-formmgr.html">gallery-formmgr</a></li>
                                <li><a href="../modules/gallery-formmgr-css-validation.html">gallery-formmgr-css-validation</a></li>
                                <li><a href="../modules/gallery-formmgr-overlay-plugin.html">gallery-formmgr-overlay-plugin</a></li>
                                <li><a href="../modules/gallery-funcprog.html">gallery-funcprog</a></li>
                                <li><a href="../modules/gallery-input-calendar-sync.html">gallery-input-calendar-sync</a></li>
                                <li><a href="../modules/gallery-instancemanager.html">gallery-instancemanager</a></li>
                                <li><a href="../modules/gallery-io-adobe-air.html">gallery-io-adobe-air</a></li>
                                <li><a href="../modules/gallery-io-multiresponse.html">gallery-io-multiresponse</a></li>
                                <li><a href="../modules/gallery-iterable-extras.html">gallery-iterable-extras</a></li>
                                <li><a href="../modules/gallery-layout.html">gallery-layout</a></li>
                                <li><a href="../modules/gallery-layout-anywidget.html">gallery-layout-anywidget</a></li>
                                <li><a href="../modules/gallery-layout-cols.html">gallery-layout-cols</a></li>
                                <li><a href="../modules/gallery-layout-datatable.html">gallery-layout-datatable</a></li>
                                <li><a href="../modules/gallery-layout-rows.html">gallery-layout-rows</a></li>
                                <li><a href="../modules/gallery-linkedlist.html">gallery-linkedlist</a></li>
                                <li><a href="../modules/gallery-log-filter.html">gallery-log-filter</a></li>
                                <li><a href="../modules/gallery-math.html">gallery-math</a></li>
                                <li><a href="../modules/gallery-mathcanvas.html">gallery-mathcanvas</a></li>
                                <li><a href="../modules/gallery-matrix-background.html">gallery-matrix-background</a></li>
                                <li><a href="../modules/gallery-matrix-credits.html">gallery-matrix-credits</a></li>
                                <li><a href="../modules/gallery-mojito-rpc.html">gallery-mojito-rpc</a></li>
                                <li><a href="../modules/gallery-mru-cache.html">gallery-mru-cache</a></li>
                                <li><a href="../modules/gallery-multiobject.html">gallery-multiobject</a></li>
                                <li><a href="../modules/gallery-neon.html">gallery-neon</a></li>
                                <li><a href="../modules/gallery-node-event-set.html">gallery-node-event-set</a></li>
                                <li><a href="../modules/gallery-node-optimizations.html">gallery-node-optimizations</a></li>
                                <li><a href="../modules/gallery-node-utils.html">gallery-node-utils</a></li>
                                <li><a href="../modules/gallery-nodelist-extras2.html">gallery-nodelist-extras2</a></li>
                                <li><a href="../modules/gallery-object-extras.html">gallery-object-extras</a></li>
                                <li><a href="../modules/gallery-paginator.html">gallery-paginator</a></li>
                                <li><a href="../modules/gallery-popup.html">gallery-popup</a></li>
                                <li><a href="../modules/gallery-querybuilder.html">gallery-querybuilder</a></li>
                                <li><a href="../modules/gallery-querybuilder-daterange.html">gallery-querybuilder-daterange</a></li>
                                <li><a href="../modules/gallery-querybuilder-multiselect-input.html">gallery-querybuilder-multiselect-input</a></li>
                                <li><a href="../modules/gallery-quickedit.html">gallery-quickedit</a></li>
                                <li><a href="../modules/gallery-scrollintoview.html">gallery-scrollintoview</a></li>
                                <li><a href="../modules/gallery-sort-extras.html">gallery-sort-extras</a></li>
                                <li><a href="../modules/gallery-table-utils.html">gallery-table-utils</a></li>
                                <li><a href="../modules/gallery-test-extras.html">gallery-test-extras</a></li>
                                <li><a href="../modules/gallery-treeble.html">gallery-treeble</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/gallery-eventsource/js/eventsource.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">

/*global EventSource*/

    var useNative = typeof EventSource != &quot;undefined&quot;,
        prototype,
        basePrototype,
        RETRY_MS = 500;

    function YUIEventSource(url){
    
        Y.Event.Target.call(this);
    
        /**
         * The URL or the server-sent events.
         * @type String
         * @property url
         */
        this.url = url;    
    
        /**
         * The current state of the object. Possible values are 0 for connecting,
         * 1 for connected, and 2 for disconnected.
         * @type int
         * @property readyState
         */
        this.readyState = 0;
        
        /**
         * Object used to communicate with the server. May be an XHR or an
         * EventSource.
         * @type XMLHttpRequest|EventSource
         * @property _transport
         * @private
         */
        this._transport = null;
        
        //initialize the object
        this._init();
    
    }
    
    //methods that are necessary regardless of native vs. non-native
    basePrototype = {
    
        /**
         * Fires the error event. When this happens, the readyState
         * must first be set to 2 so that error handlers querying
         * this value receive the correct value.
         * @return {void}
         * @method _fireErrorEvent
         * @private
         */
        _fireErrorEvent: function(){  
            Y.later(0, this, function(){
                this.readyState = 2;
                this.fire({type:&quot;error&quot;});
            });
        },
        
        /**
         * Fires the open event. When this happens, the readyState
         * must first be set to 1 so that event listeners querying
         * this value receive the correct value.
         * @return {void}
         * @method _fireOpenEvent
         * @private
         */
        _fireOpenEvent: function(){
            //only fire is there wasn&#x27;t already an error
            if (this.readyState &lt; 2){
                Y.later(0, this, function(){
                    this.readyState = 1;
                    this.fire({type:&quot;open&quot;});
                });        
            }
        },
        
        /**
         * Fires a message event. This might be either an event of
         * type message or a custom event as received from the event
         * stream. 
         * @param {Object} data An object containing the keys
         *      type, data, lastEventId, and origin.
         * @return {void}
         * @method _fireMessageEvent
         * @private
         */
        _fireMessageEvent: function(data){
            Y.later(0, this, function(){
                this.fire(data);
            });        
        }
        
    
    };
    
    
    //use native if available
    if (useNative){
        prototype = {
            
            _init: function(){
            
                //any number of things could go wrong in here
                try {
                    var src = new EventSource(this.url),
                        that = this;
                        
                    /**
                     * Map the common EventSource events to custom
                     * YUI events. These are delayed with a timer
                     * to avoid race conditions and provide consistency
                     * between the native EventSource usage and the
                     * XHR-based event source events.
                     */
                    src.onopen = 
                        src.onmessage =   
                        src.onerror = Y.bind(function(event){                    
                            switch(event.type){
                                case &quot;open&quot;:
                                    this._fireOpenEvent();
                                    break;
                                case &quot;message&quot;:
                                    this._fireMessageEvent({
                                        type:   &quot;message&quot;,
                                        data:   event.data,
                                        lastEventId:    event.lastEventId,
                                        origin: event.origin
                                    });
                                    break;
                                case &quot;error&quot;:
                                    this._fireErrorEvent();
                                    break;              
                                //no default
                            }                    
                        }, this);
                    
                    this._transport = src;
                } catch (ex){    
                    this._fireErrorEvent();
                }          
            },
            
            close: function(){
                //can be null if error occurs during _init
                if (this._transport != null){
                    this._transport.close();
                }
                this.readyState = 2;
            },
            
            /*
             * Must override attach for custom server-sent events. Since
             * there&#x27;s no catchall for all server-sent events, must assign
             * event handlers directly to the EventSource object.
             */
            on: function( type , fn , el , context , args){
                var that = this;
                if (type != &quot;message&quot; &amp;&amp; type != &quot;error&quot; &amp;&amp; type != &quot;open&quot;){
                    this._transport.addEventListener(type, function(event){
                        that._fireMessageEvent({
                            type:   event.type,
                            data:   event.data,
                            origin: event.origin,
                            lastEventId:    event.lastEventId
                        });
                    }, false);
                }
                
                //call superclass method
                Y.Event.Target.prototype.on.apply(this, arguments);
            }
            
            //TODO: Need detach override too?

        };
    
    } else {
    
        prototype = {
            
            /**
             * Initializes the EventSource object. Either creates an EventSource
             * instance or an XHR to mimic the functionality.
             * @method _init
             * @return {void}
             * @private
             */
            _init: function(){
                    
                /**
                 * Keeps track of where in the response buffer to start
                 * evaluating new data. Only used when native EventSource
                 * is not available.
                 * @type int
                 * @property _lastIndex
                 * @private
                 */
                this._lastIndex = 0;
                
                /**
                 * Keeps track of the last event ID received from the server.
                 * Only used when native EventSource is not available.
                 * @type variant
                 * @property _lastEventId
                 * @private
                 */
                this._lastEventId = null;
                
                /**
                 * Tracks the last piece of data from the messages stream.
                 * @type String
                 * @property _data
                 * @private
                 */
                this._data = &quot;&quot;;
                
                /**
                 * Tracks the last event name in the message stream.
                 * @type String
                 * @property _eventName
                 * @private
                 */
                this._eventName = &quot;&quot;;                                             

                
                var src,
                    that = this;
             
                //close() might have been called before this executes
                if (this.readyState != 2){
                        
                    //use appropriate XHR object as transport
                    if (typeof XMLHttpRequest != &quot;undefined&quot;){ //most browsers
                        src = new XMLHttpRequest();
                    } else if (typeof ActiveXObject != &quot;undefined&quot;){    //IE6
                        src = new ActiveXObject(&quot;MSXML2.XMLHttp&quot;);
                    } else {
                        throw new Error(&quot;Server-sent events unavailable.&quot;);
                    }
                    
                    src.open(&quot;get&quot;, this.url, true);
                    
                    /*
                     * If there was a last event ID, add the special
                     * Last-Event-ID header to the request.
                     */
                    if (this._lastEventId){
                        src.setRequestHeader(&quot;Last-Event-ID&quot;, this._lastEventId);
                        //TODO: Need to reset _lastEventId? Pending WHAT-WG clarification
                    }
                    
                    /*
                     * Internet Explorer can&#x27;t deal with streaming data. Send
                     * an extra HTTP header letting the serve know that polling
                     * is really the only option for this browser. Servers can
                     * use this to make sure streaming data isn&#x27;t sent to IE.
                     */
                    if (Y.UA.ie){
                        src.setRequestHeader(&quot;X-YUIEventSource-PollOnly&quot;, &quot;1&quot;);
                    }
                    
                    
                    src.onreadystatechange = function(){
                    
                        /*
                         * IE will not have multiple readyState 3 calls, so
                         * those will go to readyState 4 and effectively become
                         * long-polling requests. All others will have a hanging
                         * GET request that receives continual information over
                         * the same connection.
                         */
                        if (src.readyState == 3 &amp;&amp; Y.UA.ie === 0){
                        
                            //verify that the HTTP content type is correct, if not, error out
                            if (src.getResponseHeader(&quot;Content-type&quot;) != &quot;text/event-stream&quot;){
                                that.close();
                                that._fireErrorEvent();
                            } else {
                                that._signalOpen();                                                        
                                that._processIncomingData(src.responseText);
                            }                        
                            
                        } else if (src.readyState == 4 &amp;&amp; that.readyState &lt; 2){
                        
                            //IE6-8 won&#x27;t have fired the open event yet, so check
                            that._signalOpen();
                            
                            //there might be one more event queued up to be fired
                            that._fireMessageEvent();
                            
                            //check for any additional data
                            that._validateResponse();
                        }
                    };
                                       
                    /*
                     * Save the instance to a property. This must happen before
                     * the call to send() because fast responses may cause
                     * onreadystatechange to fire before the next line after
                     * send().
                     */
                    this._transport = src;                                            
                    src.send(null);                        
                }

            },            
                
            /**
             * Called when XHR readyState 4 occurs. Processes the response,
             * then reopens the connection to the server unless close()
             * has been called.
             * @method _validateResponse
             * @return {void}
             * @private
             */
            _validateResponse: function(){
                var src = this._transport;
                try {
                    if (src.status &gt;= 200 &amp;&amp; src.status &lt; 300){
                        this._processIncomingData(src.responseText);
                        
                        //readyState will be 2 if close() was called
                        if (this.readyState != 2){
                        
                            //cleanup event handler to prevent memory leaks in IE
                            this._transport.onreadystatechange = function(){};
                            
                            //now start it
                            Y.later(RETRY_MS, this, this._init);
                        }
                    } else {
                        throw new Error(); //fastest way to fire error event
                    }
                } catch (ex){
                    this._fireErrorEvent();
                }
                
                //prevent memory leaks due to closure
                src = null;
            },
            
            /**
             * Updates the readyState property to 1 if it&#x27;s still
             * set at 0 and fires the open event.
             * @method _signalOpen
             * @return {void}
             * @private
             */
            _signalOpen: function(){
                if (this.readyState == 0){
                    this._fireOpenEvent();
                }
            },
            
            /**
             * Responsible for parsing and interpreting a line of data
             * in the event stream source.
             * @param {String} name The field name of the line.
             * @param {Variant} value The field value of the line.
             * @param {Boolean} secondPass (Optional) Indicates that this
             *      is the second time the function was called for this
             *      line. Needed to prevent infinite recursion.
             * @method _processDataLine
             * @return {void}
             * @private
             */
            _processDataLine: function(name, value, secondPass){
            
                var tempData;
            
                //shift off the first item to check the value
                //keep in mind that &quot;data: a:b&quot; is a valid value
                switch(name){
                
                    //format is &quot;data: value&quot;
                    case &quot;data&quot;:
                        tempData = value + &quot;\n&quot;;
                        if (tempData.charAt(0) == &quot; &quot;){
                            tempData = tempData.substring(1);
                        }
                        this._data += tempData;
                        break;
                        
                    //format is &quot;event: eventName&quot;
                    case &quot;event&quot;:
                        this._eventName = value.replace(/^\s+|\s+$/g, &quot;&quot;);  //trim
                        break;
                        
                    //format is &quot;:some comment&quot;
                    case &quot;&quot;:
                        //do nothing, this is a comment
                        break;
                        
                    //format is &quot;id: foo&quot;
                    case &quot;id&quot;:
                        this._lastEventId = value;
                        break;
                        
                    //format is &quot;retry: 10&quot;
                    case &quot;retry&quot;:
                    
                        //TODO: Need clarification from WHAT-WG
                        
                        break;
                        
                    //format is &quot;foo bar&quot;
                    default:
                    
                        if (!secondPass){
                            /*
                             * When there is no colon, but the line isn&#x27;t blank,
                             * the entire line is considered the field name
                             * and the field value is considered to be the empty
                             * string. This means the line must be processed again
                             * if it reaches this point.
                             */
                            this._processDataLine(name, &quot;&quot;, true);                                                
                        }
                }            
            
            },
            
            /**
             * Processes the data stream as server-sent events. Goes line by
             * line looking for event information and fires the message
             * event where appropriate.
             * @param {String} text The text to parse.
             * @return {void}
             * @private
             * @method _processIncomingData
             */
            _processIncomingData: function(text){
            
                //get only the newest data, ignore the rest
                text = text.substring(this._lastIndex);                
                this._lastIndex += text.length;
                
                var lines = text.split(&quot;\n&quot;),
                    parts,
                    i = 0,
                    len = lines.length,
                    tempData;
                    
                while (i &lt; len){
                    
                    if (lines[i].indexOf(&quot;:&quot;) &gt; -1){
                    
                        parts = lines[i].split(&quot;:&quot;);
                        
                        this._processDataLine(parts.shift(), parts.join(&quot;:&quot;));                                               
                    
                    } else if (lines[i].replace(/\s/g, &quot;&quot;) == &quot;&quot;){
                        /*
                         * An empty lines means to flush the event buffers
                         * and fire message event.
                         */                    
                        this._fireMessageEvent();
                    
                    }
                
                    i++;
                }
                
                /*
                 * Internet Explorer 8 sometimes cuts off the last empty line
                 * in a sequence. In that case, the call to _fireMessageEvent()
                 * isn&#x27;t made even though there&#x27;s a new message to broadcast.
                 * Since _fireMessageEvent() always checks to see if there&#x27;s
                 * more message data before firing, it&#x27;s safe to call again.
                 */
                this._fireMessageEvent();
                
            },
            
            /**
             * Fires the message event with appropriate data, but only if
             * there is actual data to share. This uses the stored
             * event name and data value to fire the appropriate event.
             * @return {void}
             * @method _fireMessageEvent
             * @private
             */
            _fireMessageEvent: function(){
                var eventName = &quot;message&quot;,
                    eventData,
                    lastEventId;
            
                if (this._data != &quot;&quot;){
                
                    //per spec, strip off last newline
                    if (this._data.charAt(this._data.length-1) == &quot;\n&quot;){
                        this._data = this._data.substring(0,this._data.length-1);
                    }
                
                    if (this._eventName.replace(/^\s+|\s+$/g, &quot;&quot;) != &quot;&quot;){
                        eventName = this._eventName;
                    }
                
                    //create copies of data
                    eventData = this._data;
                    lastEventId = this._lastEventId;
                
                    //an empty line means a message is complete
                    //TODO: Add origin property
                    Y.later(0, this, function(){
                        this.fire({type: eventName, data: eventData, lastEventId: lastEventId});
                    });
                                            
                    //clear the existing data
                    this._data = &quot;&quot;;
                    this._eventName = &quot;&quot;;                    
                }            
            },
            
            /**
             * Permanently close the connection with the server.
             * @method close
             * @return {void}
             */
            close: function(){
                if (this.readyState != 2){
                    this.readyState = 2;
                    
                    /*
                     * It&#x27;s possible that close() was called before the timeout
                     * set in _init() has executed. In that case, this._transport
                     * is still null.
                     */
                    if (this._transport){
                        this._transport.abort();
                    }
                }
            }

        };    
    
    }
    
    //inherit from Event.Target to get events, and assign instance methods
    Y.extend(YUIEventSource, Y.Event.Target, Y.merge(basePrototype, prototype));

    //publish to Y object
    Y.EventSource = YUIEventSource;

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
