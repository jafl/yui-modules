#!/bin/bash

echo ===;
whoami;
echo ===;

YOGI=`readlink -f /usr/local/bin/yogi`;
YOGI=${YOGI%/*};
echo $YOGI;
ls $YOGI;
echo ---;
YOGI=`realpath /usr/local/bin/yogi`;
YOGI=${YOGI%/*};
echo $YOGI;
ls $YOGI;
echo ---;
ls /home/travis/.nvm/versions/node/v6.14.4/lib/node_modules/yogi/;
echo ---;
cp -f ./bin/grover_patch_wrapper.js /home/travis/.nvm/versions/node/v6.14.4/lib/node_modules/yogi/node_modules/grover/lib/wrapper/wrapper.js;

echo patched grover;
echo ===;

for d in src/*; do
	if [[ ! -d $d/tests ]]; then continue; fi

	pushd $d
	if ! yogi build --no-lint; then exit 1; fi
	if ! yogi test; then exit 1; fi
	popd
done
